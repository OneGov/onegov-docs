
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>onegov.core.crypto.random &#8212; OneGov Docs 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for onegov.core.crypto.random</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot; Use Markov chains to generate random text that sounds Japanese.</span>
<span class="sd">    This makes random pronounceable passwords that are both strong and easy</span>
<span class="sd">    to memorize.</span>

<span class="sd">    Of course English or any other language could be used in the sample text.</span>

<span class="sd">    See more details at http://exyr.org/2011/random-pronounceable-passwords/</span>

<span class="sd">    Author: Simon Sapin</span>
<span class="sd">    License: BSD</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">onegov.core.utils</span> <span class="k">import</span> <span class="n">pairwise</span>


<div class="viewcode-block" id="random_password"><a class="viewcode-back" href="../../../../onegov_core.html#onegov.core.crypto.random_password">[docs]</a><span class="k">def</span> <span class="nf">random_password</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a random password using the markov chain below. &quot;&quot;&quot;</span>

    <span class="n">chain</span> <span class="o">=</span> <span class="n">MarkovChain</span><span class="p">(</span>
        <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">japanese</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span></div>


<span class="c1"># This is a romanization of the opening of &quot;Genji Monogatari&quot;</span>
<span class="c1"># by Murasaki Shikibu.</span>
<span class="c1"># Source: http://etext.lib.virginia.edu/japanese/genji/roman.html</span>

<span class="n">japanese</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Idure no ohom-toki ni ka, nyougo, kaui amata saburahi tamahi keru naka ni,</span>
<span class="s1">ito yamgotonaki kiha ni ha ara nu ga, sugurete tokimeki tamahu ari keri.</span>

<span class="s1">Hazime yori ware ha to omohi agari tamahe ru ohom-kata-gata, mezamasiki mono ni</span>
<span class="s1">otosime sonemi tamahu. Onazi hodo, sore yori gerahu no kaui-tati ha, masite</span>
<span class="s1">yasukara zu. Asa-yuhu no miya-dukahe ni tuke te mo, hito no kokoro wo nomi</span>
<span class="s1">ugokasi, urami wo ohu tumori ni ya ari kem, ito atusiku nari yuki, mono kokoro-</span>
<span class="s1">boso-ge ni sato-gati naru wo, iyo-iyo aka zu ahare naru mono ni omohosi te hito</span>
<span class="s1">no sosiri wo mo e habakara se tamaha zu, yo no tamesi ni mo nari nu beki ohom-</span>
<span class="s1">motenasi nari.</span>

<span class="s1">Kamdatime, uhe-bito nado mo, ainaku me wo sobame tutu, &quot;Ito mabayuki hito no</span>
<span class="s1">ohom-oboye nari. Morokosi ni mo, kakaru koto no okori ni koso, yo mo midare,</span>
<span class="s1">asikari kere&quot; to, yau-yau amenosita ni mo adikinau, hito no mote-nayami-gusa ni</span>
<span class="s1">nari te, Yauki-hi no tamesi mo hiki ide tu beku nariyuku ni, ito hasitanaki</span>
<span class="s1">koto ohokare do, katazikenaki mi-kokoro-bahe no taguhi naki wo tanomi ni te</span>
<span class="s1">mazirahi tamahu.</span>

<span class="s1">TiTi no Dainagon ha nakunari te haha Kita-no-kata nam inisihe no yosi aru ni</span>
<span class="s1">te, oya uti-gusi, sasi-atari te yo no oboye hanayaka naru ohom-kata-gata ni mo</span>
<span class="s1">itau otora zu, nani-goto no gisiki wo mo motenasi tamahi kere do, tori-tate te</span>
<span class="s1">haka-bakasiki usiro-mi si nakere ba, koto aru toki ha, naho yori-dokoro naku</span>
<span class="s1">kokoro-boso-ge nari.</span>

<span class="s1">Saki no yo ni mo ohom-tigiri ya hukakari kem, yo ni naku kiyora naru tama no</span>
<span class="s1">wonoko miko sahe umare tamahi nu. Itusika to kokoro-motonagara se tamahi te,</span>
<span class="s1">isogi mawirase te go-ran-zuru ni, meduraka naru tigo no ohom-katati nari.</span>

<span class="s1">Iti-no-Miko ha, Udaizin no Nyougo no ohom-hara ni te, yose omoku, utagahi naki</span>
<span class="s1">Mauke-no-kimi to, yo ni mote-kasiduki kikoyure do, kono ohom-nihohi ni ha</span>
<span class="s1">narabi tamahu beku mo ara zari kere ba, ohokata no yamgotonaki ohom-omohi ni</span>
<span class="s1">te, kono Kimi wo ba, watakusi-mono ni omohosi kasiduki tamahu koto kagiri nasi.</span>

<span class="s1">Hazime yori osinabete no uhe-miya-dukahe si tamahu beki kiha ni ha ara zari ki.</span>
<span class="s1">Oboye ito yamgotonaku, zyauzu-mekasi kere do, warinaku matuhasa se tamahu amari</span>
<span class="s1">ni, sarubeki ohom-asobi no wori-wori, nani-goto ni mo yuwe aru koto no</span>
<span class="s1">husi-busi  ni ha, madu mau-nobora se tamahu. Aru-toki ni ha ohotono-gomori</span>
<span class="s1">sugusi te, yagate saburahase tamahi nado, anagati ni o-mahe sara zu mote-nasa</span>
<span class="s1">se tamahi si hodo ni, onodukara karoki kata ni mo miye si wo, kono Miko umare</span>
<span class="s1">tamahi te noti ha, ito kokoro koto ni omohosi oki te tare ba, Bau ni mo, you</span>
<span class="s1">se zu ha, kono Miko no wi tamahu beki na&#39;meri to, Ichi-no-Miko no Nyougo ha</span>
<span class="s1">obosi utagahe ri. Hito yori saki ni mawiri tamahi te, yamgotonaki ohom-omohi</span>
<span class="s1">nabete nara zu, Miko-tati nado mo ohasimase ba, kono Ohom-kata no ohom-isame</span>
<span class="s1">wo nomi zo, naho wadurahasiu kokoro-gurusiu omohi kikoye sase tamahi keru.</span>

<span class="s1">Kasikoki mi-kage wo ba tanomi kikoye nagara, otosime kizu wo motome tamahu hito</span>
<span class="s1">ha ohoku, waga mi ha ka-yowaku mono-hakanaki arisama ni te, naka-naka naru</span>
<span class="s1">mono-omohi wo zo si tamahu. Mi-tubone ha Kiritubo nari. Amata no ohom-Kata-gata</span>
<span class="s1">wo sugi sase tamahi te, hima naki o-mahe-watari ni, hito no mi-kokoro wo tukusi</span>
<span class="s1">tamahu mo, geni kotowari to miye tari. Mau-nobori tamahu ni mo, amari</span>
<span class="s1">uti-sikiru  wori-wori ha, uti-hasi, wata-dono no koko kasiko no miti ni,</span>
<span class="s1">ayasiki waza wo si tutu, ohom-okuri mukahe no hito no kinu no suso, tahe</span>
<span class="s1">gataku, masanaki koto mo ari. Mata aru toki ni ha, e sara nu me-dau no to wo</span>
<span class="s1">sasi-kome, konata kanata kokoro wo ahase te, hasitaname wadurahase tamahu toki</span>
<span class="s1">mo ohokari. Koto ni hure te kazu sira zu kurusiki koto nomi masare ba, ito itau</span>
<span class="s1">omohi wabi taru wo, itodo ahare to go-ran-zi te, Kourau-den ni motoyori</span>
<span class="s1">saburahi tamahu Kaui no zausi wo hoka ni utusa se tamahi te, Uhe-tubone ni</span>
<span class="s1">tamaha su. Sono urami masite yara m kata nasi.</span>
<span class="s1">&#39;&#39;&#39;</span>


<span class="k">class</span> <span class="nc">MarkovChain</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If a system transits from a state to another and the next state depends</span>
<span class="sd">    only on the current state and not the past, it is said to be a Markov</span>
<span class="sd">    chain.</span>

<span class="sd">    It is determined by the probability of each next state from any current</span>
<span class="sd">    state.</span>

<span class="sd">    See http://en.wikipedia.org/wiki/Markov_chain</span>

<span class="sd">    The probabilities are built from the frequencies in the `sample` chain.</span>
<span class="sd">    Elements of the sample that are not a valid state are ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">current</span><span class="p">,</span> <span class="nb">next</span> <span class="ow">in</span> <span class="n">pairwise</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">current</span><span class="p">][</span><span class="nb">next</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">totals</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">next_counts</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="k">for</span> <span class="n">current</span><span class="p">,</span> <span class="n">next_counts</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose at random and return a next state from a current state,</span>
<span class="sd">        according to the probabilities for this chain</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nexts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">state</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="c1"># Like random.choice() but with a different weight for each element</span>
        <span class="n">rand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totals</span><span class="p">[</span><span class="n">state</span><span class="p">])</span>
        <span class="c1"># Using bisection here could be faster, but simplicity prevailed.</span>
        <span class="c1"># (Also itâ€™s not that slow with 26 states or so.)</span>
        <span class="k">for</span> <span class="n">next_state</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">nexts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rand</span> <span class="o">&lt;</span> <span class="n">weight</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">next_state</span>
            <span class="n">rand</span> <span class="o">-=</span> <span class="n">weight</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an infinite iterator of states.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">state</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../../index.html">
    <img class="logo" src="../../../../_static/logo.svg" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=OneGov&repo=onegov-docs&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Verein OneGov.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>
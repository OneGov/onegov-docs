
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>onegov.form.parser.grammar &#8212; OneGov Docs 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for onegov.form.parser.grammar</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">decimal</span> <span class="k">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">onegov.form.utils</span> <span class="k">import</span> <span class="n">decimal_range</span>
<span class="kn">from</span> <span class="nn">pyparsing</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">alphanums</span><span class="p">,</span>
    <span class="n">Combine</span><span class="p">,</span>
    <span class="n">FollowedBy</span><span class="p">,</span>
    <span class="n">Group</span><span class="p">,</span>
    <span class="n">Literal</span><span class="p">,</span>
    <span class="n">MatchFirst</span><span class="p">,</span>
    <span class="n">nums</span><span class="p">,</span>
    <span class="n">OneOrMore</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">ParserElement</span><span class="p">,</span>
    <span class="n">Regex</span><span class="p">,</span>
    <span class="n">Suppress</span><span class="p">,</span>
    <span class="n">White</span><span class="p">,</span>
    <span class="n">Word</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># we want newlines to be significant</span>
<span class="n">ParserElement</span><span class="o">.</span><span class="n">setDefaultWhitespaceChars</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">unicode_characters</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">65536</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">isspace</span><span class="p">())</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">Word</span><span class="p">(</span><span class="n">unicode_characters</span><span class="p">)</span>
<span class="n">numeric</span> <span class="o">=</span> <span class="n">Word</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>


<div class="viewcode-block" id="text_without"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.text_without">[docs]</a><span class="k">def</span> <span class="nf">text_without</span><span class="p">(</span><span class="n">characters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns all printable text without the given characters. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Word</span><span class="p">(</span><span class="n">unicode_characters</span><span class="p">,</span> <span class="n">excludeChars</span><span class="o">=</span><span class="n">characters</span><span class="p">)</span></div>


<div class="viewcode-block" id="matches"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.matches">[docs]</a><span class="k">def</span> <span class="nf">matches</span><span class="p">(</span><span class="n">character</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns true if the given character matches the token. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">tokens</span><span class="p">:</span> <span class="n">tokens</span> <span class="ow">and</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">character</span></div>


<div class="viewcode-block" id="literal"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.literal">[docs]</a><span class="k">def</span> <span class="nf">literal</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot; Returns the given value, ignoring the tokens alltogether. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">tokens</span><span class="p">:</span> <span class="n">text</span></div>


<div class="viewcode-block" id="as_int"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.as_int">[docs]</a><span class="k">def</span> <span class="nf">as_int</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Converts the token to int if possible. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">tokens</span> <span class="k">else</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="as_decimal"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.as_decimal">[docs]</a><span class="k">def</span> <span class="nf">as_decimal</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Converts the token to decimal if possible. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tokens</span> <span class="ow">and</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>

    <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">))</span> <span class="k">if</span> <span class="n">tokens</span> <span class="k">else</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="as_uppercase"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.as_uppercase">[docs]</a><span class="k">def</span> <span class="nf">as_uppercase</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Converts the token to uppercase if possible. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">if</span> <span class="n">tokens</span> <span class="k">else</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="as_integer_range"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.as_integer_range">[docs]</a><span class="k">def</span> <span class="nf">as_integer_range</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Converts the token to an integer range if possible. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span></div>


<div class="viewcode-block" id="as_decimal_range"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.as_decimal_range">[docs]</a><span class="k">def</span> <span class="nf">as_decimal_range</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Converts the token to a decimal range if possible. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">decimal_range</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="as_regex"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.as_regex">[docs]</a><span class="k">def</span> <span class="nf">as_regex</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Converts the token to a working regex if possible. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="rstrip"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.rstrip">[docs]</a><span class="k">def</span> <span class="nf">rstrip</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Strips whitetext on the right of the token. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span></div>


<div class="viewcode-block" id="unwrap"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.unwrap">[docs]</a><span class="k">def</span> <span class="nf">unwrap</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unwraps grouped tokens. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="tag"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.tag">[docs]</a><span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="o">**</span><span class="n">tags</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Takes the given tags and applies them to the token. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">apply_tags</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">tags</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">tokens</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">apply_tags</span></div>


<div class="viewcode-block" id="with_whitespace_inside"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.with_whitespace_inside">[docs]</a><span class="k">def</span> <span class="nf">with_whitespace_inside</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns an expression that allows for whitespace inside, but not</span>
<span class="sd">    outside the expression.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Combine</span><span class="p">(</span><span class="n">OneOrMore</span><span class="p">(</span><span class="n">expr</span> <span class="o">|</span> <span class="n">White</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">expr</span><span class="p">))</span></div>


<div class="viewcode-block" id="enclosed_in"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.enclosed_in">[docs]</a><span class="k">def</span> <span class="nf">enclosed_in</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">characters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Wraps the given expression in the given characters. &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">characters</span>
    <span class="k">return</span> <span class="n">Suppress</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">+</span> <span class="n">expr</span> <span class="o">+</span> <span class="n">Suppress</span><span class="p">(</span><span class="n">right</span><span class="p">)</span></div>


<div class="viewcode-block" id="number_enclosed_in"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.number_enclosed_in">[docs]</a><span class="k">def</span> <span class="nf">number_enclosed_in</span><span class="p">(</span><span class="n">characters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Wraps numers in the given characters, making sure the result is an int.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">characters</span>
    <span class="k">return</span> <span class="n">enclosed_in</span><span class="p">(</span><span class="n">numeric</span><span class="p">,</span> <span class="n">characters</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">as_int</span><span class="p">)</span></div>


<div class="viewcode-block" id="mark_enclosed_in"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.mark_enclosed_in">[docs]</a><span class="k">def</span> <span class="nf">mark_enclosed_in</span><span class="p">(</span><span class="n">characters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a mark (x) inclosed in the given characters. For example,</span>
<span class="sd">    ``mark_enclosed_in(&#39;[]&#39;)`` creates an expression that accepts any of these</span>
<span class="sd">    and sets the result of the &#39;x&#39; value to True, the others to False::</span>

<span class="sd">        [x]</span>
<span class="sd">        [ ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">characters</span>
    <span class="k">return</span> <span class="n">MatchFirst</span><span class="p">((</span>
        <span class="n">Literal</span><span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="s1">&#39;x&#39;</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">literal</span><span class="p">(</span><span class="kc">True</span><span class="p">)),</span>
        <span class="n">Literal</span><span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">literal</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
    <span class="p">))</span></div>


<div class="viewcode-block" id="textfield"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.textfield">[docs]</a><span class="k">def</span> <span class="nf">textfield</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a textfield parser.</span>

<span class="sd">    Example::</span>

<span class="sd">        ____[50]</span>

<span class="sd">    The number defines the maximum length.</span>

<span class="sd">    Additionally, a regex may be specified to validate the field::</span>

<span class="sd">        ___/[0-9]{4}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">number_enclosed_in</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)(</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>

    <span class="n">regex</span> <span class="o">=</span> <span class="n">Word</span><span class="p">(</span><span class="n">unicode_characters</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">as_regex</span><span class="p">)(</span><span class="s1">&#39;regex&#39;</span><span class="p">)</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">regex</span>

    <span class="n">textfield</span> <span class="o">=</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;___&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="n">textfield</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">textfield</span></div>


<div class="viewcode-block" id="textarea"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.textarea">[docs]</a><span class="k">def</span> <span class="nf">textarea</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a textarea parser.</span>

<span class="sd">    Example::</span>

<span class="sd">        ...[5]</span>

<span class="sd">    The number defines the number of rows.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="n">number_enclosed_in</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)(</span><span class="s1">&#39;rows&#39;</span><span class="p">)</span>

    <span class="n">textarea</span> <span class="o">=</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
    <span class="n">textarea</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;textarea&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">textarea</span></div>


<div class="viewcode-block" id="password"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.password">[docs]</a><span class="k">def</span> <span class="nf">password</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a password field parser.</span>

<span class="sd">    Example::</span>

<span class="sd">        ***</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;***&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="email"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.email">[docs]</a><span class="k">def</span> <span class="nf">email</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns an email field parser.</span>

<span class="sd">    Example::</span>

<span class="sd">        @@@</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;@@@&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;email&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="url"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.url">[docs]</a><span class="k">def</span> <span class="nf">url</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns an url field parser.</span>

<span class="sd">    Example::</span>

<span class="sd">        http://</span>
<span class="sd">        https://</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Suppress</span><span class="p">(</span><span class="n">Regex</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;https?://&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;url&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="date"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.date">[docs]</a><span class="k">def</span> <span class="nf">date</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a date parser.</span>

<span class="sd">    Example::</span>

<span class="sd">        YYYY.MM.DD</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;YYYY.MM.DD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="datetime"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.datetime">[docs]</a><span class="k">def</span> <span class="nf">datetime</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a datetime parser.</span>

<span class="sd">    Example::</span>

<span class="sd">        YYYY.MM.DD HH:MM</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;YYYY.MM.DD HH:MM&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="time"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.time">[docs]</a><span class="k">def</span> <span class="nf">time</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a time parser.</span>

<span class="sd">    Example::</span>

<span class="sd">        HH:MM</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;HH:MM&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="stdnum"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.stdnum">[docs]</a><span class="k">def</span> <span class="nf">stdnum</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns an stdnum parser.</span>

<span class="sd">    Example::</span>

<span class="sd">        # iban</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">White</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">Regex</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-z\.]+&#39;</span><span class="p">)(</span><span class="s1">&#39;format&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;stdnum&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="fileinput"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.fileinput">[docs]</a><span class="k">def</span> <span class="nf">fileinput</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a fileinput parser.</span>

<span class="sd">    For all kindes of files::</span>
<span class="sd">        *.*</span>

<span class="sd">    For specific files:</span>
<span class="sd">        *.pdf|*.doc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">any_extension</span> <span class="o">=</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;*.*&#39;</span><span class="p">)</span>
    <span class="n">some_extension</span> <span class="o">=</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;*.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">Word</span><span class="p">(</span><span class="n">alphanums</span><span class="p">)</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">extract_file_types</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
        <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fileinput&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;extensions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tokens</span><span class="p">[</span><span class="s1">&#39;extensions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asList</span><span class="p">()]</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">any_extension</span> <span class="o">|</span> <span class="n">OneOrMore</span><span class="p">(</span><span class="n">some_extension</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">extract_file_types</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="decimal"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.decimal">[docs]</a><span class="k">def</span> <span class="nf">decimal</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a decimal parser.</span>

<span class="sd">    Decimal point is &#39;.&#39;.</span>

<span class="sd">    For example:</span>

<span class="sd">        0.00</span>
<span class="sd">        123</span>
<span class="sd">        11.1</span>
<span class="sd">        -10.0</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">numeric</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">numeric</span><span class="p">))</span>\
        <span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">as_decimal</span><span class="p">)(</span><span class="s1">&#39;amount&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="range_field"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.range_field">[docs]</a><span class="k">def</span> <span class="nf">range_field</span><span class="p">(</span><span class="n">value_expression</span><span class="p">,</span> <span class="n">parse_action</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Generic range field parser. &quot;&quot;&quot;</span>

    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">value_expression</span> <span class="o">+</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">value_expression</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">parse_action</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">addParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">r</span></div>


<div class="viewcode-block" id="integer_range_field"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.integer_range_field">[docs]</a><span class="k">def</span> <span class="nf">integer_range_field</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns an integer range parser. &quot;&quot;&quot;</span>

    <span class="n">number</span> <span class="o">=</span> <span class="n">Combine</span><span class="p">(</span><span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">numeric</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">range_field</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">as_integer_range</span><span class="p">,</span> <span class="s1">&#39;integer_range&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="decimal_range_field"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.decimal_range_field">[docs]</a><span class="k">def</span> <span class="nf">decimal_range_field</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a decimal range parser. &quot;&quot;&quot;</span>

    <span class="n">number</span> <span class="o">=</span> <span class="n">Combine</span><span class="p">(</span><span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">numeric</span> <span class="o">+</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">numeric</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">range_field</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">as_decimal_range</span><span class="p">,</span> <span class="s1">&#39;decimal_range&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="currency"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.currency">[docs]</a><span class="k">def</span> <span class="nf">currency</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a currency parser.</span>

<span class="sd">    For example:</span>

<span class="sd">        chf</span>
<span class="sd">        USD</span>
<span class="sd">        Cny</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">Regex</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-zA-Z]</span><span class="si">{3}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">as_uppercase</span><span class="p">)(</span><span class="s1">&#39;currency&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="marker_box"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.marker_box">[docs]</a><span class="k">def</span> <span class="nf">marker_box</span><span class="p">(</span><span class="n">characters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a marker box:</span>

<span class="sd">    Example::</span>

<span class="sd">        (x) Male</span>
<span class="sd">        [x] Female</span>
<span class="sd">        {x} What?</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check</span> <span class="o">=</span> <span class="n">mark_enclosed_in</span><span class="p">(</span><span class="n">characters</span><span class="p">)(</span><span class="s1">&#39;checked&#39;</span><span class="p">)</span>
    <span class="n">pricing</span> <span class="o">=</span> <span class="n">enclosed_in</span><span class="p">(</span><span class="n">decimal</span><span class="p">()</span> <span class="o">+</span> <span class="n">currency</span><span class="p">(),</span> <span class="s1">&#39;()&#39;</span><span class="p">)(</span><span class="s1">&#39;pricing&#39;</span><span class="p">)</span>

    <span class="n">label_text</span> <span class="o">=</span> <span class="n">with_whitespace_inside</span><span class="p">(</span><span class="n">text_without</span><span class="p">(</span><span class="n">characters</span> <span class="o">+</span> <span class="s1">&#39;()&#39;</span><span class="p">))</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">MatchFirst</span><span class="p">((</span>
        <span class="n">label_text</span> <span class="o">+</span> <span class="n">FollowedBy</span><span class="p">(</span><span class="n">pricing</span><span class="p">),</span>
        <span class="n">Combine</span><span class="p">(</span><span class="n">label_text</span> <span class="o">+</span> <span class="n">with_whitespace_inside</span><span class="p">(</span><span class="n">text</span><span class="p">)),</span>
        <span class="n">label_text</span>
    <span class="p">))(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">check</span> <span class="o">+</span> <span class="n">label</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">pricing</span><span class="p">)</span></div>


<div class="viewcode-block" id="radio"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.radio">[docs]</a><span class="k">def</span> <span class="nf">radio</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a radio parser:</span>

<span class="sd">    Example::</span>
<span class="sd">        (x) Male</span>
<span class="sd">        ( ) Female</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">marker_box</span><span class="p">(</span><span class="s1">&#39;()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;radio&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="checkbox"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.checkbox">[docs]</a><span class="k">def</span> <span class="nf">checkbox</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a checkbox parser:</span>

<span class="sd">    Example::</span>
<span class="sd">        [x] Male</span>
<span class="sd">        [ ] Female</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">marker_box</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;checkbox&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="fieldset_title"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.fieldset_title">[docs]</a><span class="k">def</span> <span class="nf">fieldset_title</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; A fieldset title parser. Fieldset titles are just like headings in</span>
<span class="sd">    markdown::</span>

<span class="sd">        # My header</span>

<span class="sd">    It&#39;s possible to have an empty fieldset title (to disable a fieldset):</span>

<span class="sd">        # ...</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">with_whitespace_inside</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">setResultsName</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>

    <span class="n">fieldset_title</span> <span class="o">=</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="n">label</span><span class="p">)</span>
    <span class="n">fieldset_title</span> <span class="o">=</span> <span class="n">fieldset_title</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;fieldset&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">fieldset_title</span></div>


<div class="viewcode-block" id="field_identifier"><a class="viewcode-back" href="../../../../onegov_form.html#onegov.form.parser.grammar.field_identifier">[docs]</a><span class="k">def</span> <span class="nf">field_identifier</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a field identifier parser:</span>

<span class="sd">    Example::</span>

<span class="sd">        My field *</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">required</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">matches</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">))</span>
    <span class="n">required</span> <span class="o">=</span> <span class="n">Optional</span><span class="p">(</span><span class="n">required</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="s1">&#39;required&#39;</span><span class="p">)</span>

    <span class="c1"># a field name can contain any kind of character, except for a &#39;=&#39; and</span>
    <span class="c1"># a &#39;*&#39;, which we&#39;ll need later for the field definition</span>
    <span class="n">characters</span> <span class="o">=</span> <span class="n">with_whitespace_inside</span><span class="p">(</span><span class="n">text_without</span><span class="p">(</span><span class="s1">&#39;*=&#39;</span><span class="p">))</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">Combine</span><span class="p">(</span><span class="n">OneOrMore</span><span class="p">(</span><span class="n">characters</span><span class="p">))(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>

    <span class="c1"># a field declaration begins with spaces (so we can differentiate between</span>
    <span class="c1"># text and catual fields), then includes the name and the &#39;*&#39; which marks</span>
    <span class="c1"># required fields</span>
    <span class="k">return</span> <span class="n">label</span> <span class="o">+</span> <span class="n">required</span> <span class="o">+</span> <span class="n">Suppress</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../../index.html">
    <img class="logo" src="../../../../_static/logo.svg" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=OneGov&repo=onegov-docs&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Verein OneGov.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>
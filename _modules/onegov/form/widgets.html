
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>onegov.form.widgets &#8212; OneGov Docs 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for onegov.form.widgets</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">chameleon</span>
<span class="kn">import</span> <span class="nn">humanize</span>

<span class="kn">from</span> <span class="nn">cgi</span> <span class="k">import</span> <span class="n">escape</span>
<span class="kn">from</span> <span class="nn">onegov.form</span> <span class="k">import</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">wtforms.widgets</span> <span class="k">import</span> <span class="n">ListWidget</span><span class="p">,</span> <span class="n">FileInput</span><span class="p">,</span> <span class="n">TextInput</span>
<span class="kn">from</span> <span class="nn">wtforms.widgets.core</span> <span class="k">import</span> <span class="n">HTMLString</span>


<div class="viewcode-block" id="OrderedListWidget"><a class="viewcode-back" href="../../../onegov_form.html#onegov.form.widgets.OrderedListWidget">[docs]</a><span class="k">class</span> <span class="nc">OrderedListWidget</span><span class="p">(</span><span class="n">ListWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Extends the default list widget with automated ordering using the</span>
<span class="sd">    translated text of each element.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># ListWidget expects a field internally, but it will only use</span>
        <span class="c1"># its id property and __iter__ method, so we can get away</span>
        <span class="c1"># with passing a fake field with an id and an iterator.</span>
        <span class="c1">#</span>
        <span class="c1"># It&#39;s not great, since we have to assume internal knowledge,</span>
        <span class="c1"># but builting a new field or changing the existing one would</span>
        <span class="c1"># require even more knowledge, so this is the better approach</span>
        <span class="c1">#</span>
        <span class="c1"># We also need to call each field once so it gets hooked up with</span>
        <span class="c1"># our translation machinary</span>
        <span class="n">ordered</span> <span class="o">=</span> <span class="p">[</span><span class="n">subfield</span> <span class="k">for</span> <span class="n">subfield</span> <span class="ow">in</span> <span class="n">field</span><span class="p">]</span>
        <span class="n">ordered</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="p">(</span><span class="n">f</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">text</span><span class="p">))[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">class</span> <span class="nc">FakeField</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

            <span class="nb">id</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">id</span>

            <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="n">ordered</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">FakeField</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="MultiCheckboxWidget"><a class="viewcode-back" href="../../../onegov_form.html#onegov.form.widgets.MultiCheckboxWidget">[docs]</a><span class="k">class</span> <span class="nc">MultiCheckboxWidget</span><span class="p">(</span><span class="n">ListWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The default list widget with the label behind the checkbox. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;prefix_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="OrderedMultiCheckboxWidget"><a class="viewcode-back" href="../../../onegov_form.html#onegov.form.widgets.OrderedMultiCheckboxWidget">[docs]</a><span class="k">class</span> <span class="nc">OrderedMultiCheckboxWidget</span><span class="p">(</span><span class="n">MultiCheckboxWidget</span><span class="p">,</span> <span class="n">OrderedListWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The sorted list widget with the label behind the checkbox. &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="CoordinateWidget"><a class="viewcode-back" href="../../../onegov_form.html#onegov.form.widgets.CoordinateWidget">[docs]</a><span class="k">class</span> <span class="nc">CoordinateWidget</span><span class="p">(</span><span class="n">TextInput</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Widget containing the coordinates for the</span>
<span class="sd">    :class:`onegov.form.fields.CoordinateField` class.</span>

<span class="sd">    Basically a text input with a class. Meant to be enhanced on the browser</span>
<span class="sd">    using javascript.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;class_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; coordinate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="UploadWidget"><a class="viewcode-back" href="../../../onegov_form.html#onegov.form.widgets.UploadWidget">[docs]</a><span class="k">class</span> <span class="nc">UploadWidget</span><span class="p">(</span><span class="n">FileInput</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; An upload widget for the :class:`onegov.form.fields.UploadField` class,</span>
<span class="sd">    which supports keeping, removing and replacing already uploaded files.</span>

<span class="sd">    This is necessary as file inputs are read-only on the client and it&#39;s</span>
<span class="sd">    therefore rather easy for users to lose their input otherwise (e.g. a</span>
<span class="sd">    form with a file is rejected because of some mistake - the file disappears</span>
<span class="sd">    once the response is rendered on the client).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">force_simple</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;force_simple&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">input_html</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">force_simple</span> <span class="ow">or</span> <span class="n">field</span><span class="o">.</span><span class="n">errors</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HTMLString</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div class=&quot;upload-widget without-data&quot;&gt;</span>
<span class="s2">                    </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_html</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HTMLString</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div class=&quot;upload-widget with-data&quot;&gt;</span>
<span class="s2">                    &lt;p&gt;</span><span class="si">{existing_file_label}</span><span class="s2">: </span><span class="si">{filename}</span><span class="s2"> (</span><span class="si">{filesize}</span><span class="s2">) âœ“&lt;/p&gt;</span>
<span class="s2">                    &lt;ul&gt;</span>
<span class="s2">                        &lt;li&gt;</span>
<span class="s2">                            &lt;input type=&quot;radio&quot; id=&quot;</span><span class="si">{name}</span><span class="s2">-0&quot; name=&quot;</span><span class="si">{name}</span><span class="s2">&quot;</span>
<span class="s2">                                   value=&quot;keep&quot; checked=&quot;&quot;&gt;</span>
<span class="s2">                            &lt;label for=&quot;</span><span class="si">{name}</span><span class="s2">-0&quot;&gt;</span><span class="si">{keep_label}</span><span class="s2">&lt;/label&gt;</span>
<span class="s2">                        &lt;/li&gt;</span>
<span class="s2">                        &lt;li&gt;</span>
<span class="s2">                            &lt;input type=&quot;radio&quot; id=&quot;</span><span class="si">{name}</span><span class="s2">-1&quot; name=&quot;</span><span class="si">{name}</span><span class="s2">&quot;</span>
<span class="s2">                                   value=&quot;delete&quot;&gt;</span>
<span class="s2">                            &lt;label for=&quot;</span><span class="si">{name}</span><span class="s2">-1&quot;&gt;</span><span class="si">{delete_label}</span><span class="s2">&lt;/label&gt;</span>
<span class="s2">                        &lt;/li&gt;</span>
<span class="s2">                        &lt;li&gt;</span>
<span class="s2">                            &lt;input type=&quot;radio&quot; id=&quot;</span><span class="si">{name}</span><span class="s2">-2&quot; name=&quot;</span><span class="si">{name}</span><span class="s2">&quot;</span>
<span class="s2">                                   value=&quot;replace&quot;&gt;</span>
<span class="s2">                            &lt;label for=&quot;</span><span class="si">{name}</span><span class="s2">-2&quot;&gt;</span><span class="si">{replace_label}</span><span class="s2">&lt;/label&gt;</span>
<span class="s2">                            &lt;div&gt;</span>
<span class="s2">                                &lt;label&gt;</span>
<span class="s2">                                    &lt;div data-depends-on=&quot;</span><span class="si">{name}</span><span class="s2">/replace&quot;</span>
<span class="s2">                                         data-hide-label=&quot;false&quot;&gt;</span>
<span class="s2">                                        </span><span class="si">{input_html}</span><span class="s2"></span>
<span class="s2">                                    &lt;/div&gt;</span>
<span class="s2">                                &lt;/label&gt;</span>
<span class="s2">                            &lt;/div&gt;</span>
<span class="s2">                        &lt;/li&gt;</span>
<span class="s2">                    &lt;/ul&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="c1"># be careful, we do our own html generation here without any</span>
                <span class="c1"># safety harness - we need to carefully escape values the user</span>
                <span class="c1"># might supply</span>
                <span class="n">filesize</span><span class="o">=</span><span class="n">humanize</span><span class="o">.</span><span class="n">naturalsize</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]),</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">escape</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span> <span class="n">quote</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">input_html</span><span class="o">=</span><span class="n">input_html</span><span class="p">,</span>
                <span class="n">existing_file_label</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Uploaded file&#39;</span><span class="p">)),</span>
                <span class="n">keep_label</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Keep file&#39;</span><span class="p">)),</span>
                <span class="n">delete_label</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Delete file&#39;</span><span class="p">)),</span>
                <span class="n">replace_label</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Replace file&#39;</span><span class="p">))</span>
            <span class="p">))</span></div>


<div class="viewcode-block" id="TagsWidget"><a class="viewcode-back" href="../../../onegov_form.html#onegov.form.widgets.TagsWidget">[docs]</a><span class="k">class</span> <span class="nc">TagsWidget</span><span class="p">(</span><span class="n">TextInput</span><span class="p">):</span>
    <span class="c1"># for use with https://github.com/developit/tags-input</span>
    <span class="n">input_type</span> <span class="o">=</span> <span class="s1">&#39;tags&#39;</span></div>


<div class="viewcode-block" id="IconWidget"><a class="viewcode-back" href="../../../onegov_form.html#onegov.form.widgets.IconWidget">[docs]</a><span class="k">class</span> <span class="nc">IconWidget</span><span class="p">(</span><span class="n">TextInput</span><span class="p">):</span>

    <span class="n">iconfont</span> <span class="o">=</span> <span class="s1">&#39;FontAwesome&#39;</span>
    <span class="n">icons</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;&amp;#xf111&#39;</span><span class="p">,</span>  <span class="c1"># fa-circle</span>
        <span class="s1">&#39;&amp;#xf005&#39;</span><span class="p">,</span>  <span class="c1"># fa-star</span>
        <span class="s1">&#39;&amp;#xf06a&#39;</span><span class="p">,</span>  <span class="c1"># fa-exclamation-circle</span>
        <span class="s1">&#39;&amp;#xf059&#39;</span><span class="p">,</span>  <span class="c1"># fa-question-circle</span>
        <span class="s1">&#39;&amp;#xf05e&#39;</span><span class="p">,</span>  <span class="c1"># fa-ban</span>
        <span class="s1">&#39;&amp;#xf1b9&#39;</span><span class="p">,</span>  <span class="c1"># fa-car</span>
        <span class="s1">&#39;&amp;#xf238&#39;</span><span class="p">,</span>  <span class="c1"># fa-train</span>
        <span class="s1">&#39;&amp;#xf206&#39;</span><span class="p">,</span>  <span class="c1"># fa-bicycle</span>
        <span class="s1">&#39;&amp;#xf291&#39;</span><span class="p">,</span>  <span class="c1"># fa-shopping-basket</span>
        <span class="s1">&#39;&amp;#xf1b0&#39;</span><span class="p">,</span>  <span class="c1"># fa-paw</span>
        <span class="s1">&#39;&amp;#xf1ae&#39;</span><span class="p">,</span>  <span class="c1"># fa-child</span>
        <span class="s1">&#39;&amp;#xf06d&#39;</span><span class="p">,</span>  <span class="c1"># fa-fire</span>
        <span class="s1">&#39;&amp;#xf1f8&#39;</span><span class="p">,</span>  <span class="c1"># fa-trash</span>
        <span class="s1">&#39;&amp;#xf236&#39;</span><span class="p">,</span>  <span class="c1"># fa-hotel</span>
        <span class="s1">&#39;&amp;#xf0f4&#39;</span><span class="p">,</span>  <span class="c1"># fa-coffee</span>
        <span class="s1">&#39;&amp;#xf017&#39;</span><span class="p">,</span>  <span class="c1"># fa-click</span>
    <span class="p">)</span>

    <span class="n">template</span> <span class="o">=</span> <span class="n">chameleon</span><span class="o">.</span><span class="n">PageTemplate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;div class=&quot;icon-widget&quot;&gt;</span>
<span class="s2">            &lt;ul style=&quot;font-family: $</span><span class="si">{iconfont}</span><span class="s2">&quot;&gt;</span>
<span class="s2">                &lt;li</span>
<span class="s2">                    tal:repeat=&quot;icon icons&quot;</span>
<span class="s2">                    tal:content=&quot;structure icon&quot;</span>
<span class="s2">                /&gt;</span>
<span class="s2">            &lt;/ul&gt;</span>

<span class="s2">            &lt;input type=&quot;hidden&quot; name=&quot;$</span><span class="si">{id}</span><span class="s2">&quot; value=&quot;${structure: value}&quot;&gt;</span>
<span class="s2">        &lt;/div&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">iconfont</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;iconfont&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iconfont</span><span class="p">)</span>
        <span class="n">icons</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;icons&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">icons</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">HTMLString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
            <span class="n">iconfont</span><span class="o">=</span><span class="n">iconfont</span><span class="p">,</span>
            <span class="n">icons</span><span class="o">=</span><span class="n">icons</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">data</span> <span class="ow">or</span> <span class="n">icons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">))</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../index.html">
    <img class="logo" src="../../../_static/logo.svg" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=OneGov&repo=onegov-docs&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Verein OneGov.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.9</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>
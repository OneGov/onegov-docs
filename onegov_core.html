
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Onegov Core API &#8212; OneGov Docs 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="onegov-core-api">
<h1>Onegov Core API<a class="headerlink" href="#onegov-core-api" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-onegov.core.framework">
<span id="framework"></span><h2>Framework<a class="headerlink" href="#module-onegov.core.framework" title="Permalink to this headline">¶</a></h2>
<p>The Framework provides a base Morepath application that offers certain
features for applications deriving from it:</p>
<blockquote>
<div><ul class="simple">
<li>Virtual hosting in conjunction with <code class="xref py py-mod docutils literal"><span class="pre">onegov.server</span></code>.</li>
<li>Access to an SQLAlchemy session bound to a specific Postgres schema.</li>
<li>A cache backed by memcached, shared by multiple processes.</li>
<li>An identity policy with basic rules, permissions and role.</li>
<li>The ability to serve static files and css/js assets.</li>
</ul>
</div></blockquote>
<p>Using the framework does not really differ from using Morepath:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onegov.core.framework</span> <span class="k">import</span> <span class="n">Framework</span>

<span class="k">class</span> <span class="nc">MyApplication</span><span class="p">(</span><span class="n">Framework</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<dl class="class">
<dt id="onegov.core.framework.Framework">
<em class="property">class </em><code class="descclassname">onegov.core.framework.</code><code class="descname">Framework</code><a class="reference internal" href="_modules/onegov/core/framework.html#Framework"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.Framework" title="Permalink to this definition">¶</a></dt>
<dd><p>Baseclass for Morepath OneGov applications.</p>
<dl class="attribute">
<dt id="onegov.core.framework.Framework.request_class">
<code class="descname">request_class</code><a class="headerlink" href="#onegov.core.framework.Framework.request_class" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal"><span class="pre">CoreRequest</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.dsn">
<code class="descname">dsn</code><em class="property"> = None</em><a class="headerlink" href="#onegov.core.framework.Framework.dsn" title="Permalink to this definition">¶</a></dt>
<dd><p>holds the database connection string, <em>if</em> there is a database connected</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.schema">
<code class="descname">schema</code><em class="property"> = None</em><a class="headerlink" href="#onegov.core.framework.Framework.schema" title="Permalink to this definition">¶</a></dt>
<dd><p>holdes the current schema associated with the database connection, set
by and derived from <a class="reference internal" href="#onegov.core.framework.Framework.set_application_id" title="onegov.core.framework.Framework.set_application_id"><code class="xref py py-meth docutils literal"><span class="pre">set_application_id()</span></code></a>.</p>
</dd></dl>

<dl class="classmethod">
<dt id="onegov.core.framework.Framework.form">
<em class="property">classmethod </em><code class="descname">form</code><span class="sig-paren">(</span><em>*args</em>, <em>**kw</em><span class="sig-paren">)</span><a class="headerlink" href="#onegov.core.framework.Framework.form" title="Permalink to this definition">¶</a></dt>
<dd><p>framework directives</p>
</dd></dl>

<dl class="classmethod">
<dt id="onegov.core.framework.Framework.cronjob">
<em class="property">classmethod </em><code class="descname">cronjob</code><span class="sig-paren">(</span><em>*args</em>, <em>**kw</em><span class="sig-paren">)</span><a class="headerlink" href="#onegov.core.framework.Framework.cronjob" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a cronjob.</p>
</dd></dl>

<dl class="classmethod">
<dt id="onegov.core.framework.Framework.static_directory">
<em class="property">classmethod </em><code class="descname">static_directory</code><span class="sig-paren">(</span><em>*args</em>, <em>**kw</em><span class="sig-paren">)</span><a class="headerlink" href="#onegov.core.framework.Framework.static_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a static files directory.</p>
</dd></dl>

<dl class="classmethod">
<dt id="onegov.core.framework.Framework.template_variables">
<em class="property">classmethod </em><code class="descname">template_variables</code><span class="sig-paren">(</span><em>*args</em>, <em>**kw</em><span class="sig-paren">)</span><a class="headerlink" href="#onegov.core.framework.Framework.template_variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a set of global template variables for chameleon templates.</p>
<p>Only exists once per application. Template variables with conflicting
keys defined in child applications override the keys with the same
name in the parent application. Non-conflicting keys are kept individually.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@App</span><span class="o">.</span><span class="n">template_variables</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_template_variables</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span>
    <span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.request_cache">
<code class="descname">request_cache</code><em class="property"> = None</em><a class="headerlink" href="#onegov.core.framework.Framework.request_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>the request cache is initialised/emptied before each request</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.modules">
<code class="descname">modules</code><a class="headerlink" href="#onegov.core.framework.Framework.modules" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides access to modules used by the Framework class. Those
modules cannot be included at the top because they themselves usually
include the Framework.</p>
<p>Admittelty a bit of a code smell.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.has_database_connection">
<code class="descname">has_database_connection</code><a class="headerlink" href="#onegov.core.framework.Framework.has_database_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>onegov.core has good integration for Postgres using SQLAlchemy, but
it doesn’t require a connection.</p>
<p>It’s possible to have Onegov applications using a different database
or not using one at all.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.has_filestorage">
<code class="descname">has_filestorage</code><a class="headerlink" href="#onegov.core.framework.Framework.has_filestorage" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if <code class="xref py py-attr docutils literal"><span class="pre">fs</span></code> is available.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.framework.Framework.configure_application">
<code class="descname">configure_application</code><span class="sig-paren">(</span><em>**cfg</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/framework.html#Framework.configure_application"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.Framework.configure_application" title="Permalink to this definition">¶</a></dt>
<dd><p>Configures the application. This function calls all methods on
the current class which start with <code class="docutils literal"><span class="pre">configure_</span></code>, passing the
configuration as keyword arguments.</p>
<p>The core itself supports the following parameters. Additional
parameters are made available by extra <code class="docutils literal"><span class="pre">configure_</span></code> methods.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Dsn:</th><td class="field-body"><p class="first">The database connection to use. May be None.</p>
<p>See <code class="xref py py-meth docutils literal"><span class="pre">onegov.core.orm.session_manager.setup()</span></code></p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Base:</th><td class="field-body"><p class="first">The declarative base class used. By default,
<code class="xref py py-attr docutils literal"><span class="pre">onegov.core.orm.Base</span></code> is used.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">Identity_secure:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><p class="first">True if the identity cookie is only transmitted over https. Only
set this to False during development!</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Identity_secret:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first">A random string used to sign the identity. By default a random
string is generated. The drawback of this is the fact that
users will be logged out every time the application restarts.</p>
<p>So provide your own if you don’t want that, but be sure to have
a really long, really random key that you will never share
with anyone!</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Memcached_url:</th><td class="field-body"><p class="first">The memcached url (default is 127.0.0.1:11211). If memcached
isn’t running the cache will not be used, though the memcached
server can be started at any time at which point the application
will connect to it again.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Cache_connections:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first">The maximum number of connections to the cache that are available.
Defaults to 100. This is mostly relevant for memcached, though
it works for all kinds of caches.</p>
<p>This limit prevents a sophisticated attacker from starting a denial
of service attack should he figure out a way to spawn lots of
applications.</p>
<p>Normally you want the combined memcached connection limit of all
configured applications to be lower than the actual connection
limit configured on memcached.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">Disable_memcached:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><p class="first">If True, memcache will not be used. The cache will be entirely in
the memory of the current process (so no sharing between multiple
processes).</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">File_storage:</th><td class="field-body"><p class="first">The file_storage module to use. See
<a class="reference external" href="http://docs.pyfilesystem.org/en/latest/filesystems.html">http://docs.pyfilesystem.org/en/latest/filesystems.html</a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">File_storage_options:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><p class="first">A dictionary of options passed to the <code class="docutils literal"><span class="pre">__init__</span></code> method of the
file_storage class.</p>
<p>The file storage is expected to work as is. For example, if
<code class="docutils literal"><span class="pre">fs.osfs.OSFS</span></code> is used, the root_path is expected exist.</p>
<p>The file storage can be shared between different onegov.core
applications. Each application automatically gets its own
namespace inside this space.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Always_compile_theme:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first">If true, the theme is always compiled - no caching is employed.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">Allow_shift_f5_comple:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><p class="first">If true, the theme is recompiled if shift+f5 is done on the
browser (or shift + reload button click).</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Csrf_secret:</th><td class="field-body"><p class="first">A random string used to sign the csrf token. Make sure this differs
from <code class="docutils literal"><span class="pre">identity_secret</span></code>! The algorithms behind identity_secret and
the csrf protection differ. If the same secret is used we might
leak information about said secret.</p>
<p>By default a random string is generated. The drawback of this is
the fact that users won’t be able to submit their forms if the
app is restarted in the background.</p>
<p>So provide your own, but be sure to have a really long, really
random string that you will never share with anyone!</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">Csrf_time_limit:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><p class="first">The csrf time limit in seconds. Basically the amount of time a
user has to submit a form, from the time it’s rendered.</p>
<p>Defaults to 1‘200s (20 minutes).</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Mail_host:</th><td class="field-body"><p class="first">The mail server to send e-mails from.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Mail_port:</th><td class="field-body"><p class="first">The port used for the mail server.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Mail_force_tls:</th><td class="field-body"><p class="first">True if TLS should be forced when connecting to the mail server.
Defaults to <code class="docutils literal"><span class="pre">True</span></code>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Mail_username:</th><td class="field-body"><p class="first">The username used for mail server authentication.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Mail_password:</th><td class="field-body"><p class="first">The password used for mail server authentication.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Mail_sender:</th><td class="field-body"><p class="first">The sender e-mail address.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Mail_use_directory:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first">If true, mails are stored in the maildir defined through
<code class="docutils literal"><span class="pre">mail_directory</span></code>. There, some other process is supposed to
pick up the e-mails and send them.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Mail_directory:</th><td class="field-body"><p class="first">The directory (maildir) where mails are stored if if
<code class="docutils literal"><span class="pre">mail_use_directory</span></code> is set to True.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Sql_query_report:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first">Prints out a report sql queries for each request, unless False.
Valid values are:</p>
<ul class="simple">
<li>‘summary’ (only show the number of queries)</li>
<li>‘redundant’ (show summary and the actual redundant queries)</li>
<li>‘all’ (show summary and all executed queries)</li>
</ul>
<p>Do not use in production!</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Profile:</th><td class="field-body"><p class="first">If true, profiles the request and stores the result in the profiles
folder with the following format: <code class="docutils literal"><span class="pre">YYYY-MM-DD</span> <span class="pre">hh:mm:ss.profile</span></code></p>
<p>Do not use in production!</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Print_exceptions:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first last">If true, exceptions are printed to stderr. Note that you should
usually configure logging through onegov.server. This is mainly
used for certain unit tests where we use WSGI more directly.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="onegov.core.framework.Framework.set_application_id">
<code class="descname">set_application_id</code><span class="sig-paren">(</span><em>application_id</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/framework.html#Framework.set_application_id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.Framework.set_application_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Set before the request is handled. Gets the schema from the
application id and makes sure it exists, <em>if</em> a database connection
is present.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.framework.Framework.get_cache">
<code class="descname">get_cache</code><span class="sig-paren">(</span><em>namespace</em>, <em>expiration_time=None</em>, <em>backend=None</em>, <em>backend_args=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/framework.html#Framework.get_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.Framework.get_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a new cache backend for this application or reuses an
existing one. Each backend is bound to a namespace and has its own
expiration time (ttl).</p>
<p>Once the <cite>cache_connections</cite> limit defined in
<a class="reference internal" href="#onegov.core.framework.Framework.configure_application" title="onegov.core.framework.Framework.configure_application"><code class="xref py py-meth docutils literal"><span class="pre">configure_application()</span></code></a> is reached, the backends are removed,
with the least recently used one being discarded first.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.session_cache">
<code class="descname">session_cache</code><a class="headerlink" href="#onegov.core.framework.Framework.session_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>A cache that is kept for as long as possible.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.cache">
<code class="descname">cache</code><a class="headerlink" href="#onegov.core.framework.Framework.cache" title="Permalink to this definition">¶</a></dt>
<dd><p>A cache that might be invalidated frequently.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.application_id_hash">
<code class="descname">application_id_hash</code><a class="headerlink" href="#onegov.core.framework.Framework.application_id_hash" title="Permalink to this definition">¶</a></dt>
<dd><p>The application_id as hash, use this if the applicaiton_id can
be read by the user -&gt; this obfuscates things slightly.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.framework.Framework.object_by_path">
<code class="descname">object_by_path</code><span class="sig-paren">(</span><em>path</em>, <em>with_view_name=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/framework.html#Framework.object_by_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.Framework.object_by_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a path and returns the object associated with it. If a
scheme or a host is passed it is ignored.</p>
<p>Be careful if you use this function with user provided urls, we load
objects here, not views. Therefore no security restrictions apply.</p>
<p>The first use case of this function is to provide a generic copy/paste
functionality. There, we only allow urls to be copied which have been
previously signed by the server.</p>
<p><em>Safeguards like this are necessary if the user has the ability to
somehow influence the path</em>!</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.framework.Framework.permission_by_view">
<code class="descname">permission_by_view</code><span class="sig-paren">(</span><em>model</em>, <em>view_name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/framework.html#Framework.permission_by_view"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.Framework.permission_by_view" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the permission required for the given model and view_name.</p>
<p>The model may be an instance or a class.</p>
<p>If the view cannot be evaluated, a KeyError is raised.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.session">
<code class="descname">session</code><a class="headerlink" href="#onegov.core.framework.Framework.session" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for self.session_manager.session.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.postman">
<code class="descname">postman</code><a class="headerlink" href="#onegov.core.framework.Framework.postman" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a Mailthon postman configured with the mail settings in
the settings view. See <a class="reference external" href="http://mailthon.readthedocs.org/">http://mailthon.readthedocs.org/</a> for
more information.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.framework.Framework.send_email">
<code class="descname">send_email</code><span class="sig-paren">(</span><em>reply_to</em>, <em>receivers=()</em>, <em>cc=()</em>, <em>bcc=()</em>, <em>subject=None</em>, <em>content=None</em>, <em>encoding='utf-8'</em>, <em>attachments=()</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/framework.html#Framework.send_email"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.Framework.send_email" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends a plain-text e-mail using <a class="reference internal" href="#onegov.core.framework.Framework.postman" title="onegov.core.framework.Framework.postman"><code class="xref py py-attr docutils literal"><span class="pre">postman</span></code></a> to the given
recipients. A reply to address is used to enable people to answer
to the e-mail which is usually sent by a noreply kind of e-mail
address.</p>
<p>E-mails sent through this method are bound to the current transaction.
If that transaction is aborted or not commited, the e-mail is not sent.</p>
<p>Usually you’ll use this method inside a request, where transactions
are automatically commited at the end.</p>
<p>For more complex use cases have a look at
<a class="reference external" href="http://mailthon.readthedocs.org/">http://mailthon.readthedocs.org/</a>.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.framework.Framework.send_hipchat">
<code class="descname">send_hipchat</code><span class="sig-paren">(</span><em>message_from</em>, <em>message</em>, <em>message_format='html'</em>, <em>color='green'</em>, <em>notify=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/framework.html#Framework.send_hipchat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.Framework.send_hipchat" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends a hipchat message asynchronously.</p>
<p>We are using the room notification method of the hipchat API V2:
<a class="reference external" href="https://www.hipchat.com/docs/apiv2/method/send_room_notification/">https://www.hipchat.com/docs/apiv2/method/send_room_notification/</a></p>
<p>Make sure to generate a token for the room (Scope: Send Notifications)
and define it in the configuration.</p>
<p>Returns the thread object to allow waiting by calling join.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.static_files">
<code class="descname">static_files</code><a class="headerlink" href="#onegov.core.framework.Framework.static_files" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of static_files paths registered through the
<code class="xref py py-class docutils literal"><span class="pre">onegov.core.directive.StaticDirectoryAction</span></code> directive.</p>
<p>To register a static files path:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@App</span><span class="o">.</span><span class="n">static_directory</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_static_directory</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;static&#39;</span>
</pre></div>
</div>
<p>For this to work, <code class="docutils literal"><span class="pre">server_static_files</span></code> has to be set to true.</p>
<p>When a child application registers a directory, the directory will
be considered first, before falling back to the parent’s static
directory.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.serve_static_files">
<code class="descname">serve_static_files</code><a class="headerlink" href="#onegov.core.framework.Framework.serve_static_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if <code class="docutils literal"><span class="pre">/static</span></code> files should be served. Needs to be
enabled manually.</p>
<p>Note that even if the static files are not served, <code class="docutils literal"><span class="pre">/static</span></code> path
is still served, it just won’t return anything but a 404.</p>
<p>Note also that static files are served <strong>publicly</strong>. You can override
this in your application, but doing that and testing for it is on you!</p>
<p>See also: <a class="reference internal" href="#module-onegov.core.static" title="onegov.core.static"><code class="xref py py-mod docutils literal"><span class="pre">onegov.core.static</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.framework.Framework.application_bound_identity">
<code class="descname">application_bound_identity</code><span class="sig-paren">(</span><em>userid</em>, <em>role</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/framework.html#Framework.application_bound_identity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.Framework.application_bound_identity" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new morepath identity for the given userid and role,
bound to this application.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.filestorage">
<code class="descname">filestorage</code><a class="headerlink" href="#onegov.core.framework.Framework.filestorage" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a filestorage object bound to the current application.
Based on this nifty module:</p>
<p><a class="reference external" href="http://docs.pyfilesystem.org/en/latest/">http://docs.pyfilesystem.org/en/latest/</a></p>
<p>The file storage returned is guaranteed to be independent of other
applications (the scope is the application_id, not just the class).</p>
<p>There is no guarantee as to what file storage backend is actually used.
It’s quite possible that the file storage will be somewhere online
in the future (e.g. S3).</p>
<p>Therefore, the urls for the file storage should always be acquired
through <a class="reference internal" href="#onegov.core.request.CoreRequest.filestorage_link" title="onegov.core.request.CoreRequest.filestorage_link"><code class="xref py py-meth docutils literal"><span class="pre">onegov.core.request.CoreRequest.filestorage_link()</span></code></a>.</p>
<p>The backend is configured through <a class="reference internal" href="#onegov.core.framework.Framework.configure_application" title="onegov.core.framework.Framework.configure_application"><code class="xref py py-meth docutils literal"><span class="pre">configure_application()</span></code></a>.</p>
<p>For a list of methods available on the resulting object, consult this
list: <a class="reference external" href="http://docs.pyfilesystem.org/en/latest/interface.html">http://docs.pyfilesystem.org/en/latest/interface.html</a>.</p>
<p>If no filestorage is available, this returns None.
See <code class="xref py py-attr docutils literal"><span class="pre">self.has_filestorage</span></code>.</p>
<p>WARNING: Files stored in the filestorage are available publicly! All
someone has to do is to <em>guess</em> the filename. To get an unguessable
filename use <a class="reference internal" href="#onegov.core.filestorage.random_filename" title="onegov.core.filestorage.random_filename"><code class="xref py py-meth docutils literal"><span class="pre">onegov.core.filestorage.random_filename()</span></code></a>.</p>
<p>The reason for this is the fact that filestorage may be something
external in the future.</p>
<p>This should not deter you from using this for user uploads, though
you should be careful. If you want to be sure that your application
stores files locally, use some other ways of storing those files.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onegov.core</span> <span class="k">import</span> <span class="n">filestorage</span>

<span class="n">filename</span> <span class="o">=</span> <span class="n">filestorage</span><span class="o">.</span><span class="n">random_filename</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">filestorage</span><span class="o">.</span><span class="n">settext</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;Lorem Ipsum&#39;</span><span class="p">)</span>

<span class="c1"># returns either an url like &#39;/files/4ec56cc005c594880a...&#39;</span>
<span class="c1"># or maybe &#39;https://amazonaws.com/onegov-cloud/32746/220592/q...&#39;</span>
<span class="n">request</span><span class="o">.</span><span class="n">filestorage_link</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.themestorage">
<code class="descname">themestorage</code><a class="headerlink" href="#onegov.core.framework.Framework.themestorage" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a storage object meant for themes, shared by all
applications.</p>
<p>Only use this for theming, nothing else!</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.theme_options">
<code class="descname">theme_options</code><a class="headerlink" href="#onegov.core.framework.Framework.theme_options" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the application-bound theme options.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.translations">
<code class="descname">translations</code><a class="headerlink" href="#onegov.core.framework.Framework.translations" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all available translations keyed by langauge.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.chameleon_translations">
<code class="descname">chameleon_translations</code><a class="headerlink" href="#onegov.core.framework.Framework.chameleon_translations" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all available translations for chameleon.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.locales">
<code class="descname">locales</code><a class="headerlink" href="#onegov.core.framework.Framework.locales" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all available locales in a set.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.identity_secret">
<code class="descname">identity_secret</code><a class="headerlink" href="#onegov.core.framework.Framework.identity_secret" title="Permalink to this definition">¶</a></dt>
<dd><p>The identity secret, guaranteed to only be valid for the current
application id.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.framework.Framework.csrf_secret">
<code class="descname">csrf_secret</code><a class="headerlink" href="#onegov.core.framework.Framework.csrf_secret" title="Permalink to this definition">¶</a></dt>
<dd><p>The identity secret, guaranteed to only be valid for the current
application id.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.framework.Framework.sign">
<code class="descname">sign</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/framework.html#Framework.sign"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.Framework.sign" title="Permalink to this definition">¶</a></dt>
<dd><p>Signs a text with the identity secret.</p>
<p>The text is signed together with the application id, so if one
application signs a text another won’t be able to unsign it.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.framework.Framework.unsign">
<code class="descname">unsign</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/framework.html#Framework.unsign"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.Framework.unsign" title="Permalink to this definition">¶</a></dt>
<dd><p>Unsigns a signed text, returning None if unsuccessful.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="onegov.core.framework.get_webasset_url">
<code class="descclassname">onegov.core.framework.</code><code class="descname">get_webasset_url</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/framework.html#get_webasset_url"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.get_webasset_url" title="Permalink to this definition">¶</a></dt>
<dd><p>The webassets url needs to be unique so we can fix it before
returning the generated html. See <code class="xref py py-func docutils literal"><span class="pre">fix_webassets_url_factory()</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.framework.get_cronjobs_enabled">
<code class="descclassname">onegov.core.framework.</code><code class="descname">get_cronjobs_enabled</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/framework.html#get_cronjobs_enabled"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.framework.get_cronjobs_enabled" title="Permalink to this definition">¶</a></dt>
<dd><p>If this value is set to False, all cronjobs are disabled. Only use
this during testing. Cronjobs have no impact on your application, unless
there are defined cronjobs, in which case they are there for a reason.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.directives">
<span id="directive"></span><h2>Directive<a class="headerlink" href="#module-onegov.core.directives" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="onegov.core.directives.HtmlHandleFormAction">
<em class="property">class </em><code class="descclassname">onegov.core.directives.</code><code class="descname">HtmlHandleFormAction</code><span class="sig-paren">(</span><em>model</em>, <em>form</em>, <em>render=None</em>, <em>template=None</em>, <em>load=None</em>, <em>permission=None</em>, <em>internal=False</em>, <em>**predicates</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/directives.html#HtmlHandleFormAction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.directives.HtmlHandleFormAction" title="Permalink to this definition">¶</a></dt>
<dd><p>Register Form view.</p>
<p>Basically wraps the Morepath’s <code class="docutils literal"><span class="pre">html</span></code> directive, registering both
POST and GET (if no specific request method is given) and wrapping the
view handler with <a class="reference internal" href="#onegov.core.directives.wrap_with_generic_form_handler" title="onegov.core.directives.wrap_with_generic_form_handler"><code class="xref py py-func docutils literal"><span class="pre">wrap_with_generic_form_handler()</span></code></a>.</p>
<p>The form is either a class or a function. If it’s a function, it is
expected to return a form class when given an instance of the model.</p>
<p>The form may also be None, which is useful under special circumstances.
Generally you don’t want that though.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@App.form</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">Root</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="s1">&#39;form.pt&#39;</span><span class="p">,</span>
          <span class="n">permission</span><span class="o">=</span><span class="n">Public</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">LoginForm</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">submitted</span><span class="p">():</span>
        <span class="c1"># do something if the form was submitted with valid data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># do something if the form was not submitted or not</span>
        <span class="c1"># submitted correctly</span>

    <span class="k">return</span> <span class="p">{}</span>  <span class="c1"># template variables</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="onegov.core.directives.fetch_form_class">
<code class="descclassname">onegov.core.directives.</code><code class="descname">fetch_form_class</code><span class="sig-paren">(</span><em>form_class</em>, <em>model</em>, <em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/directives.html#fetch_form_class"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.directives.fetch_form_class" title="Permalink to this definition">¶</a></dt>
<dd><p>Given the form_class defined with the form action, together with
model and request, this function returns the actual class to be used.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.directives.query_form_class">
<code class="descclassname">onegov.core.directives.</code><code class="descname">query_form_class</code><span class="sig-paren">(</span><em>request</em>, <em>model</em>, <em>name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/directives.html#query_form_class"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.directives.query_form_class" title="Permalink to this definition">¶</a></dt>
<dd><p>Queries the app configuration for the form class associated with
the given model and name. Take this configuration for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@App</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">Model</span><span class="p">,</span> <span class="n">form_class</span><span class="o">=</span><span class="n">Form</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;foobar&#39;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The form class defined here can be retrieved as follows:</p>
<blockquote>
<div>query_form_class(request, model=Model, name=’foobar’)</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="onegov.core.directives.wrap_with_generic_form_handler">
<code class="descclassname">onegov.core.directives.</code><code class="descname">wrap_with_generic_form_handler</code><span class="sig-paren">(</span><em>obj</em>, <em>form_class</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/directives.html#wrap_with_generic_form_handler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.directives.wrap_with_generic_form_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps a view handler with generic form handling.</p>
<p>This includes instantiatng the form with translations/csrf protection
and setting the correct action.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.directives.CronjobAction">
<em class="property">class </em><code class="descclassname">onegov.core.directives.</code><code class="descname">CronjobAction</code><span class="sig-paren">(</span><em>hour</em>, <em>minute</em>, <em>timezone</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/directives.html#CronjobAction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.directives.CronjobAction" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a cronjob.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.directives.StaticDirectoryAction">
<em class="property">class </em><code class="descclassname">onegov.core.directives.</code><code class="descname">StaticDirectoryAction</code><a class="reference internal" href="_modules/onegov/core/directives.html#StaticDirectoryAction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.directives.StaticDirectoryAction" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a static files directory.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.directives.TemplateVariablesAction">
<em class="property">class </em><code class="descclassname">onegov.core.directives.</code><code class="descname">TemplateVariablesAction</code><a class="reference internal" href="_modules/onegov/core/directives.html#TemplateVariablesAction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.directives.TemplateVariablesAction" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a set of global template variables for chameleon templates.</p>
<p>Only exists once per application. Template variables with conflicting
keys defined in child applications override the keys with the same
name in the parent application. Non-conflicting keys are kept individually.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@App</span><span class="o">.</span><span class="n">template_variables</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_template_variables</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span>
    <span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.static">
<span id="static-files"></span><h2>Static Files<a class="headerlink" href="#module-onegov.core.static" title="Permalink to this headline">¶</a></h2>
<p>Static files in OneGov applications are served under <code class="docutils literal"><span class="pre">/static</span></code>.</p>
<p>By default the <code class="docutils literal"><span class="pre">/static</span></code> folder of the application is used, relative to
the path of the application class. Files in that folder are available to
everyone if enabled:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onegov.core.framework</span> <span class="k">import</span> <span class="n">Framework</span>

<span class="k">class</span> <span class="nc">App</span><span class="p">(</span><span class="n">Framework</span><span class="p">):</span>
    <span class="n">serve_static_files</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>By default, the <code class="docutils literal"><span class="pre">/static</span></code> path is registered, but returns 404s. This prevents
accidental serving of static files.</p>
<p>To change the path to be served have a look at
<a class="reference internal" href="#onegov.core.framework.Framework.static_files" title="onegov.core.framework.Framework.static_files"><code class="xref py py-meth docutils literal"><span class="pre">onegov.core.framework.Framework.static_files()</span></code></a>.</p>
<p>Note that this is not meant to serve css/javascript files, rather it’s a way
to serve images, documents and other things that are really static.</p>
<p>Files served through this mechanism support the <code class="docutils literal"><span class="pre">If-Modified-Since</span></code> header.</p>
<p>If you need to serve something on another path you can:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Favicon</span><span class="p">(</span><span class="n">StaticFile</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@App</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">Favicon</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;favicon.ico&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_favicon</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">absorb</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">StaticFile</span><span class="o">.</span><span class="n">from_application</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s1">&#39;favicon.ico&#39;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="class">
<dt id="onegov.core.static.StaticFile">
<em class="property">class </em><code class="descclassname">onegov.core.static.</code><code class="descname">StaticFile</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/static.html#StaticFile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.static.StaticFile" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines a static file served by the application.</p>
<dl class="classmethod">
<dt id="onegov.core.static.StaticFile.from_application">
<em class="property">classmethod </em><code class="descname">from_application</code><span class="sig-paren">(</span><em>app</em>, <em>absorb</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/static.html#StaticFile.from_application"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.static.StaticFile.from_application" title="Permalink to this definition">¶</a></dt>
<dd><p>Absorbs all /static/* paths and returns <a class="reference internal" href="#onegov.core.static.StaticFile" title="onegov.core.static.StaticFile"><code class="xref py py-class docutils literal"><span class="pre">StaticFile</span></code></a>
instances with the path set to a subpath of
<code class="xref py py-meth docutils literal"><span class="pre">onegov.core.Framework.static_files()</span></code>.</p>
<p>For security reasons this subpath is required to actually be inside the
static_files folder. No symlinks are allowed.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="onegov.core.static.view_static_file">
<code class="descclassname">onegov.core.static.</code><code class="descname">view_static_file</code><span class="sig-paren">(</span><em>self</em>, <em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/static.html#view_static_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.static.view_static_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders the given static file in the browser.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.filestorage">
<span id="filestorage"></span><h2>Filestorage<a class="headerlink" href="#module-onegov.core.filestorage" title="Permalink to this headline">¶</a></h2>
<p>Filestorage is a way to store files locally or on a remote server, with the
interface being the same, no matter where the files are stored.</p>
<p>Based on <a class="reference external" href="http://docs.pyfilesystem.org/en/latest/">http://docs.pyfilesystem.org/en/latest/</a></p>
<p>See <a class="reference internal" href="#onegov.core.framework.Framework.filestorage" title="onegov.core.framework.Framework.filestorage"><code class="xref py py-attr docutils literal"><span class="pre">onegov.core.framework.Framework.filestorage</span></code></a> for more information.</p>
<dl class="function">
<dt id="onegov.core.filestorage.random_filename">
<code class="descclassname">onegov.core.filestorage.</code><code class="descname">random_filename</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/filestorage.html#random_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.filestorage.random_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a random filename that can’t be guessed.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.filestorage.FilestorageFile">
<em class="property">class </em><code class="descclassname">onegov.core.filestorage.</code><code class="descname">FilestorageFile</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/filestorage.html#FilestorageFile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.filestorage.FilestorageFile" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines a static file served by the application. The difference
between this and <a class="reference internal" href="#onegov.core.static.StaticFile" title="onegov.core.static.StaticFile"><code class="xref py py-class docutils literal"><span class="pre">onegov.core.static.StaticFile</span></code></a> is the storage.</p>
<p>Filestorage files are stored per application_id locally or on the cloud.
Static files are the same for the whole application class and they are
deployed statically. That means they are not content, but part of
the distribution.</p>
<p>Note that this is only used if the file is local. Files stored in the
filestorage should be linked using
<a class="reference internal" href="#onegov.core.request.CoreRequest.filestorage_link" title="onegov.core.request.CoreRequest.filestorage_link"><code class="xref py py-meth docutils literal"><span class="pre">onegov.core.request.CoreRequest.filestorage_link()</span></code></a>, which might
result in a local path, for which this class is used. Or it might result in
a remote path that is served by some different webserver.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.filestorage.view_filestorage_file">
<code class="descclassname">onegov.core.filestorage.</code><code class="descname">view_filestorage_file</code><span class="sig-paren">(</span><em>self</em>, <em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/filestorage.html#view_filestorage_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.filestorage.view_filestorage_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders the given filestorage file in the browser.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.filestorage.delete_static_file">
<code class="descclassname">onegov.core.filestorage.</code><code class="descname">delete_static_file</code><span class="sig-paren">(</span><em>self</em>, <em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/filestorage.html#delete_static_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.filestorage.delete_static_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes the given filestorage file. By default the permission is
<code class="docutils literal"><span class="pre">Private</span></code>. An application using the framework can override this though.</p>
<p>Since a DELETE can only be sent through AJAX it is protected by the
same-origin policy. That means that we don’t need to use any CSRF
protection here.</p>
<p>That being said, browser bugs and future changes in the HTML standard
make it possible for this to happen one day. Therefore, a time-limited
token must be passed as query parameter to this function.</p>
<p>New tokens can be acquired through <code class="docutils literal"><span class="pre">request.new_csrf_token</span></code>.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.theme">
<span id="theme"></span><h2>Theme<a class="headerlink" href="#module-onegov.core.theme" title="Permalink to this headline">¶</a></h2>
<p>onegov.core provides very basic theming support with the following
features:</p>
<ul class="simple">
<li>Themes can be external to onegov.core</li>
<li>Themes can be used by onegov.core applications</li>
<li>Themes can be compiled and the result is shared between applications</li>
</ul>
<p>Themes are not meant to be switched at runtime though, they are statically
defined by the applications. The idea is to have a way to share themes
between applications, not to have powerful skinning features where the user
can change the theme at any given time.</p>
<p>A theme is basically a CSS file. There is no way to define images/icons
and so on. The only way to do that is to include the image in the css
file (which is not <em>that</em> crazy of an idea anyway).</p>
<p>To write a theme, create a class providing the properties/methods of
<a class="reference internal" href="#onegov.core.theme.Theme" title="onegov.core.theme.Theme"><code class="xref py py-class docutils literal"><span class="pre">Theme</span></code></a>.</p>
<p>To use a theme you need to define the following setting:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@App</span><span class="o">.</span><span class="n">setting</span><span class="p">(</span><span class="n">section</span><span class="o">=</span><span class="s1">&#39;core&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;theme&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_theme</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Theme</span><span class="p">()</span>
</pre></div>
</div>
<p>To override the options passed to a theme, override the following function
in your application class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">App</span><span class="p">(</span><span class="n">Framework</span><span class="p">):</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">theme_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;background&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>To include the theme in your html, call the following function in your
template:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{request.theme_link}</span><span class="s2">&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Note that for the theme to work you need to define a filestorage. See
<a class="reference internal" href="#onegov.core.framework.Framework.configure_application" title="onegov.core.framework.Framework.configure_application"><code class="xref py py-meth docutils literal"><span class="pre">onegov.core.framework.Framework.configure_application()</span></code></a>.</p>
<dl class="class">
<dt id="onegov.core.theme.Theme">
<em class="property">class </em><code class="descclassname">onegov.core.theme.</code><code class="descname">Theme</code><a class="reference internal" href="_modules/onegov/core/theme.html#Theme"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.theme.Theme" title="Permalink to this definition">¶</a></dt>
<dd><p>Describres a onegov.core theme.</p>
<p>A onegov theme is any kind of compiled or non-compiled css file. The core
expects a single css file that stays the same as long as the same options
are passed to the compile function.</p>
<p>Some framework based themes might required the ability to serve
javascript at the same time. This is not done here. Such javascript
needs to be manually included through webassets.</p>
<p>This is due to the fact that onegov themes are not meant to be switched
around. An application will chose one theme and stick with it (and
test against it).</p>
<dl class="attribute">
<dt id="onegov.core.theme.Theme.name">
<code class="descname">name</code><a class="headerlink" href="#onegov.core.theme.Theme.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the theme, must be unique.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.theme.Theme.version">
<code class="descname">version</code><a class="headerlink" href="#onegov.core.theme.Theme.version" title="Permalink to this definition">¶</a></dt>
<dd><p>The version of the theme, should be changed whenever the theme
should trigger a recompile.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.theme.Theme.default_options">
<code class="descname">default_options</code><a class="headerlink" href="#onegov.core.theme.Theme.default_options" title="Permalink to this definition">¶</a></dt>
<dd><p>The default options of the theme, will be overritten by options
passed to <a class="reference internal" href="#onegov.core.theme.compile" title="onegov.core.theme.compile"><code class="xref py py-meth docutils literal"><span class="pre">compile()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.theme.Theme.compile">
<code class="descname">compile</code><span class="sig-paren">(</span><em>options={}</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/theme.html#Theme.compile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.theme.Theme.compile" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a single css that represents the theme.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="onegov.core.theme.get_filename">
<code class="descclassname">onegov.core.theme.</code><code class="descname">get_filename</code><span class="sig-paren">(</span><em>theme</em>, <em>options={}</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/theme.html#get_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.theme.get_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a unique filename for the given theme and options.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.theme.compile">
<code class="descclassname">onegov.core.theme.</code><code class="descname">compile</code><span class="sig-paren">(</span><em>storage</em>, <em>theme</em>, <em>options={}</em>, <em>force=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/theme.html#compile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.theme.compile" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a theme and stores it in the filestorage, returning the
path to the theme.</p>
<p>If the theme already exists and doesn’t need recompiling, it will not
compile the theme again.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Storage:</th><td class="field-body">The Pyfilesystem storage to store the files in.</td>
</tr>
<tr class="field-even field"><th class="field-name">Theme:</th><td class="field-body">The theme instance that should be compiled.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Options:</th><td class="field-body">The hashable options passed to the theme.</td>
</tr>
<tr class="field-even field"><th class="field-name">Force:</th><td class="field-body">If true, the compilation is done in any case.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onegov.core.theme.get_theme">
<code class="descclassname">onegov.core.theme.</code><code class="descname">get_theme</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/theme.html#get_theme"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.theme.get_theme" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines the default theme, which is no theme.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.theme.get_themestorage_file">
<code class="descclassname">onegov.core.theme.</code><code class="descname">get_themestorage_file</code><span class="sig-paren">(</span><em>app</em>, <em>absorb</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/theme.html#get_themestorage_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.theme.get_themestorage_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Serves the theme files.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.request">
<span id="request"></span><h2>Request<a class="headerlink" href="#module-onegov.core.request" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="onegov.core.request.Message">
<em class="property">class </em><code class="descclassname">onegov.core.request.</code><code class="descname">Message</code><span class="sig-paren">(</span><em>text</em>, <em>type</em><span class="sig-paren">)</span><a class="headerlink" href="#onegov.core.request.Message" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="onegov.core.request.Message.text">
<code class="descname">text</code><a class="headerlink" href="#onegov.core.request.Message.text" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.request.Message.type">
<code class="descname">type</code><a class="headerlink" href="#onegov.core.request.Message.type" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="onegov.core.request.ReturnToMixin">
<em class="property">class </em><code class="descclassname">onegov.core.request.</code><code class="descname">ReturnToMixin</code><a class="reference internal" href="_modules/onegov/core/request.html#ReturnToMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.ReturnToMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides a safe and convenient way of using return-to links.</p>
<p>Return-to links are links with an added ‘return-to’ query parameter
which points to the url a specific view (usually with a form) should
return to, once all is said and done.</p>
<p>There’s no magic involved. If a view should honor the return-to
paramter, it should use request.redirect instead of morepath.redirect.</p>
<p>If no return-to parameter was specified, rqeuest.redirect is a
transparent proxy to morepath.redirect.</p>
<p>To create a link:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">return_to</span><span class="p">(</span><span class="n">original_url</span><span class="p">,</span> <span class="n">redirect</span><span class="p">)</span>
</pre></div>
</div>
<p>To honor the paramter in a view, if present:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="n">default_url</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Do not use the return-to parameter directly</em>. Redirect parameters
are notorious for being used in phising attacks. By using <code class="docutils literal"><span class="pre">return_to</span></code>
and <code class="docutils literal"><span class="pre">redirect</span></code> you are kept safe from these attacks as the redirect
url is signed and verified.</p>
<p>For the same reason you should not allow the user-data for return-to
links. Those are meant for internally generated links!</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.request.CoreRequest">
<em class="property">class </em><code class="descclassname">onegov.core.request.</code><code class="descname">CoreRequest</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends the default Morepath request with virtual host support and
other useful methods.</p>
<p>Virtual hosting might be supported by Morepath directly in the future:
<a class="reference external" href="https://github.com/morepath/morepath/issues/185">https://github.com/morepath/morepath/issues/185</a></p>
<dl class="method">
<dt id="onegov.core.request.CoreRequest.link_prefix">
<code class="descname">link_prefix</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.link_prefix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.link_prefix" title="Permalink to this definition">¶</a></dt>
<dd><p>Override the <cite>link_prefix</cite> with the application base path provided
by onegov.server, because the default link_prefix contains the
hostname, which is not useful in our case - we’ll add the hostname
ourselves later.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.request.CoreRequest.x_vhm_host">
<code class="descname">x_vhm_host</code><a class="headerlink" href="#onegov.core.request.CoreRequest.x_vhm_host" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the X_VHM_HOST variable or an empty string.</p>
<p>X_VHM_HOST acts like a prefix to all links generated by Morepath.
If this variable is not empty, it will be added in front of all
generated urls.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.request.CoreRequest.x_vhm_root">
<code class="descname">x_vhm_root</code><a class="headerlink" href="#onegov.core.request.CoreRequest.x_vhm_root" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the X_VHM_ROOT variable or an empty string.</p>
<p>X_VHM_ROOT is a bit more tricky than X_VHM_HOST. It tells Morepath
where the root of the application is situated. This means that the
value of X_VHM_ROOT must be an existing path inside of Morepath.</p>
<p>We can understand this best with an example. Let’s say you have a
Morepath application that serves a blog under /blog. You now want to
serve the blog under a separate domain, say blog.example.org.</p>
<p>If we just served Morepath under blog.example.org, we’d get urls like
this one:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">blog</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">blog</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="mi">2014</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">17</span><span class="o">-</span><span class="mi">16</span><span class="p">:</span><span class="mi">00</span>
</pre></div>
</div>
<p>In effect, this subdomain would be no different from example.org
(without the blog subdomain). However, we want the root of the host to
point to /blog.</p>
<p>To do this we set X_VHM_ROOT to /blog. Morepath will then automatically
return urls like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">blog</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="mi">2014</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">17</span><span class="o">-</span><span class="mi">16</span><span class="p">:</span><span class="mi">00</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.request.CoreRequest.url">
<code class="descname">url</code><a class="headerlink" href="#onegov.core.request.CoreRequest.url" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the current url, taking the virtual hosting in account.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.transform">
<code class="descname">transform</code><span class="sig-paren">(</span><em>url</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.transform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies X_VHM_HOST and X_VHM_ROOT to the given url (which is
expected to not contain a host yet!).</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.link">
<code class="descname">link</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.link"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.link" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends the default link generating function of Morepath.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.class_link">
<code class="descname">class_link</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.class_link"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.class_link" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends the default class link generating function of Morepath.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.filestorage_link">
<code class="descname">filestorage_link</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.filestorage_link"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.filestorage_link" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given filestorage path and returns an url if the path
exists. The url might point to the local server or it might point to
somehwere else on the web.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.request.CoreRequest.theme_link">
<code class="descname">theme_link</code><a class="headerlink" href="#onegov.core.request.CoreRequest.theme_link" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the link to the current theme. Computed once per request.</p>
<p>The theme is automatically compiled and stored if it doesn’t exist yet,
or if it is outdated.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.request.CoreRequest.browser_session">
<code class="descname">browser_session</code><a class="headerlink" href="#onegov.core.request.CoreRequest.browser_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a browser_session bound to the request. Works via cookies,
so requests without cookies won’t be able to use the browser_session.</p>
<p>The browser session is bound to the application (by id), so no session
data is shared between the applications.</p>
<p>If no data is written to the browser_session, no session_id cookie
is created.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.get_form">
<code class="descname">get_form</code><span class="sig-paren">(</span><em>form_class</em>, <em>i18n_support=True</em>, <em>csrf_support=True</em>, <em>data=None</em>, <em>model=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.get_form"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.get_form" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an instance of the given form class, set up with the
correct translator and with CSRF protection enabled (the latter
doesn’t work yet).</p>
<p>Form classes passed to this function (or defined through the
<code class="docutils literal"><span class="pre">App.form</span></code> directive) may define a <code class="docutils literal"><span class="pre">on_request</span></code> method, which
is called after the request has been bound to the form and before
the view function is called.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.translate">
<code class="descname">translate</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.translate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.translate" title="Permalink to this definition">¶</a></dt>
<dd><p>Transalates the given text, if it’s a translatable text.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.request.CoreRequest.translator">
<code class="descname">translator</code><a class="headerlink" href="#onegov.core.request.CoreRequest.translator" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the translate function for basic string translations.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.request.CoreRequest.default_locale">
<code class="descname">default_locale</code><a class="headerlink" href="#onegov.core.request.CoreRequest.default_locale" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the default locale.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.request.CoreRequest.locale">
<code class="descname">locale</code><a class="headerlink" href="#onegov.core.request.CoreRequest.locale" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the current locale of this request.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.request.CoreRequest.html_lang">
<code class="descname">html_lang</code><a class="headerlink" href="#onegov.core.request.CoreRequest.html_lang" title="Permalink to this definition">¶</a></dt>
<dd><p>The language code for the html tag.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.get_translate">
<code class="descname">get_translate</code><span class="sig-paren">(</span><em>for_chameleon=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.get_translate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.get_translate" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the translate method to the given request, or None
if no such method is availabe.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">For_chameleon:</th><td class="field-body">True if the translate instance is used for chameleon (which is
special).</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.message">
<code class="descname">message</code><span class="sig-paren">(</span><em>text</em>, <em>type</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.message"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.message" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a message with the given type to the messages list. This
messages list may then be displayed by an application building on
onegov.core.</p>
<p>For example:</p>
<blockquote>
<div><a class="reference external" href="http://foundation.zurb.com/docs/components/alert_boxes.html">http://foundation.zurb.com/docs/components/alert_boxes.html</a></div></blockquote>
<p>Four default types are defined on the request for easier use:</p>
<p><a class="reference internal" href="#onegov.core.request.CoreRequest.success" title="onegov.core.request.CoreRequest.success"><code class="xref py py-meth docutils literal"><span class="pre">success()</span></code></a>
<a class="reference internal" href="#onegov.core.request.CoreRequest.warning" title="onegov.core.request.CoreRequest.warning"><code class="xref py py-meth docutils literal"><span class="pre">warning()</span></code></a>
<a class="reference internal" href="#onegov.core.request.CoreRequest.info" title="onegov.core.request.CoreRequest.info"><code class="xref py py-meth docutils literal"><span class="pre">info()</span></code></a>
<a class="reference internal" href="#onegov.core.request.CoreRequest.alert" title="onegov.core.request.CoreRequest.alert"><code class="xref py py-meth docutils literal"><span class="pre">alert()</span></code></a></p>
<p>The messages are stored with the session and to display them, the
template using the messages should call <a class="reference internal" href="#onegov.core.request.CoreRequest.consume_messages" title="onegov.core.request.CoreRequest.consume_messages"><code class="xref py py-meth docutils literal"><span class="pre">consume_messages()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.consume_messages">
<code class="descname">consume_messages</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.consume_messages"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.consume_messages" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the messages, removing them from the session in the
process. Call only if you can be reasonably sure that the user
will see the messages.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.success">
<code class="descname">success</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.success"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.success" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a success message.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.warning">
<code class="descname">warning</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.warning"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.warning" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a warning message.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.info">
<code class="descname">info</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.info" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds an info message.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.alert">
<code class="descname">alert</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.alert"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.alert" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds an alert message.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.request.CoreRequest.is_logged_in">
<code class="descname">is_logged_in</code><a class="headerlink" href="#onegov.core.request.CoreRequest.is_logged_in" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the current request is logged in at all.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.has_permission">
<code class="descname">has_permission</code><span class="sig-paren">(</span><em>model</em>, <em>permission</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.has_permission"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.has_permission" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the current user has the given permission on the
given model.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.has_access_to_url">
<code class="descname">has_access_to_url</code><span class="sig-paren">(</span><em>url</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.has_access_to_url"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.has_access_to_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if the current user has access to the given url.</p>
<p>The domain part of the url is completely ignored. This method should
only be used if you have no other choice. Loading the object by
url first is slower than if you can get the object otherwise.</p>
<p>The initial use-case for this function is the to parameter in the
login view. If the to-url is accessible anyway, we skip the login
view.</p>
<p>If we can’t find a view for the url, a KeyError is thrown.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.exclude_invisible">
<code class="descname">exclude_invisible</code><span class="sig-paren">(</span><em>models</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.exclude_invisible"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.exclude_invisible" title="Permalink to this definition">¶</a></dt>
<dd><p>Excludes models invisble to the current user from the list.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.is_visible">
<code class="descname">is_visible</code><span class="sig-paren">(</span><em>model</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.is_visible"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.is_visible" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the given model is visible to the current user.
This is basically an alias for <a class="reference internal" href="#onegov.core.request.CoreRequest.is_public" title="onegov.core.request.CoreRequest.is_public"><code class="xref py py-meth docutils literal"><span class="pre">CoreRequest.is_public()</span></code></a>. It exists
because it is easier to understand than <code class="docutils literal"><span class="pre">is_public</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.is_public">
<code class="descname">is_public</code><span class="sig-paren">(</span><em>model</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.is_public"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.is_public" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the current user has the Public permission for
the given model.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.is_personal">
<code class="descname">is_personal</code><span class="sig-paren">(</span><em>model</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.is_personal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.is_personal" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the current user has the Personal permission for
the given model.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.is_private">
<code class="descname">is_private</code><span class="sig-paren">(</span><em>model</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.is_private"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.is_private" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the current user has the Private permission for
the given model.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.is_secret">
<code class="descname">is_secret</code><span class="sig-paren">(</span><em>model</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.is_secret"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.is_secret" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the current user has the Secret permission for
the given model.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.request.CoreRequest.current_role">
<code class="descname">current_role</code><a class="headerlink" href="#onegov.core.request.CoreRequest.current_role" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the user-role of the current request, if logged in.
Otherwise, None is returned.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.has_role">
<code class="descname">has_role</code><span class="sig-paren">(</span><em>*roles</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.has_role"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.has_role" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if the current user has any of the given roles.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.new_csrf_token">
<code class="descname">new_csrf_token</code><span class="sig-paren">(</span><em>salt=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.new_csrf_token"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.new_csrf_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new CSRF token. A CSRF token can be verified
using <code class="xref py py-meth docutils literal"><span class="pre">is_valid_csrf_token()</span></code>.</p>
<p>Note that forms do their own CSRF protection. This is meant
for CSRF protection outside of forms.</p>
<p>onegov.core uses the Synchronizer Token Pattern for CSRF protection:
<a class="reference external" href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet</a></p>
<p>New CSRF tokens are signed usign a secret attached to the session (but
not sent out to the user). Clients have to return the CSRF token they
are given. The token has to match the secret, which the client doesn’t
know. So an attacker would have to get access to both the cookie and
the html source to be able to forge a request.</p>
<p>Since cookies are marked as HTTP only (no javascript access), this
even prevents CSRF attack combined with XSS.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.assert_valid_csrf_token">
<code class="descname">assert_valid_csrf_token</code><span class="sig-paren">(</span><em>signed_value=None</em>, <em>salt=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.assert_valid_csrf_token"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.assert_valid_csrf_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Validates the given CSRF token and returns if it was
created by <a class="reference internal" href="#onegov.core.request.CoreRequest.new_csrf_token" title="onegov.core.request.CoreRequest.new_csrf_token"><code class="xref py py-meth docutils literal"><span class="pre">new_csrf_token()</span></code></a>. If there’s a mismatch, a 403 is
raised.</p>
<p>If no signed_value is passed, it is taken from
request.params.get(‘csrf-token’).</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.new_url_safe_token">
<code class="descname">new_url_safe_token</code><span class="sig-paren">(</span><em>data</em>, <em>salt=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.new_url_safe_token"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.new_url_safe_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new URL safe token. A token can be deserialized
using <a class="reference internal" href="#onegov.core.request.CoreRequest.load_url_safe_token" title="onegov.core.request.CoreRequest.load_url_safe_token"><code class="xref py py-meth docutils literal"><span class="pre">load_url_safe_token()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.request.CoreRequest.load_url_safe_token">
<code class="descname">load_url_safe_token</code><span class="sig-paren">(</span><em>data</em>, <em>salt=None</em>, <em>max_age=3600</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/request.html#CoreRequest.load_url_safe_token"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.request.CoreRequest.load_url_safe_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Deserialize a token created by <a class="reference internal" href="#onegov.core.request.CoreRequest.new_url_safe_token" title="onegov.core.request.CoreRequest.new_url_safe_token"><code class="xref py py-meth docutils literal"><span class="pre">new_url_safe_token()</span></code></a>.</p>
<p>If the token is invalid, None is returned.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-onegov.core.orm">
<span id="orm"></span><h2>ORM<a class="headerlink" href="#module-onegov.core.orm" title="Permalink to this headline">¶</a></h2>
<dl class="data">
<dt id="onegov.core.orm.translation_hybrid">
<code class="descclassname">onegov.core.orm.</code><code class="descname">translation_hybrid</code><em class="property"> = &lt;sqlalchemy_utils.i18n.TranslationHybrid object&gt;</em><a class="headerlink" href="#onegov.core.orm.translation_hybrid" title="Permalink to this definition">¶</a></dt>
<dd><p>A translation hybrid integrated with OneGov Core. See also:
<a class="reference external" href="http://sqlalchemy-utils.readthedocs.org/en/latest/internationalization.html">http://sqlalchemy-utils.readthedocs.org/en/latest/internationalization.html</a></p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.orm.find_models">
<code class="descclassname">onegov.core.orm.</code><code class="descname">find_models</code><span class="sig-paren">(</span><em>base</em>, <em>is_match</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm.html#find_models"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.find_models" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the ORM models in the given ORM base class that match a filter.</p>
<p>The filter is called with each class in the instance and it is supposed
to return True if it matches.</p>
<p>For example, find all SQLAlchemy models that use
<a class="reference internal" href="#onegov.core.orm.mixins.ContentMixin" title="onegov.core.orm.mixins.ContentMixin"><code class="xref py py-class docutils literal"><span class="pre">ContentMixin</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onegov.core.orm.mixins</span> <span class="k">import</span> <span class="n">ContentMixin</span>
<span class="n">find_models</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">is_match</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">cls</span><span class="p">:</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ContentMixin</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="onegov.core.orm.SessionManager">
<em class="property">class </em><code class="descclassname">onegov.core.orm.</code><code class="descname">SessionManager</code><span class="sig-paren">(</span><em>dsn</em>, <em>base</em>, <em>engine_config=None</em>, <em>session_config=None</em>, <em>pool_config=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Holds sessions and creates schemas before binding sessions to schemas.</p>
<p>Threadsafe in theory, but not tested or well thought out. No global state
though, so two different session managers will manage different
sessions/schemas.</p>
<dl class="method">
<dt id="onegov.core.orm.SessionManager.bind_session">
<code class="descname">bind_session</code><span class="sig-paren">(</span><em>session</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.bind_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.bind_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Bind the session to the current schema.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.create_required_extensions">
<code class="descname">create_required_extensions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.create_required_extensions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.create_required_extensions" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the required extensions once per lifetime of the manager.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.create_schema">
<code class="descname">create_schema</code><span class="sig-paren">(</span><em>schema</em>, <em>validate=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.create_schema"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.create_schema" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the given schema. If said schema exists, expect this
method to throw an error. If you use <a class="reference internal" href="#onegov.core.orm.SessionManager.set_current_schema" title="onegov.core.orm.SessionManager.set_current_schema"><code class="xref py py-meth docutils literal"><span class="pre">set_current_schema()</span></code></a>,
this is invoked automatically if needed. So you usually shouldn’t
have to care about this function.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.create_schema_if_not_exists">
<code class="descname">create_schema_if_not_exists</code><span class="sig-paren">(</span><em>schema</em>, <em>validate=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.create_schema_if_not_exists"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.create_schema_if_not_exists" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the given schema if it doesn’t exist yet.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.dispose">
<code class="descname">dispose</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.dispose"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.dispose" title="Permalink to this definition">¶</a></dt>
<dd><p>Closes the connection to the server and cleans up. This only needed
for testing.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.ensure_schema_exists">
<code class="descname">ensure_schema_exists</code><span class="sig-paren">(</span><em>schema</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.ensure_schema_exists"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.ensure_schema_exists" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes sure the schema exists on the database. If it doesn’t, it
is created.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.is_schema_found_on_database">
<code class="descname">is_schema_found_on_database</code><span class="sig-paren">(</span><em>schema</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.is_schema_found_on_database"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.is_schema_found_on_database" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the given schema exists on the database.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.is_valid_schema">
<code class="descname">is_valid_schema</code><span class="sig-paren">(</span><em>schema</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.is_valid_schema"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.is_valid_schema" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the given schema looks valid enough to be created
on the database with no danger of SQL injection or other unwanted
sideeffects.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.list_schemas">
<code class="descname">list_schemas</code><span class="sig-paren">(</span><em>limit_to_namespace=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.list_schemas"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.list_schemas" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list containing <em>all</em> schemas defined in the current
database.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.register_engine">
<code class="descname">register_engine</code><span class="sig-paren">(</span><em>engine</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.register_engine"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.register_engine" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given engine and registers it with the schema
switching mechanism. Maybe used to register external engines with
the session manager.</p>
<p>If used like this, make sure to call <a class="reference internal" href="#onegov.core.orm.SessionManager.bind_session" title="onegov.core.orm.SessionManager.bind_session"><code class="xref py py-meth docutils literal"><span class="pre">bind_session()</span></code></a> before using
the session provided by the external engine.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.register_session">
<code class="descname">register_session</code><span class="sig-paren">(</span><em>session</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.register_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.register_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given session and registers it with zope.sqlalchemy and
various orm events.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.session">
<code class="descname">session</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.session" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new session or an existing session. Sessions with
different schemas are kept independent, though they might reuse
each others connections.</p>
<p>This means that a session retrieved thusly:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mgr</span> <span class="o">=</span> <span class="n">SessionManager</span><span class="p">(</span><span class="s1">&#39;postgres://...&#39;</span><span class="p">)</span>
<span class="n">mgr</span><span class="o">.</span><span class="n">set_current_schema</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">mgr</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
</pre></div>
</div>
<p>Will not see objects attached to this session:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mgr</span><span class="o">.</span><span class="n">set_current_schema</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">mgr</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.set_current_schema">
<code class="descname">set_current_schema</code><span class="sig-paren">(</span><em>schema</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.set_current_schema"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.set_current_schema" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the current schema in use. The current schema is then used
to bind the session to a schema. Note that this can’t be done
in a functional way. We need the current schema to generate a new
scope.</p>
<p>I would very much prefer to bind this to the session but this is not
at all straight-forward with SQLAlchemy.</p>
<p>I tried a solution like <a class="reference external" href="https://bitbucket.org/zzzeek/sqlalchemy/wiki/UsageRecipes/SessionModifiedSQL">this one</a>, but it’s not good
enough, because it still relies on some kind of global stage, even if
it’s set locally.</p>
<p>Ideally a value could be bound to the session and an event would
trigger every time the connection is used with that session. We
could then set the schema on the connection every time that happens.</p>
<p>For now, the global option is okay though, because in practice we
only set the schema once per request and we don’t do threading
anyway.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.set_locale">
<code class="descname">set_locale</code><span class="sig-paren">(</span><em>default_locale</em>, <em>current_locale</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.set_locale"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.set_locale" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the default locale and the current locale so it may be
shared with the translated ORM columns.</p>
<p>Note that the locales may be NONE. It is up to the consumer of these
settings to assert their existence.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.SessionManager.setup_manager_instance_sharing">
<code class="descname">setup_manager_instance_sharing</code><span class="sig-paren">(</span><em>bases</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/session_manager.html#SessionManager.setup_manager_instance_sharing"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.SessionManager.setup_manager_instance_sharing" title="Permalink to this definition">¶</a></dt>
<dd><p>Shares this instance with all mapped classes of all bases.</p>
<p>This enables each model to look up the current schema, the current
locale and so on.</p>
<p>This is a rather complicated way to make sure we don’t use a global
variable. One might argue that this would warrant an exception
to the rule…</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="onegov.core.orm.as_selectable">
<code class="descclassname">onegov.core.orm.</code><code class="descname">as_selectable</code><span class="sig-paren">(</span><em>query</em>, <em>alias=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/sql.html#as_selectable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.as_selectable" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a raw SQL query and turns it into a selectable SQLAlchemy
expression using annotations in comments.</p>
<p>Expects to find a SELECT statement like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SELECT</span>
    <span class="n">foo</span><span class="p">,</span>  <span class="o">--</span> <span class="n">Text</span>
    <span class="n">bar</span>   <span class="o">--</span> <span class="n">Integer</span>
<span class="n">FROM</span>
    <span class="n">foobar</span>
</pre></div>
</div>
<p>The so created selectable can be used by SQLAlchemy:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">select</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">as_selectable</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    SELECT</span>
<span class="s1">        foo, -- Text</span>
<span class="s1">        bar  -- Integer</span>
<span class="s1">    FROM</span>
<span class="s1">        foobar</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">foo</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="onegov.core.orm.orm_cached">
<code class="descclassname">onegov.core.orm.</code><code class="descname">orm_cached</code><span class="sig-paren">(</span><em>policy</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/cache.html#orm_cached"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.orm_cached" title="Permalink to this definition">¶</a></dt>
<dd><p>The decorator use to setup the cache descriptor.</p>
<p>See the <code class="xref py py-mod docutils literal"><span class="pre">onegov.core.orm.cache</span></code> docs for usage.</p>
</dd></dl>

<span class="target" id="module-onegov.core.orm.debug"></span><dl class="class">
<dt id="onegov.core.orm.debug.Timer">
<em class="property">class </em><code class="descclassname">onegov.core.orm.debug.</code><code class="descname">Timer</code><a class="reference internal" href="_modules/onegov/core/orm/debug.html#Timer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.debug.Timer" title="Permalink to this definition">¶</a></dt>
<dd><p>A timer that works just like a stopwatch.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.orm.debug.print_query">
<code class="descclassname">onegov.core.orm.debug.</code><code class="descname">print_query</code><span class="sig-paren">(</span><em>query</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/debug.html#print_query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.debug.print_query" title="Permalink to this definition">¶</a></dt>
<dd><p>Pretty prints the given query.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.orm.debug.analyze_sql_queries">
<code class="descclassname">onegov.core.orm.debug.</code><code class="descname">analyze_sql_queries</code><span class="sig-paren">(</span><em>report='summary'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/debug.html#analyze_sql_queries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.debug.analyze_sql_queries" title="Permalink to this definition">¶</a></dt>
<dd><p>Analyzes the sql-queries executed during its context. There are three
levels of information (report argument):</p>
<ul class="simple">
<li>‘summary’ (only show the number of queries)</li>
<li>‘redundant’ (show summary and the actual redundant queries)</li>
<li>‘all’ (show summary and all executed queries)</li>
</ul>
<p>Use this with a with_statement:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">analyze_sql_queries</span><span class="p">():</span>
    <span class="o">...</span> <span class="c1"># &lt;- analyzes all sql queries that happen inside here</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="module-onegov.core.orm.abstract.adjacency_list"></span><dl class="class">
<dt id="onegov.core.orm.abstract.adjacency_list.MoveDirection">
<em class="property">class </em><code class="descclassname">onegov.core.orm.abstract.adjacency_list.</code><code class="descname">MoveDirection</code><a class="reference internal" href="_modules/onegov/core/orm/abstract/adjacency_list.html#MoveDirection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.MoveDirection" title="Permalink to this definition">¶</a></dt>
<dd><p>Describs the possible directions for the
<a class="reference internal" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.move" title="onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.move"><code class="xref py py-meth docutils literal"><span class="pre">AdjacencyListCollection.move()</span></code></a> method.</p>
<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.MoveDirection.above">
<code class="descname">above</code><em class="property"> = 1</em><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.MoveDirection.above" title="Permalink to this definition">¶</a></dt>
<dd><p>Moves the subject above the target</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.MoveDirection.below">
<code class="descname">below</code><em class="property"> = 2</em><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.MoveDirection.below" title="Permalink to this definition">¶</a></dt>
<dd><p>Moves the subject below the target</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="onegov.core.orm.abstract.adjacency_list.sort_siblings">
<code class="descclassname">onegov.core.orm.abstract.adjacency_list.</code><code class="descname">sort_siblings</code><span class="sig-paren">(</span><em>siblings</em>, <em>key</em>, <em>reverse=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/adjacency_list.html#sort_siblings"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.sort_siblings" title="Permalink to this definition">¶</a></dt>
<dd><p>Sorts the siblings by the given key, writing the order to the
database.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyList">
<em class="property">class </em><code class="descclassname">onegov.core.orm.abstract.adjacency_list.</code><code class="descname">AdjacencyList</code><span class="sig-paren">(</span><em>title</em>, <em>parent=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/adjacency_list.html#AdjacencyList"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList" title="Permalink to this definition">¶</a></dt>
<dd><p>An abstract AdjacencyList implementation representing a Tree.</p>
<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyList.id">
<code class="descname">id</code><em class="property"> = Column(None, Integer(), table=None, primary_key=True, nullable=False)</em><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList.id" title="Permalink to this definition">¶</a></dt>
<dd><p>the id fo the db record (only relevant internally)
do not change this id after creation as that would destroy the tree</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyList.name">
<code class="descname">name</code><em class="property"> = Column(None, Text(), table=None, nullable=False)</em><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList.name" title="Permalink to this definition">¶</a></dt>
<dd><p>the name of the item - think of this as the id or better yet
the url segment e.g. <code class="docutils literal"><span class="pre">parent-item/child-item</span></code></p>
<p>automatically generated from the title if not provided</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyList.type">
<code class="descname">type</code><em class="property"> = Column(None, Text(), table=None)</em><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList.type" title="Permalink to this definition">¶</a></dt>
<dd><p>the type of the item, this can be used to create custom polymorphic
subclasses of this class. See
<a class="reference external" href="http://docs.sqlalchemy.org/en/improve_toc/ orm/extensions/declarative/inheritance.html">http://docs.sqlalchemy.org/en/improve_toc/ orm/extensions/declarative/inheritance.html</a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyList.order">
<code class="descname">order</code><em class="property"> = Column(None, Integer(), table=None, default=ColumnDefault(65536))</em><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList.order" title="Permalink to this definition">¶</a></dt>
<dd><p>the order of the items - items are added at the end by default</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyList.sort_key">
<code class="descname">sort_key</code><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList.sort_key" title="Permalink to this definition">¶</a></dt>
<dd><p>The sort key used for sorting the siblings if the title changes.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyList.title">
<code class="descname">title</code><em class="property"> = Column(None, Text(), table=None, nullable=False)</em><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList.title" title="Permalink to this definition">¶</a></dt>
<dd><p>the human readable title of the item</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyList.root">
<code class="descname">root</code><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList.root" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the root of this item.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyList.ancestors">
<code class="descname">ancestors</code><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList.ancestors" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all ancestors of this item.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyList.siblings">
<code class="descname">siblings</code><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList.siblings" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a query that includes all siblings, including the item
itself.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyList.path">
<code class="descname">path</code><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList.path" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the path of this item.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyList.absorb">
<code class="descname">absorb</code><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList.absorb" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for <a class="reference internal" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList.path" title="onegov.core.orm.abstract.adjacency_list.AdjacencyList.path"><code class="xref py py-attr docutils literal"><span class="pre">path</span></code></a>. This is a convenience feature for Morepath
if a path is absorbed.</p>
<p>See <a class="reference external" href="http://morepath.readthedocs.org/en/latest/paths_and_linking.html?highlight=absorb#absorbing">http://morepath.readthedocs.org/en/latest/paths_and_linking.html?highlight=absorb#absorbing</a></p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection">
<em class="property">class </em><code class="descclassname">onegov.core.orm.abstract.adjacency_list.</code><code class="descname">AdjacencyListCollection</code><span class="sig-paren">(</span><em>session</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/adjacency_list.html#AdjacencyListCollection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection" title="Permalink to this definition">¶</a></dt>
<dd><p>A base class for collections working with <a class="reference internal" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyList" title="onegov.core.orm.abstract.adjacency_list.AdjacencyList"><code class="xref py py-class docutils literal"><span class="pre">AdjacencyList</span></code></a>.</p>
<dl class="staticmethod">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.sort_key">
<em class="property">static </em><code class="descname">sort_key</code><span class="sig-paren">(</span><em>item</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/adjacency_list.html#AdjacencyListCollection.sort_key"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.sort_key" title="Permalink to this definition">¶</a></dt>
<dd><p>The sort key with which the items are sorted into their siblings.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.query">
<code class="descname">query</code><span class="sig-paren">(</span><em>ordered=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/adjacency_list.html#AdjacencyListCollection.query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.query" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a query using
<code class="xref py py-attr docutils literal"><span class="pre">AdjacencyListCollection.__listclass__</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.by_id">
<code class="descname">by_id</code><span class="sig-paren">(</span><em>item_id</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/adjacency_list.html#AdjacencyListCollection.by_id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.by_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given page id and returns the page. Try to keep this
id away from the public. It’s not a security problem if it leaks, but
it’s not something the public can necessarly count on.</p>
<p>If possible use the path instead.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.by_path">
<code class="descname">by_path</code><span class="sig-paren">(</span><em>path</em>, <em>ensure_type=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/adjacency_list.html#AdjacencyListCollection.by_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.by_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a path and returns the page associated with it.</p>
<p>For example, given this hierarchy:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Page</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;documents&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parent_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">Page</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;readme&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">parent_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Page</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;license&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">parent_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>The following query would return the Page with the name ‘license’:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">paths</span><span class="o">.</span><span class="n">by_path</span><span class="p">(</span><span class="s1">&#39;documents/license&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Slashes at the beginning or end are ignored, so the above is equal to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">paths</span><span class="o">.</span><span class="n">by_path</span><span class="p">(</span><span class="s1">&#39;/documents/license&#39;</span><span class="p">)</span>
<span class="n">paths</span><span class="o">.</span><span class="n">by_path</span><span class="p">(</span><span class="s1">&#39;/documents/license/&#39;</span><span class="p">)</span>
<span class="n">paths</span><span class="o">.</span><span class="n">by_path</span><span class="p">(</span><span class="s1">&#39;documents/license/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Lookups by path are currently quite wasteful. To get the root of
a page nested deeply one has to walk the ascendants of the page one by
one, triggering a number of queries.</p>
<p>Should this actually become a bottleneck (it might be fine), we should
probably implement a materialized view that is updated whenever a page
changes.</p>
<p>See:</p>
<p><cite>&lt;http://schinckel.net/2014/11/22/        postgres-tree-shootout-part-1%3A-introduction./&gt;</cite></p>
<p><cite>&lt;http://schinckel.net/2014/11/27/        postgres-tree-shootout-part-2%3A-adjacency-list-using-ctes/&gt;</cite></p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.get_unique_child_name">
<code class="descname">get_unique_child_name</code><span class="sig-paren">(</span><em>name</em>, <em>parent</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/adjacency_list.html#AdjacencyListCollection.get_unique_child_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.get_unique_child_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given name or title, normalizes it and makes sure
that it’s unique among the siblings of the item.</p>
<p>This is achieved by adding numbers at the end if there are overlaps.</p>
<p>For example, <code class="docutils literal"><span class="pre">root</span></code> becomes <code class="docutils literal"><span class="pre">root-1</span></code> if <code class="docutils literal"><span class="pre">root</span></code> exists. <code class="docutils literal"><span class="pre">root-2</span></code>
if <code class="docutils literal"><span class="pre">root-1</span></code> exists and so on.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.add">
<code class="descname">add</code><span class="sig-paren">(</span><em>parent</em>, <em>title</em>, <em>name=None</em>, <em>type=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/adjacency_list.html#AdjacencyListCollection.add"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a page to the given parent.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.delete">
<code class="descname">delete</code><span class="sig-paren">(</span><em>page</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/adjacency_list.html#AdjacencyListCollection.delete"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes the given page and <em>all</em> it’s desecendants!.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.move">
<code class="descname">move</code><span class="sig-paren">(</span><em>subject</em>, <em>target</em>, <em>direction</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/adjacency_list.html#AdjacencyListCollection.move"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.adjacency_list.AdjacencyListCollection.move" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given subject and moves it somehwere in relation to the
target.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Subject:</th><td class="field-body">The item to be moved.</td>
</tr>
<tr class="field-even field"><th class="field-name">Target:</th><td class="field-body">The item above which or below which the subject is moved.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Direction:</th><td class="field-body">The direction relative to the target. Either
<a class="reference internal" href="#onegov.core.orm.abstract.adjacency_list.MoveDirection.above" title="onegov.core.orm.abstract.adjacency_list.MoveDirection.above"><code class="xref py py-attr docutils literal"><span class="pre">MoveDirection.above</span></code></a> if the subject should be moved
above the target, or <a class="reference internal" href="#onegov.core.orm.abstract.adjacency_list.MoveDirection.below" title="onegov.core.orm.abstract.adjacency_list.MoveDirection.below"><code class="xref py py-attr docutils literal"><span class="pre">MoveDirection.below</span></code></a> if the subject
should be moved below the target.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-onegov.core.orm.abstract.associable"></span><p>Generic associations are an interesting SQLAlchemy design pattern
that allow for collections of records to be attached to other models by
mere inheritance.</p>
<p>Generic associations are useful in situations where a model should be
attachable to a number of third-party models. For example, we might say that
a comment model should be attacheable to any other model (say a page or a
ticket). In such an instance generic associations offer the benefit of
being simple to integrate on the third-party model.</p>
<p>Additionally we can define generic methods that work on all third-party
models that inherit from the associated model (in our example imagine a
“Commentable” class that leads to the automatic attachment of comments to
Page/Ticket models).</p>
<p>See also:
<a class="reference external" href="https://github.com/zzzeek/sqlalchemy/blob/master/examples/">https://github.com/zzzeek/sqlalchemy/blob/master/examples/</a>
generic_associations/table_per_association.py</p>
<p>Note that you do not want to use these associations in lieue of simple
relationships between two models. The standard way of doing this leads to a
strong relationship on the database and is easier to change and reason about.</p>
<p>Generic associations are meant for generic usecases. These currently include
payments (any model may be payable) and files (any model may have files
attached). Other generic associations should be introduced along these
lines.</p>
<p>A single model may be associated to any number of other models. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>                        ┌─────────────┐
                  ┌─────│ Reservation │
┌────────────┐    │     └─────────────┘
│  Payment   │◀───┤
└────────────┘    │     ┌─────────────┐
                  └─────│    Form     │
                        └─────────────┘
</pre></div>
</div>
<p>Here, <code class="docutils literal"><span class="pre">Payment</span></code> is associable (through the <code class="docutils literal"><span class="pre">Payable</span></code> mixin).
<code class="docutils literal"><span class="pre">Reservation</span></code> and <code class="docutils literal"><span class="pre">Form</span></code> in turn inherit from <code class="docutils literal"><span class="pre">Payable</span></code>.</p>
<p>This all is probably best understood in an example:</p>
<blockquote>
<div><dl class="docutils">
<dt>class Payment(Base, Associable):</dt>
<dd>__tablename__ == ‘payments’</dd>
<dt>class Payable(object):</dt>
<dd>payment = associated(Address, ‘address’, ‘one-to-one’)</dd>
<dt>class Product(Base, Payable):</dt>
<dd>__tablename__ == ‘products’</dd>
</dl>
</div></blockquote>
<p>This results in a product model which has a payment attribute attached to it.
The payments are stored in the <code class="docutils literal"><span class="pre">payments</span></code> table, products in the <code class="docutils literal"><span class="pre">products</span></code>
table. The link between the two is established in the automatically created
<code class="docutils literal"><span class="pre">payments_for_products</span></code> table.</p>
<dl class="function">
<dt id="onegov.core.orm.abstract.associable.associated">
<code class="descclassname">onegov.core.orm.abstract.associable.</code><code class="descname">associated</code><span class="sig-paren">(</span><em>associated_cls</em>, <em>attribute_name</em>, <em>cardinality='one-to-many'</em>, <em>uselist='auto'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/associable.html#associated"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.associable.associated" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an associated attribute. This attribute is supposed to be
defined on the mixin class that will establish the generic association
if inherited by a model.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>associated_cls</strong> – The class which the model will be associated with.</li>
<li><strong>attribute_name</strong> – The name of the attribute used on the mixin class.</li>
<li><strong>cardinality</strong> – May be ‘one-to-one’, ‘one-to-many’ or ‘many-to-many’. Cascades are
used automatically, unless ‘many-to-many’ is used, in which case
cascades are disabled.</li>
<li><strong>uselist</strong> – True if the attribute on the inheriting model is a list. Use ‘auto’
if this should be automatically decided depending on the cardinality.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Adress</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">Associable</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Addressable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">associated</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="s1">&#39;one-to-one&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">Addressable</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="onegov.core.orm.abstract.associable.Associable">
<em class="property">class </em><code class="descclassname">onegov.core.orm.abstract.associable.</code><code class="descname">Associable</code><a class="reference internal" href="_modules/onegov/core/orm/abstract/associable.html#Associable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.associable.Associable" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin to enable associations on a model. Only models which are
associable may be targeted by <a href="#id3"><span class="problematic" id="id4">:func:`associated`_</span></a></p>
<dl class="classmethod">
<dt id="onegov.core.orm.abstract.associable.Associable.association_base">
<em class="property">classmethod </em><code class="descname">association_base</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/associable.html#Associable.association_base"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.associable.Associable.association_base" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the model which directly inherits from Associable.</p>
</dd></dl>

<dl class="classmethod">
<dt id="onegov.core.orm.abstract.associable.Associable.register_link">
<em class="property">classmethod </em><code class="descname">register_link</code><span class="sig-paren">(</span><em>link_name</em>, <em>linked_class</em>, <em>table</em>, <em>key</em>, <em>attribute</em>, <em>cardinality</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/abstract/associable.html#Associable.register_link"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.abstract.associable.Associable.register_link" title="Permalink to this definition">¶</a></dt>
<dd><p>All associated classes are registered through this method. This
yields the following benefits:</p>
<ol class="arabic simple">
<li>We gain the ability to query all the linked records in one query.
This is hard otherwise as each <code class="docutils literal"><span class="pre">Payable</span></code> class leads to its own
association table which needs to be queried separately.</li>
<li>We are able to reset all created backreferences. This is necessary
during tests. SQLAlchemy keeps these references around and won’t
let us re-register the same model multiple times (which outside
of tests is completely reasonable).</li>
</ol>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.abstract.associable.Associable.links">
<code class="descname">links</code><a class="headerlink" href="#onegov.core.orm.abstract.associable.Associable.links" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a query chain with all records of all models which attach
to the associable model.</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-onegov.core.orm.mixins"></span><dl class="function">
<dt id="onegov.core.orm.mixins.content_property">
<code class="descclassname">onegov.core.orm.mixins.</code><code class="descname">content_property</code><span class="sig-paren">(</span><em>name</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#onegov.core.orm.mixins.content_property" title="Permalink to this definition">¶</a></dt>
<dd><p>Enables access of dictionaries through properties.</p>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meta_property</span> <span class="o">=</span> <span class="n">dictionary_based_property_factory</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">ContentMixin</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">meta_property</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will add a content getter, setter and deleter bound, which all
proxy to meta[‘content’].</p>
<p>Since this is just a thin wrapper around python’s property we can also
override the setter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">ContentMixin</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">meta_property</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>

    <span class="nd">@content</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">set_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;content_html&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_html</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@content</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">del_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;content_html&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>meta_property and content_property, to access the
<a class="reference internal" href="#onegov.core.orm.mixins.ContentMixin" title="onegov.core.orm.mixins.ContentMixin"><code class="xref py py-class docutils literal"><span class="pre">ContentMixin</span></code></a>’s dictionaries are defined in this file.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.orm.mixins.ContentMixin">
<em class="property">class </em><code class="descclassname">onegov.core.orm.mixins.</code><code class="descname">ContentMixin</code><a class="reference internal" href="_modules/onegov/core/orm/mixins/content.html#ContentMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.mixins.ContentMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin providing a meta/content JSON pair. Meta is a JSON column loaded
with each request, content is a JSON column loaded deferred (to be shown
only in the detail view).</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.orm.mixins.data_property">
<code class="descclassname">onegov.core.orm.mixins.</code><code class="descname">data_property</code><span class="sig-paren">(</span><em>name</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#onegov.core.orm.mixins.data_property" title="Permalink to this definition">¶</a></dt>
<dd><p>Enables access of dictionaries through properties.</p>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meta_property</span> <span class="o">=</span> <span class="n">dictionary_based_property_factory</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">ContentMixin</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">meta_property</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will add a content getter, setter and deleter bound, which all
proxy to meta[‘content’].</p>
<p>Since this is just a thin wrapper around python’s property we can also
override the setter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">ContentMixin</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">meta_property</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>

    <span class="nd">@content</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">set_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;content_html&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_html</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@content</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">del_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;content_html&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>meta_property and content_property, to access the
<a class="reference internal" href="#onegov.core.orm.mixins.ContentMixin" title="onegov.core.orm.mixins.ContentMixin"><code class="xref py py-class docutils literal"><span class="pre">ContentMixin</span></code></a>’s dictionaries are defined in this file.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.orm.mixins.meta_property">
<code class="descclassname">onegov.core.orm.mixins.</code><code class="descname">meta_property</code><span class="sig-paren">(</span><em>name</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#onegov.core.orm.mixins.meta_property" title="Permalink to this definition">¶</a></dt>
<dd><p>Enables access of dictionaries through properties.</p>
<p>Usage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meta_property</span> <span class="o">=</span> <span class="n">dictionary_based_property_factory</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">ContentMixin</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">meta_property</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will add a content getter, setter and deleter bound, which all
proxy to meta[‘content’].</p>
<p>Since this is just a thin wrapper around python’s property we can also
override the setter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">ContentMixin</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">meta_property</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>

    <span class="nd">@content</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">set_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;content_html&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_html</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@content</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">del_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;content_html&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>meta_property and content_property, to access the
<a class="reference internal" href="#onegov.core.orm.mixins.ContentMixin" title="onegov.core.orm.mixins.ContentMixin"><code class="xref py py-class docutils literal"><span class="pre">ContentMixin</span></code></a>’s dictionaries are defined in this file.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.orm.mixins.TimestampMixin">
<em class="property">class </em><code class="descclassname">onegov.core.orm.mixins.</code><code class="descname">TimestampMixin</code><a class="reference internal" href="_modules/onegov/core/orm/mixins/timestamp.html#TimestampMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.mixins.TimestampMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin providing created/modified timestamps for all records.</p>
<p>The columns are deferred loaded as this is primarily for logging and future
forensics.</p>
<dl class="method">
<dt id="onegov.core.orm.mixins.TimestampMixin.force_update">
<code class="descname">force_update</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/mixins/timestamp.html#TimestampMixin.force_update"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.mixins.TimestampMixin.force_update" title="Permalink to this definition">¶</a></dt>
<dd><p>Forces the model to update by changing the modified parameter.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.orm.mixins.TimestampMixin.last_change">
<code class="descname">last_change</code><a class="headerlink" href="#onegov.core.orm.mixins.TimestampMixin.last_change" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the self.modified if not NULL, else self.created.</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-onegov.core.orm.types"></span><dl class="class">
<dt id="onegov.core.orm.types.HSTORE">
<em class="property">class </em><code class="descclassname">onegov.core.orm.types.</code><code class="descname">HSTORE</code><span class="sig-paren">(</span><em>text_type=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/types/hstore_type.html#HSTORE"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.types.HSTORE" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends the default HSTORE type to make it mutable by default.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.orm.types.JSON">
<em class="property">class </em><code class="descclassname">onegov.core.orm.types.</code><code class="descname">JSON</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/types/json_type.html#JSON"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.types.JSON" title="Permalink to this definition">¶</a></dt>
<dd><p>A JSONB based type that coerces None’s to empty dictionaries.</p>
<p>That is, this JSONB column does not have NULL values, it only has
falsy values (an empty dict).</p>
<dl class="attribute">
<dt id="onegov.core.orm.types.JSON.impl">
<code class="descname">impl</code><a class="headerlink" href="#onegov.core.orm.types.JSON.impl" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal"><span class="pre">JSONB</span></code></p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="onegov.core.orm.types.UTCDateTime">
<em class="property">class </em><code class="descclassname">onegov.core.orm.types.</code><code class="descname">UTCDateTime</code><a class="reference internal" href="_modules/onegov/core/orm/types/utcdatetime_type.html#UTCDateTime"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.types.UTCDateTime" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores dates as UTC.</p>
<p>Internally, they are stored as timezone naive, because Postgres takes
the local timezone into account when working with timezones. Values taken
and values returned are forced to be timezone-aware though.</p>
<dl class="attribute">
<dt id="onegov.core.orm.types.UTCDateTime.impl">
<code class="descname">impl</code><a class="headerlink" href="#onegov.core.orm.types.UTCDateTime.impl" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal"><span class="pre">DateTime</span></code></p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="onegov.core.orm.types.UUID">
<em class="property">class </em><code class="descclassname">onegov.core.orm.types.</code><code class="descname">UUID</code><span class="sig-paren">(</span><em>as_uuid=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/types/uuid_type.html#UUID"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.types.UUID" title="Permalink to this definition">¶</a></dt>
<dd><p>The UUID type used throughout OneGov. The base is always the UUID type
defined by SQLAlchemy for Postgres, but we change the default to actually
handle the values as uuid.UUID values.</p>
<p>Another approach could be the following:</p>
<p><a class="reference external" href="https://github.com/seantis/libres/blob/master/libres/db/models/types/uuid_type.py">https://github.com/seantis/libres/blob/master/libres/db/models/types/uuid_type.py</a></p>
<p>We can switch to this any time.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.orm.types.LowercaseText">
<em class="property">class </em><code class="descclassname">onegov.core.orm.types.</code><code class="descname">LowercaseText</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/orm/types/lowercase_text_type.html#LowercaseText"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.orm.types.LowercaseText" title="Permalink to this definition">¶</a></dt>
<dd><p>Text column that forces all text to be lowercase.</p>
<dl class="attribute">
<dt id="onegov.core.orm.types.LowercaseText.impl">
<code class="descname">impl</code><a class="headerlink" href="#onegov.core.orm.types.LowercaseText.impl" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal"><span class="pre">TEXT</span></code></p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-onegov.core.cache">
<span id="cache"></span><h2>Cache<a class="headerlink" href="#module-onegov.core.cache" title="Permalink to this headline">¶</a></h2>
<p>Provides caching methods for onegov.core.</p>
<p>Onegov.core uses dogpile for caching:
<a class="reference external" href="https://dogpilecache.readthedocs.org/">https://dogpilecache.readthedocs.org/</a></p>
<p>Unlike dogpile onegov.core does not provide a global region however.
The cache is available through the app:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Global caches in a multi-tennant application are a security vulnerability
waiting to be discovered. Therefore we do not do that!</p>
<p>This means that this won’t be available:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">x</span> <span class="k">import</span> <span class="n">cache</span>
<span class="nd">@cache</span><span class="o">.</span><span class="n">cache_on_arguments</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;foobar&#39;</span>
</pre></div>
</div>
<p>Syntactic sugar like this will be provided through decorators inside this
module in the future. For example, we could write one that is usable
on all morepath views:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@App</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="nd">@cache</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;&lt;html&gt;...&#39;</span>
</pre></div>
</div>
<p>But no such method exists yet.</p>
<p>Currently there is one cache per app that never expires (though values will
eventually be discarded by memcache if the cache is full).</p>
<dl class="class">
<dt id="onegov.core.cache.MemcachedBackend">
<em class="property">class </em><code class="descclassname">onegov.core.cache.</code><code class="descname">MemcachedBackend</code><span class="sig-paren">(</span><em>arguments</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cache.html#MemcachedBackend"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cache.MemcachedBackend" title="Permalink to this definition">¶</a></dt>
<dd><p>A custom memcached backend with the following improvements:</p>
<ul class="simple">
<li>Uses dill instead of pickle, allowing for a wider range of cached objs.</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="onegov.core.cache.DillPickler">
<em class="property">class </em><code class="descclassname">onegov.core.cache.</code><code class="descname">DillPickler</code><span class="sig-paren">(</span><em>file</em>, <em>protocol=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cache.html#DillPickler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cache.DillPickler" title="Permalink to this definition">¶</a></dt>
<dd><p>A python-memcached pickler that uses dill instead of the builtin
pickle module.</p>
<p>Dill is an alternative implementation that supports a wider variety
of objects which it can pickle.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.cache.MemoryBackend">
<em class="property">class </em><code class="descclassname">onegov.core.cache.</code><code class="descname">MemoryBackend</code><span class="sig-paren">(</span><em>arguments</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cache.html#MemoryBackend"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cache.MemoryBackend" title="Permalink to this definition">¶</a></dt>
<dd><p>A custom memory backend that uses dill to pickle values into a
dictionary. This has the added benefit of using the same codepath as the
memcached based backend, without actually requiring a memcached server.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.cache.IgnoreUnreachableBackend">
<em class="property">class </em><code class="descclassname">onegov.core.cache.</code><code class="descname">IgnoreUnreachableBackend</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cache.html#IgnoreUnreachableBackend"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cache.IgnoreUnreachableBackend" title="Permalink to this definition">¶</a></dt>
<dd><p>A proxy backend that logs an error when memcached is down, but keeps
running, albeit without using any caching.</p>
<p>The idea is that a memcached outage will result in a slower/degraded
user experience, not in complete breakage.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.browser_session">
<span id="browser-session"></span><h2>Browser Session<a class="headerlink" href="#module-onegov.core.browser_session" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="onegov.core.browser_session.BrowserSession">
<em class="property">class </em><code class="descclassname">onegov.core.browser_session.</code><code class="descname">BrowserSession</code><span class="sig-paren">(</span><em>namespace</em>, <em>token</em>, <em>cache</em>, <em>on_dirty=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/browser_session.html#BrowserSession"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.browser_session.BrowserSession" title="Permalink to this definition">¶</a></dt>
<dd><p>A session bound to a token (session_id cookie). Used to store data
about a client on the server.</p>
<p>Instances should be called <code class="docutils literal"><span class="pre">browser_session</span></code> to make sure we don’t
confuse this with the orm sessions.</p>
<p>Used by <a class="reference internal" href="#onegov.core.request.CoreRequest" title="onegov.core.request.CoreRequest"><code class="xref py py-class docutils literal"><span class="pre">onegov.core.request.CoreRequest</span></code></a>.</p>
<p>Example:</p>
<blockquote>
<div>browser_session = request.browser_session
browser_session.name = ‘Foo’
assert client.session.name == ‘Foo’
del client.session.name</div></blockquote>
<p>This class can act like an object, through attribute access, or like a
dict, through square brackets. Whatever you prefer.</p>
<dl class="method">
<dt id="onegov.core.browser_session.BrowserSession.mangle">
<code class="descname">mangle</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/browser_session.html#BrowserSession.mangle"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.browser_session.BrowserSession.mangle" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given name and returns a key bound to the namespace and
token.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.browser_session.BrowserSession.has">
<code class="descname">has</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/browser_session.html#BrowserSession.has"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.browser_session.BrowserSession.has" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if the given name exists in the cache.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-onegov.core.i18n">
<span id="internationalization-i18n"></span><h2>Internationalization (i18n)<a class="headerlink" href="#module-onegov.core.i18n" title="Permalink to this headline">¶</a></h2>
<p>Provides tools and methods for internationalization (i18n).</p>
<p>Applications wishing to use i18n need to define two settings:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">i18n.localedirs:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">A list of gettext locale directories. The first directory is considered
to be the main directory, all other directories are added to the
translation object as fallbacks.</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">i18n.default_locale:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body">The fallback locale that is used if no locale more suitable to the user
could be found.</td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onegov.core.framework</span> <span class="k">import</span> <span class="n">Framework</span>
<span class="kn">from</span> <span class="nn">onegov.core</span> <span class="k">import</span> <span class="n">utils</span>

<span class="k">class</span> <span class="nc">App</span><span class="p">(</span><span class="n">Framework</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@TownApp</span><span class="o">.</span><span class="n">setting</span><span class="p">(</span><span class="n">section</span><span class="o">=</span><span class="s1">&#39;i18n&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;localedirs&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_i18n_localedirs</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">module_path</span><span class="p">(</span><span class="s1">&#39;onegov.town&#39;</span><span class="p">,</span> <span class="s1">&#39;locale&#39;</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">module_path</span><span class="p">(</span><span class="s1">&#39;onegov.form&#39;</span><span class="p">,</span> <span class="s1">&#39;locale&#39;</span><span class="p">)</span>
    <span class="p">]</span>

<span class="nd">@TownApp</span><span class="o">.</span><span class="n">setting</span><span class="p">(</span><span class="n">section</span><span class="o">=</span><span class="s1">&#39;i18n&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;default_locale&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_i18n_default_locale</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;en&#39;</span>
</pre></div>
</div>
<dl class="function">
<dt id="onegov.core.i18n.get_i18n_localedirs">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">get_i18n_localedirs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#get_i18n_localedirs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.get_i18n_localedirs" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the gettext locale dir.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.i18n.get_i18n_locales">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">get_i18n_locales</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#get_i18n_locales"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.get_i18n_locales" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the the locales actually used.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.i18n.get_i18n_default_locale">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">get_i18n_default_locale</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#get_i18n_default_locale"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.get_i18n_default_locale" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the fallback language to use if the user gives no indication
towards his preference (throught the request or anything).</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.i18n.get_i18n_locale_negotiatior">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">get_i18n_locale_negotiatior</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#get_i18n_locale_negotiatior"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.get_i18n_locale_negotiatior" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the language negotiator, which is a function that takes the
current request as well as a list of available languages and returns the
angauge that should be used based on that information.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.i18n.default_locale_negotiator">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">default_locale_negotiator</code><span class="sig-paren">(</span><em>locales</em>, <em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#default_locale_negotiator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.default_locale_negotiator" title="Permalink to this definition">¶</a></dt>
<dd><p>The default locale negotiator.</p>
<p>Will select one of the given locales by:</p>
<ol class="arabic simple">
<li>Examining the ‘locale’ cookie which will be preferred if the
language in the cookie actually exists</li>
<li>Selecting the best match from the accept_language header</li>
</ol>
<p>If no match can be found, None is returned. It is the job of caller to
deal with that (possibly getting <a class="reference internal" href="#onegov.core.i18n.get_i18n_default_locale" title="onegov.core.i18n.get_i18n_default_locale"><code class="xref py py-meth docutils literal"><span class="pre">get_i18n_default_locale()</span></code></a>).</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.i18n.pofiles">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">pofiles</code><span class="sig-paren">(</span><em>localedir</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#pofiles"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.pofiles" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given directory and yields the language and the path of
all pofiles found under <code class="docutils literal"><span class="pre">*/LC_MESSAGES/*.po</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.i18n.get_translations">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">get_translations</code><span class="sig-paren">(</span><em>localedirs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#get_translations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.get_translations" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given gettext locale directories and loads the po files
found. The first found po file is assumed to be the main
translations file (and should for performance reasons contain most of the
translations). The other po files are added as fallbacks.</p>
<p>The pofiles are compiled on-the-fly, using polib. This makes mofiles
unnecessary.</p>
<p>Returns a dictionary with the keys being languages and the values being
GNUTranslations instances.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.i18n.wrap_translations_for_chameleon">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">wrap_translations_for_chameleon</code><span class="sig-paren">(</span><em>translations</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#wrap_translations_for_chameleon"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.wrap_translations_for_chameleon" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given translations and wraps them for use with Chameleon.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.i18n.add_fallback_to_tail">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">add_fallback_to_tail</code><span class="sig-paren">(</span><em>translation</em>, <em>fallback</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#add_fallback_to_tail"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.add_fallback_to_tail" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds the given fallback to the given translation, if it isn’t already
found somewhere in the fallback chain.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.i18n.get_translation_bound_meta">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">get_translation_bound_meta</code><span class="sig-paren">(</span><em>meta_class</em>, <em>translate</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#get_translation_bound_meta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.get_translation_bound_meta" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a wtforms Meta class and combines our translate class with
the one provided by WTForms itself.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.i18n.get_translation_bound_form">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">get_translation_bound_form</code><span class="sig-paren">(</span><em>form_class</em>, <em>translate</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#get_translation_bound_form"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.get_translation_bound_form" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a form setup with the given translate function.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.i18n.merge">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">merge</code><span class="sig-paren">(</span><em>translations</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#merge"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given translations (a list) and merges them into
each other. The translations at the end of the list are overwritten
by the translations at the start of the list.</p>
<p>This is preferrable to adding fallbacks, as they increases the average
complexity of the lookup function each time.</p>
<p>Note that the translations are <em>not</em> copied before merging, so that means
all existing translations are changed during this processed. To avoid
this, clone the translation first (see <a class="reference internal" href="#onegov.core.i18n.clone" title="onegov.core.i18n.clone"><code class="xref py py-func docutils literal"><span class="pre">clone()</span></code></a>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The last GNUTranslations object with all other translation
objects merged into it. The first element overrides the second and so
on.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onegov.core.i18n.clone">
<code class="descclassname">onegov.core.i18n.</code><code class="descname">clone</code><span class="sig-paren">(</span><em>translation</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#clone"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.clone" title="Permalink to this definition">¶</a></dt>
<dd><p>Clones the given translation, creating an independent copy.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.i18n.SiteLocale">
<em class="property">class </em><code class="descclassname">onegov.core.i18n.</code><code class="descname">SiteLocale</code><span class="sig-paren">(</span><em>locale</em>, <em>to</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/i18n.html#SiteLocale"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.i18n.SiteLocale" title="Permalink to this definition">¶</a></dt>
<dd><p>A model representing the locale of the site.</p>
<p>Use this model to enable the user to change his locale through a path.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.templates">
<span id="templating-chameleon"></span><h2>Templating (Chameleon)<a class="headerlink" href="#module-onegov.core.templates" title="Permalink to this headline">¶</a></h2>
<p>Integrates the Chameleon template language.</p>
<p>This is basically a copy of more.chameleon, with the additional inclusion of a
gettext translation function defined by <a class="reference internal" href="#module-onegov.core.i18n" title="onegov.core.i18n"><code class="xref py py-mod docutils literal"><span class="pre">onegov.core.i18n</span></code></a>.</p>
<p>To use a chameleon template, applications have to specify the templates
directiory, in addition to inheriting from
<a class="reference internal" href="#onegov.core.framework.Framework" title="onegov.core.framework.Framework"><code class="xref py py-class docutils literal"><span class="pre">onegov.core.framework.Framework</span></code></a>.</p>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onegov.core.framework</span> <span class="k">import</span> <span class="n">Framework</span>

<span class="k">class</span> <span class="nc">App</span><span class="p">(</span><span class="n">Framework</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@App</span><span class="o">.</span><span class="n">template_directory</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_template_directory</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;templates&#39;</span>

<span class="nd">@App</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">Root</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@App</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">Root</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="s1">&#39;index.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Title&#39;</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The folder can either be a directory relative to the app class or an absolute
path.</p>
<dl class="class">
<dt id="onegov.core.templates.TemplateLoader">
<em class="property">class </em><code class="descclassname">onegov.core.templates.</code><code class="descname">TemplateLoader</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/templates.html#TemplateLoader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.templates.TemplateLoader" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends the default page template loader with the ability to
lookup macros in various folders.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.templates.MacrosLookup">
<em class="property">class </em><code class="descclassname">onegov.core.templates.</code><code class="descname">MacrosLookup</code><span class="sig-paren">(</span><em>search_paths</em>, <em>name='macros.pt'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/templates.html#MacrosLookup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.templates.MacrosLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a list of search paths and provides a lookup for macros.</p>
<p>This means that when a macro is access through this lookup, it will travel
up the search path of the template loader, to look for the macro and
return with the first match.</p>
<p>As a result, it is possible to have a macros.pt file in each search path
and have them act as if they were one file, with macros further up the
list of paths having precedence over the macros further down the path.</p>
<p>For example, given the search paths ‘foo’ and ‘bar’, foo/macros.pt could
define ‘users’ and ‘page’, while bar/macros.pt could define ‘users’ and
‘site’. In the lookup this would result in ‘users’ and ‘page’ being loaded
loaded from foo and ‘site’ being loaded from bar.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.templates.get_template_loader">
<code class="descclassname">onegov.core.templates.</code><code class="descname">get_template_loader</code><span class="sig-paren">(</span><em>template_directories</em>, <em>settings</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/templates.html#get_template_loader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.templates.get_template_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the Chameleon template loader for templates with the extension
<code class="docutils literal"><span class="pre">.pt</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.templates.get_chameleon_render">
<code class="descclassname">onegov.core.templates.</code><code class="descname">get_chameleon_render</code><span class="sig-paren">(</span><em>loader</em>, <em>name</em>, <em>original_render</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/templates.html#get_chameleon_render"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.templates.get_chameleon_render" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the Chameleon template renderer for the required template.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.templates.render_template">
<code class="descclassname">onegov.core.templates.</code><code class="descname">render_template</code><span class="sig-paren">(</span><em>template</em>, <em>request</em>, <em>content</em>, <em>suppress_global_variables='infer'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/templates.html#render_template"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.templates.render_template" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders the given template. Use this if you need to get the rendered
value directly. If oyu render a view, this is not needed!</p>
<p>By default, mail templates (templates strting with ‘<a class="reference internal" href="#mail">mail</a>’) skip the
inclusion of global variables defined through the template_variables
directive.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.templates.render_macro">
<code class="descclassname">onegov.core.templates.</code><code class="descname">render_macro</code><span class="sig-paren">(</span><em>macro</em>, <em>request</em>, <em>content</em>, <em>suppress_global_variables=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/templates.html#render_macro"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.templates.render_macro" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders a <code class="xref py py-class docutils literal"><span class="pre">chameleon.zpt.template.Macro</span></code> like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">layout</span><span class="o">.</span><span class="n">render_macro</span><span class="p">(</span><span class="n">layout</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="s1">&#39;my_macro&#39;</span><span class="p">],</span> <span class="o">**</span><span class="nb">vars</span><span class="p">)</span>
</pre></div>
</div>
<p>This code is basically a stripped down version of this:
<a class="reference external" href="https://github.com/malthe/chameleon/blob/257c9192fea4b158215ecc4f84e1249d4b088753/src/chameleon/zpt/template.py#L206">https://github.com/malthe/chameleon/blob/257c9192fea4b158215ecc4f84e1249d4b088753/src/chameleon/zpt/template.py#L206</a>.</p>
<p>As such it doesn’t treat chameleon like a black box and it will probably
fail one day in the future, if Chameleon is refactored. Our tests will
detect that though.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.locking">
<span id="distributed-locks"></span><h2>Distributed Locks<a class="headerlink" href="#module-onegov.core.locking" title="Permalink to this headline">¶</a></h2>
<p>Provides a distributed lock implementation using Postgres Advisory Locks
as a backend.</p>
<dl class="function">
<dt id="onegov.core.locking.lock">
<code class="descclassname">onegov.core.locking.</code><code class="descname">lock</code><span class="sig-paren">(</span><em>session</em>, <em>namespace</em>, <em>key</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/locking.html#lock"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.locking.lock" title="Permalink to this definition">¶</a></dt>
<dd><p>A context manager which creates a distributed lock on the database.</p>
<p>This is used to make sure that only one process at a time does something.
This is not limited to database work (in fact this would usually be
handled automatically). For example if multiple cronjobs are scheduled
to run at the same time, but you only want one to actually run on
the system on any given time, then you may use this lock.</p>
<p>The locks are bound to the session and are not relased automatically
if the current transaction is commited or rolled back. You don’t have
to worry about that though, the context manager releases all locks
it creates once it’s done.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Session:</th><td class="field-body">The session to use for locking. The same lock may be acquired multiple
times by the same session.</td>
</tr>
<tr class="field-even field"><th class="field-name">Namespace:</th><td class="field-body">The namespace of the lock (any string).</td>
</tr>
<tr class="field-odd field"><th class="field-name">Key:</th><td class="field-body">The key of the lock (any string). The namespace combined with the
key is used as the unique identifier which identifies the acquired
lock.</td>
</tr>
</tbody>
</table>
<p>If the lock cannot be acquired the contextmanager raises a
<code class="xref py py-class docutils literal"><span class="pre">AlreadyLockedError</span></code>.</p>
<p>By deafult sessions in onegov.core are bound to the thread as well as
the current database schema. Therefore the lock is bound to those too.</p>
<p>This is not a problem in practice however, as the request is bound the
same way. At worst this makes it harder to share the lock, which is not a
feature we are interested in. We want a guarantee that only one process or
thread at any given time is doing something using a lock. This works.</p>
<p>Example:</p>
<blockquote>
<div><dl class="docutils">
<dt>with lock(session, ‘cronjobs’, ‘send-email’):</dt>
<dd>pass  # send email</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="onegov.core.locking.get_lock_id">
<code class="descclassname">onegov.core.locking.</code><code class="descname">get_lock_id</code><span class="sig-paren">(</span><em>namespace</em>, <em>key</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/locking.html#get_lock_id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.locking.get_lock_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a lock id for the given namespace and key. The lock id is
an integer between -2**63 - 1 and 2**63 - 1 (signed 64bit int).</p>
<p>Because that leaves us with a rather small space to generate a unique
lock id from namespace and key we use two crc32 bit hashes and combine
them.</p>
<p>This still leaves us with a chance of duplicate locks. Since those strings
are static at this point we keep a list of existing locks around to
catch any such case during testing. If that ever happens we need to change
our strings.</p>
<p>Note: We can’t just use an incrementing counter because those strings
have to match up over multiple processes which wouldn’t necessarily
count up in the same order.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.cronjobs">
<span id="cronjobs"></span><h2>Cronjobs<a class="headerlink" href="#module-onegov.core.cronjobs" title="Permalink to this headline">¶</a></h2>
<p>Provides a way to specify cronjobs which should be called at an exact time.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@App</span><span class="o">.</span><span class="n">cronjob</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">timezone</span><span class="o">=</span><span class="s1">&#39;Europe/Zurich&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cleanup_stuff</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Functions registered like this will be called through a regular request. That
means they are just like any other view and have all the power associated with
it.</p>
<p>WARNING: The function is called ONCE for EACH application id. So at the given
time there might be a number of calls more or less at the same time, run
against your function.</p>
<p>In terms of operations this means that there should be more processes than
application ids (tennants). In terms of development this means that you
should keep the time spent in a cronjob to an absolute minimum! Long running
jobs (more than 30 seconds) are reported.</p>
<p>This feature should really be used sparingly and only for things where the
exact time is relevant. Cleanup jobs for example should be combined with
delete/update/add jobs for example, not pushed off to a cronjob.</p>
<p>We also make sure that there’s only one job each 5 minutes (at 00:00, 00:05,
and so on) and that there are no two jobs run at the same time.</p>
<p>For now cronjobs are furthermore limited to be run once a day. In the future
we might add a model more akin to classic cronjobs.</p>
<p>Finally note that cronjobs for any given application id are only run once the
first request to the application with that id has been made. The reason for
this is the fact that the background thread needs a real request to be
initialized.</p>
<dl class="class">
<dt id="onegov.core.cronjobs.Job">
<em class="property">class </em><code class="descclassname">onegov.core.cronjobs.</code><code class="descname">Job</code><span class="sig-paren">(</span><em>function</em>, <em>hour</em>, <em>minute</em>, <em>timezone</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cronjobs.html#Job"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cronjobs.Job" title="Permalink to this definition">¶</a></dt>
<dd><p>A single cron job.</p>
<dl class="attribute">
<dt id="onegov.core.cronjobs.Job.id">
<code class="descname">id</code><a class="headerlink" href="#onegov.core.cronjobs.Job.id" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal id signed by the application. Used to access the job
through an url which must be unguessable, but the same over many
processes.</p>
<p>The signature is only possible if <code class="docutils literal"><span class="pre">self.app</span></code> is present, which
can only be set after the instance has already been created.</p>
<p>See <a class="reference internal" href="#onegov.core.cronjobs.Job.as_request_call" title="onegov.core.cronjobs.Job.as_request_call"><code class="xref py py-meth docutils literal"><span class="pre">as_request_call()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.cronjobs.Job.as_request_call">
<code class="descname">as_request_call</code><span class="sig-paren">(</span><em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cronjobs.html#Job.as_request_call"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cronjobs.Job.as_request_call" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new job which does the same as the old job, but it does
so by calling an url which will execute the original job.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.cronjobs.Job.is_scheduled_at">
<code class="descname">is_scheduled_at</code><span class="sig-paren">(</span><em>point</em>, <em>timezone=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cronjobs.html#Job.is_scheduled_at"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cronjobs.Job.is_scheduled_at" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the job is scheduled to run at the given date.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Point:</th><td class="field-body">The point in time. Needs to be a timezone aware datetime object,
unless <code class="docutils literal"><span class="pre">timezone</span></code> is passed as well.</td>
</tr>
<tr class="field-even field"><th class="field-name">Timezone:</th><td class="field-body">Optional. If the passed date is not timezone aware, the date is
assumed to be from this timezone.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">True if the job is scheduled at this date. The maximum
resolution is one minute. That means if the date given
falls within the minute of the scheduled time it is assumed
to be a match (i.e anywhere within 0’ - 59‘999.99999)</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="onegov.core.cronjobs.ApplicationBoundCronjobs">
<em class="property">class </em><code class="descclassname">onegov.core.cronjobs.</code><code class="descname">ApplicationBoundCronjobs</code><span class="sig-paren">(</span><em>request</em>, <em>jobs</em>, <em>session_manager</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cronjobs.html#ApplicationBoundCronjobs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cronjobs.ApplicationBoundCronjobs" title="Permalink to this definition">¶</a></dt>
<dd><p>A daemon thread which runs the cronjobs it is given in the background.</p>
<p>The cronjobs are not actually run in the same thread. Instead a request to
the actual cronjob is made. This way the thread is pretty much limited to
basic IO work (GET request) and the actual cronjob is called with a normal
request.</p>
<p>Basically there is no difference between calling the url of the cronjob
at a scheduled time and using this cronjob.</p>
<p>This also avoids any and all locking problems as we don’t have to write
OneGov applications in a thread safe way. The actual work is always done
on the main thread.</p>
<p>Each application id is meant to have its own thread. To avoid extra
work we make sure that only one thread per application exists on each
server. This is accomplished by holding a postgres advisory lock during
the lifetime of the thread.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.cronjobs.get_job">
<code class="descclassname">onegov.core.cronjobs.</code><code class="descname">get_job</code><span class="sig-paren">(</span><em>app</em>, <em>id</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cronjobs.html#get_job"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cronjobs.get_job" title="Permalink to this definition">¶</a></dt>
<dd><p>The internal path to the cronjob. The id can’t be guessed.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.cronjobs.run_job">
<code class="descclassname">onegov.core.cronjobs.</code><code class="descname">run_job</code><span class="sig-paren">(</span><em>self</em>, <em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cronjobs.html#run_job"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cronjobs.run_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes the job.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.layout">
<span id="layout"></span><h2>Layout<a class="headerlink" href="#module-onegov.core.layout" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="onegov.core.layout.Layout">
<em class="property">class </em><code class="descclassname">onegov.core.layout.</code><code class="descname">Layout</code><span class="sig-paren">(</span><em>model</em>, <em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/layout.html#Layout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.layout.Layout" title="Permalink to this definition">¶</a></dt>
<dd><p>Contains useful methods related to rendering pages in html. Think of it
as an API that you can rely on in your templates.</p>
<p>The idea is to provide basic layout functions here, if they are usful for
any kind of html application. You should then extend the core layout
classes with your own.</p>
<dl class="attribute">
<dt id="onegov.core.layout.Layout.timezone">
<code class="descname">timezone</code><em class="property"> = &lt;DstTzInfo 'Europe/Zurich' BMT+0:30:00 STD&gt;</em><a class="headerlink" href="#onegov.core.layout.Layout.timezone" title="Permalink to this definition">¶</a></dt>
<dd><p>The timezone is currently fixed to ‘Europe/Zurich’ since all our
business with onegov is done here. Once the need arises, we should
lookup the timezone from the IP of the user, or use a javascript
library that sets the timezone for the user session.</p>
<p>There’s also going to be the case where we want the timezone set
specifically for a certain layout (say a reservation of a room, where
the room’s timezone is relevant). This is why this setting should
remain close to the layout, and not necessarily close to the request.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.layout.Layout.time_format">
<code class="descname">time_format</code><em class="property"> = 'HH:mm'</em><a class="headerlink" href="#onegov.core.layout.Layout.time_format" title="Permalink to this definition">¶</a></dt>
<dd><p>Just like the timezone, these values are fixed for Switzerland now,
though the non-numerical information is actually translated.
Format:
<a class="reference external" href="http://www.unicode.org/reports/tr35/tr35-39/tr35-dates.html">http://www.unicode.org/reports/tr35/tr35-39/tr35-dates.html</a>
#Date_Format_Patterns</p>
<p>Classes inheriting from <a class="reference internal" href="#onegov.core.layout.Layout" title="onegov.core.layout.Layout"><code class="xref py py-class docutils literal"><span class="pre">Layout</span></code></a> may add their own formats, as
long as they end in <code class="docutils literal"><span class="pre">_format</span></code>. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyLayout</span><span class="p">(</span><span class="n">Layout</span><span class="p">):</span>
    <span class="n">my_format</span> <span class="o">=</span> <span class="s1">&#39;dd.MMMM&#39;</span>

<span class="n">MyLayout</span><span class="p">()</span><span class="o">.</span><span class="n">format_date</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="s1">&#39;my&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>XXX this is not yet i18n and could be done better</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.layout.Layout.app">
<code class="descname">app</code><a class="headerlink" href="#onegov.core.layout.Layout.app" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the application behind the request.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.layout.Layout.chunks">
<code class="descname">chunks</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/layout.html#Layout.chunks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.layout.Layout.chunks" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#onegov.core.utils.chunks" title="onegov.core.utils.chunks"><code class="xref py py-func docutils literal"><span class="pre">onegov.core.utils.chunks()</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.layout.Layout.csrf_token">
<code class="descname">csrf_token</code><a class="headerlink" href="#onegov.core.layout.Layout.csrf_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a csrf token for use with DELETE links (forms do their
own thing automatically).</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.layout.Layout.csrf_protected_url">
<code class="descname">csrf_protected_url</code><span class="sig-paren">(</span><em>url</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/layout.html#Layout.csrf_protected_url"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.layout.Layout.csrf_protected_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a csrf token to the given url.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.layout.Layout.format_date">
<code class="descname">format_date</code><span class="sig-paren">(</span><em>dt</em>, <em>format</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/layout.html#Layout.format_date"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.layout.Layout.format_date" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a datetime and formats it according to local timezone and
the given format.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.layout.Layout.isodate">
<code class="descname">isodate</code><span class="sig-paren">(</span><em>date</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/layout.html#Layout.isodate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.layout.Layout.isodate" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the given date in the ISO 8601 format.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.layout.Layout.format_number">
<code class="descname">format_number</code><span class="sig-paren">(</span><em>number</em>, <em>decimal_places=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/layout.html#Layout.format_number"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.layout.Layout.format_number" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given numer and formats it according to locale.</p>
<p>If the number is an integer, the default decimal places are 0,
otherwise 2.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.layout.Layout.view_name">
<code class="descname">view_name</code><a class="headerlink" href="#onegov.core.layout.Layout.view_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the view name of the current view, or None if it is the
default view.</p>
<p>Note: This relies on morepath internals and is experimental in nature!</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="onegov.core.layout.ChameleonLayout">
<em class="property">class </em><code class="descclassname">onegov.core.layout.</code><code class="descname">ChameleonLayout</code><span class="sig-paren">(</span><em>model</em>, <em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/layout.html#ChameleonLayout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.layout.ChameleonLayout" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends the base layout class with methods related to chameleon
template rendering.</p>
<p>This class assumes the existance of two templates:</p>
<ul class="simple">
<li>layout.pt -&gt; Contains the page skeleton with headers, body and so on.</li>
<li>macros.pt -&gt; Contains chameleon macros.</li>
</ul>
<dl class="attribute">
<dt id="onegov.core.layout.ChameleonLayout.template_loader">
<code class="descname">template_loader</code><a class="headerlink" href="#onegov.core.layout.ChameleonLayout.template_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the chameleon template loader.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.layout.ChameleonLayout.base">
<code class="descname">base</code><a class="headerlink" href="#onegov.core.layout.ChameleonLayout.base" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layout, which defines the base layout of all town
pages. See <code class="docutils literal"><span class="pre">templates/layout.pt</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.layout.ChameleonLayout.macros">
<code class="descname">macros</code><a class="headerlink" href="#onegov.core.layout.ChameleonLayout.macros" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the macros, which offer often used html constructs.
See <code class="docutils literal"><span class="pre">templates/macros.pt</span></code>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-onegov.core.crypto">
<span id="crypto"></span><h2>Crypto<a class="headerlink" href="#module-onegov.core.crypto" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="onegov.core.crypto.hash_password">
<code class="descclassname">onegov.core.crypto.</code><code class="descname">hash_password</code><span class="sig-paren">(</span><em>password</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/crypto/password.html#hash_password"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.crypto.hash_password" title="Permalink to this definition">¶</a></dt>
<dd><p>The default password hashing algorithm used by onegov.</p>
<p>Over time the underlying algorithm may change, at which point
<a class="reference internal" href="#onegov.core.crypto.verify_password" title="onegov.core.crypto.verify_password"><code class="xref py py-meth docutils literal"><span class="pre">verify_password()</span></code></a> must issue a deprecation warning when using
the old algorithm.</p>
<p>Note that no salt is being passed, because the algorithm we use now
(bcrypt), as well as the algorithm that we might use in the future
(scrypt), generate their own salt automatically by default.</p>
<p>The salt is then stored in the resulting hash. That means that we do
not pass or store a salt ourselves.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.crypto.random_password">
<code class="descclassname">onegov.core.crypto.</code><code class="descname">random_password</code><span class="sig-paren">(</span><em>length=16</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/crypto/random.html#random_password"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.crypto.random_password" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a random password using the markov chain below.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.crypto.random_token">
<code class="descclassname">onegov.core.crypto.</code><code class="descname">random_token</code><span class="sig-paren">(</span><em>nbytes=512</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/crypto/token.html#random_token"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.crypto.random_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates an unguessable token. Generates a random string with
the given number of bytes (may not be lower than 512) and hashes
the result to get a token with a consistent length of 64.</p>
<p>Why hashing?</p>
<p>We could of course just create a random token with a length of 64, but that
would leak the random numbers we actually create. This can be a bit of
a problem if the random generator you use turns out to have some
vulnerability. By hashing a larger number we hide the result of our random
generator.</p>
<p>Doesn’t generating a hash from a larger number limit the number of tokens?</p>
<p>Yes it does. The number of different tokens is 2^256 after hashing,
which is a number larger than all the atoms on earth (approx. 2^166).
So there is a chance of a collision occuring, but it is <em>very</em> unlikely
to <em>ever</em> happen.</p>
<p>More information:</p>
<p><a class="reference external" href="http://wyattbaldwin.com/2014/01/09/generating-random-tokens-in-python">http://wyattbaldwin.com/2014/01/09/generating-random-tokens-in-python</a></p>
<p><a class="reference external" href="http://www.2uo.de/myths-about-urandom/">http://www.2uo.de/myths-about-urandom/</a></p>
<p><a class="reference external" href="http://crypto.stackexchange.com/q/1401">http://crypto.stackexchange.com/q/1401</a></p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.crypto.verify_password">
<code class="descclassname">onegov.core.crypto.</code><code class="descname">verify_password</code><span class="sig-paren">(</span><em>password</em>, <em>hash</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/crypto/password.html#verify_password"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.crypto.verify_password" title="Permalink to this definition">¶</a></dt>
<dd><p>Compares a password to a hash and returns true if they match according
to the hashing algorithm used.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.security.permissions">
<span id="security"></span><h2>Security<a class="headerlink" href="#module-onegov.core.security.permissions" title="Permalink to this headline">¶</a></h2>
<p>OneGov uses a very simple permissions model by default. There are no
read/write permissions, just intents. That means a permission shows the
intended audience.</p>
<p>This is the default however, any application building on top of onegov.core
may of course introduce its own byzantine permission system.</p>
<dl class="class">
<dt id="onegov.core.security.permissions.Public">
<em class="property">class </em><code class="descclassname">onegov.core.security.permissions.</code><code class="descname">Public</code><a class="reference internal" href="_modules/onegov/core/security/permissions.html#Public"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.security.permissions.Public" title="Permalink to this definition">¶</a></dt>
<dd><p>The general public is allowed to do this.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.security.permissions.Private">
<em class="property">class </em><code class="descclassname">onegov.core.security.permissions.</code><code class="descname">Private</code><a class="reference internal" href="_modules/onegov/core/security/permissions.html#Private"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.security.permissions.Private" title="Permalink to this definition">¶</a></dt>
<dd><p>Trusted people are allowed to do this.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.security.permissions.Personal">
<em class="property">class </em><code class="descclassname">onegov.core.security.permissions.</code><code class="descname">Personal</code><a class="reference internal" href="_modules/onegov/core/security/permissions.html#Personal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.security.permissions.Personal" title="Permalink to this definition">¶</a></dt>
<dd><p>Registered members are allowed to do this.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.security.permissions.Secret">
<em class="property">class </em><code class="descclassname">onegov.core.security.permissions.</code><code class="descname">Secret</code><a class="reference internal" href="_modules/onegov/core/security/permissions.html#Secret"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.security.permissions.Secret" title="Permalink to this definition">¶</a></dt>
<dd><p>Only Demi-Gods are allowed to do this.</p>
</dd></dl>

<span class="target" id="module-onegov.core.security.roles"></span><dl class="function">
<dt id="onegov.core.security.roles.get_roles_setting">
<code class="descclassname">onegov.core.security.roles.</code><code class="descname">get_roles_setting</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/security/roles.html#get_roles_setting"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.security.roles.get_roles_setting" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the default roles available to onegov.core applications.</p>
<p>Applications building on onegov.core may add more roles and permissions,
or replace the existing ones entirely, though it’s not something that
one should do carelessly.</p>
<p>The default roles are:</p>
<dl class="docutils">
<dt><strong>admin</strong></dt>
<dd>Has access to everything</dd>
<dt><strong>editor</strong></dt>
<dd>Has access to most things</dd>
<dt><strong>member</strong></dt>
<dd>Has access their own data. Be careful though, core doesn’t know about
personal data, so this is just a role to implement registered users.
As with all permissions, making sure the right information is shown
is up to the applications.</dd>
<dt><strong>anonymous</strong></dt>
<dd>Has access to public things</dd>
</dl>
</dd></dl>

<span class="target" id="module-onegov.core.security.rules"></span><dl class="function">
<dt id="onegov.core.security.rules.has_permission_not_logged_in">
<code class="descclassname">onegov.core.security.rules.</code><code class="descname">has_permission_not_logged_in</code><span class="sig-paren">(</span><em>app</em>, <em>identity</em>, <em>model</em>, <em>permission</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/security/rules.html#has_permission_not_logged_in"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.security.rules.has_permission_not_logged_in" title="Permalink to this definition">¶</a></dt>
<dd><p>This catch-all rule returns the default permission rule. It says
that the permission must be part of the anonymous rule.</p>
<p>Models with a ‘is_hidden_from_public’ property are not viewable by
anonymous users, if said property is set to True. If it is set to False,
the usual permission check kicks in.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.security.rules.has_permission_logged_in">
<code class="descclassname">onegov.core.security.rules.</code><code class="descname">has_permission_logged_in</code><span class="sig-paren">(</span><em>app</em>, <em>identity</em>, <em>model</em>, <em>permission</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/security/rules.html#has_permission_logged_in"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.security.rules.has_permission_logged_in" title="Permalink to this definition">¶</a></dt>
<dd><p>This permission rule matches all logged in identities. It requires
the identity to have a ‘role’ attribute. Said role attribute is used
to determine if the given permission is part of the given role.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.security.rules.may_view_http_errors_not_logged_in">
<code class="descclassname">onegov.core.security.rules.</code><code class="descname">may_view_http_errors_not_logged_in</code><span class="sig-paren">(</span><em>app</em>, <em>identity</em>, <em>model</em>, <em>permission</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/security/rules.html#may_view_http_errors_not_logged_in"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.security.rules.may_view_http_errors_not_logged_in" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP errors may be viewed by anyone, regardeless of settings.</p>
<p>This is important, otherwise the HTTPForbidden/HTTPNotFound views
will lead to an exception if the user does not have the <code class="docutils literal"><span class="pre">Public</span></code>
permission.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.security.rules.may_view_cronjobs_not_logged_in">
<code class="descclassname">onegov.core.security.rules.</code><code class="descname">may_view_cronjobs_not_logged_in</code><span class="sig-paren">(</span><em>app</em>, <em>identity</em>, <em>model</em>, <em>permission</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/security/rules.html#may_view_cronjobs_not_logged_in"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.security.rules.may_view_cronjobs_not_logged_in" title="Permalink to this definition">¶</a></dt>
<dd><p>Cronjobs are run anonymously from a thread and need to be excluded
from the permission rules as a result.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.collection">
<span id="collection"></span><h2>Collection<a class="headerlink" href="#module-onegov.core.collection" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="onegov.core.collection.Pagination">
<em class="property">class </em><code class="descclassname">onegov.core.collection.</code><code class="descname">Pagination</code><a class="reference internal" href="_modules/onegov/core/collection.html#Pagination"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.collection.Pagination" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides collections with pagination, if they implement a few
documented properties and methods.</p>
<p>See <code class="xref py py-class docutils literal"><span class="pre">onegov.ticket.TicketCollection</span></code> for an example.</p>
<dl class="method">
<dt id="onegov.core.collection.Pagination.subset">
<code class="descname">subset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/collection.html#Pagination.subset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.collection.Pagination.subset" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an SQLAlchemy query containing all records that should
be considered for pagination.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.collection.Pagination.page_index">
<code class="descname">page_index</code><a class="headerlink" href="#onegov.core.collection.Pagination.page_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the current page index (starting at 0).</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.collection.Pagination.page_by_index">
<code class="descname">page_by_index</code><span class="sig-paren">(</span><em>index</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/collection.html#Pagination.page_by_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.collection.Pagination.page_by_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the page at the given index. A page here means an instance
of the class inheriting from the <code class="docutils literal"><span class="pre">Pagination</span></code> base class.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.collection.Pagination.transform_batch_query">
<code class="descname">transform_batch_query</code><span class="sig-paren">(</span><em>query</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/collection.html#Pagination.transform_batch_query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.collection.Pagination.transform_batch_query" title="Permalink to this definition">¶</a></dt>
<dd><p>Allows subclasses to transform the given query before it is
used to retrieve the batch. This is a good place to add additional
loading that should only apply to the batch (say joining other
values to the batch which are then not loaded by the whole query).</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.collection.Pagination.subset_count">
<code class="descname">subset_count</code><a class="headerlink" href="#onegov.core.collection.Pagination.subset_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the total number of elements this pagination represents.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.collection.Pagination.batch">
<code class="descname">batch</code><a class="headerlink" href="#onegov.core.collection.Pagination.batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the elements on the current page.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.collection.Pagination.offset">
<code class="descname">offset</code><a class="headerlink" href="#onegov.core.collection.Pagination.offset" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the offset applied to the current subset.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.collection.Pagination.pages_count">
<code class="descname">pages_count</code><a class="headerlink" href="#onegov.core.collection.Pagination.pages_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the number of pages.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.collection.Pagination.pages">
<code class="descname">pages</code><a class="headerlink" href="#onegov.core.collection.Pagination.pages" title="Permalink to this definition">¶</a></dt>
<dd><p>Yields all page objects of this Pagination.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.collection.Pagination.previous">
<code class="descname">previous</code><a class="headerlink" href="#onegov.core.collection.Pagination.previous" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the previous page or None.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.collection.Pagination.next">
<code class="descname">next</code><a class="headerlink" href="#onegov.core.collection.Pagination.next" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the next page or None.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-onegov.core.cli.core">
<span id="cli-commands"></span><h2>Cli Commands<a class="headerlink" href="#module-onegov.core.cli.core" title="Permalink to this headline">¶</a></h2>
<div class="section" id="core-commands">
<span id="id5"></span><h3>Core Commands<a class="headerlink" href="#core-commands" title="Permalink to this headline">¶</a></h3>
<p>Provides a framework for cli commands run against one ore more onegov
cloud applications.</p>
<p>OneGov cli commands are usually ran against a onegov.yml config file, which
may contain definitions for multiple applications. It may define multiple
application with different applicaiton classes and it may contain wildcard
applications which run the same application class, but contain multiple
tennants for each application.</p>
<p>To have a command run against one or many applications we use a selector to
help select the applications we want to target in a command.</p>
<p>In addition to selectors, onegov core cli commands provide a simple way to
write a function that takes a request and an application. This function is
then called for each application matching the selector, with a proper
request and application context already setup (with the same characteristics
as if called through an url in the browser).</p>
</div>
<div class="section" id="selector">
<h3>Selector<a class="headerlink" href="#selector" title="Permalink to this headline">¶</a></h3>
<p>A selector has the form &lt;namespace&gt;/&lt;id&gt;.</p>
<p>That is, it consists of the namespace of the application and it’s id.</p>
<p>For example:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">/foo/bar</span></code></li>
<li><code class="docutils literal"><span class="pre">/onegov_election_day/gr</span></code></li>
<li><code class="docutils literal"><span class="pre">/onegov_town/govikon</span></code></li>
</ul>
</div></blockquote>
<p>To select non-wildcard applications we can just omit the id:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">/foo</span></code></li>
<li><code class="docutils literal"><span class="pre">/onegov_onboarding</span></code></li>
</ul>
</div></blockquote>
<p>Finally, to select multiple applications we can use wildcards:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">/foo/*</span></code></li>
<li><code class="docutils literal"><span class="pre">/onegov_election_day/*</span></code></li>
<li><code class="docutils literal"><span class="pre">/*/g??</span></code></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="execution">
<h3>Execution<a class="headerlink" href="#execution" title="Permalink to this headline">¶</a></h3>
<p>To run a supported command we provide a selector as an option:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">/</span><span class="n">onegov</span><span class="o">-</span><span class="n">core</span> <span class="o">--</span><span class="n">select</span> <span class="s1">&#39;/foo/*&#39;</span> <span class="n">subcommand</span>
</pre></div>
</div>
<p>To find out what kind of selectors are available, we can simply run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">/</span><span class="n">onegov</span><span class="o">-</span><span class="n">core</span>
</pre></div>
</div>
<p>Which will print out a list of selector suggestions.</p>
</div>
<div class="section" id="registering-a-selector-based-command">
<h3>Registering a Selector Based Command<a class="headerlink" href="#registering-a-selector-based-command" title="Permalink to this headline">¶</a></h3>
<p>To write a selector based command we first create a command group:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onegov.core.cli</span> <span class="k">import</span> <span class="n">command_group</span>
<span class="n">cli</span> <span class="o">=</span> <span class="n">command_group</span><span class="p">()</span>
</pre></div>
</div>
<p>Using that command group, we can register our own commands:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">my_click_command</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>This command works like any other click command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">click</span>

<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--option&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_click_command</span><span class="p">(</span><span class="n">option</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Each command has the ability to influence the way selectors work. For example,
a command which creates the path that matches the selector we can use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">context_settings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;creates_path&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
<p>By default we expect that a selector is passed. For commands which usually run
against all applications we can provide a default selector:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">context_settings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;default_selector&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="using-the-app-request-context">
<h3>Using the app/request context<a class="headerlink" href="#using-the-app-request-context" title="Permalink to this headline">¶</a></h3>
<p>For a lot of commands the easiest approach is to have a function which is
called for each application with a request. This allows us to write commands
which behave like they were written in a view.</p>
<p>To do that we register a command which returns a function with the following
signature:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">handle_command</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">my_click_command</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">handle_command</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">handle_command</span>
</pre></div>
</div>
<p>Setup like this, <code class="docutils literal"><span class="pre">handle_command</span></code> will be called with a request for each
application (and tennant). This function acts exactly like a view. Most
importantly, it does <em>not</em> require transaction commits, because like with
ordinary requests, the transaction is automatically committed if no error
occurs.</p>
</div>
<div class="section" id="using-the-app-configurations-directly">
<h3>Using the app configurations directly<a class="headerlink" href="#using-the-app-configurations-directly" title="Permalink to this headline">¶</a></h3>
<p>Sometimes we don’t want to use the request/app context, or maybe we want to
setup something before receiving a request.</p>
<p>To do this, we use the <code class="docutils literal"><span class="pre">pass_group_context</span></code> decorator.</p>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onegov.core.cli</span> <span class="k">import</span> <span class="n">pass_group_context</span>

<span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@pass_group_context</span>
<span class="k">def</span> <span class="nf">my_click_command</span><span class="p">(</span><span class="n">group_context</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">appcfg</span> <span class="ow">in</span> <span class="n">group_context</span><span class="o">.</span><span class="n">appcfgs</span><span class="p">:</span>
        <span class="c1"># do something</span>
</pre></div>
</div>
<p>This is independent of the app/request context. If we return a function, the
function is going to be called with the request and the app. If we do not, the
command ends as expected.</p>
</div>
<div class="section" id="returning-multiple-functions">
<h3>Returning multiple functions<a class="headerlink" href="#returning-multiple-functions" title="Permalink to this headline">¶</a></h3>
<p>When a cli command returns multiple functions, they are run in succession.</p>
<p>The signature is taken into account. If there’s a ‘request’ parameter in the
function, the usual request context is set up.</p>
<p>If there is no ‘request’ parameter in the function, it is called once per
appcfg, together with the group context:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">my_special_command</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">handle_command</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">handle_raw</span><span class="p">(</span><span class="n">group_context</span><span class="p">,</span> <span class="n">appcfg</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">handle_command</span><span class="p">,</span> <span class="n">handle_raw</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="limiting-selectors-to-a-single-instance">
<h3>Limiting Selectors to a Single Instance<a class="headerlink" href="#limiting-selectors-to-a-single-instance" title="Permalink to this headline">¶</a></h3>
<p>Sometimes we want to write commands which only run against a single
application. A good example is a command which returns 1/0 depending on the
existence of something <em>in</em> an application.</p>
<p>To do that, we use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">context_settings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;singular&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
<span class="k">def</span> <span class="nf">my_click_command</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>If a selector is passed which matches more than one application, the command
is not executed.</p>
<dl class="data">
<dt id="onegov.core.cli.core.CONTEXT_SPECIFIC_SETTINGS">
<code class="descclassname">onegov.core.cli.core.</code><code class="descname">CONTEXT_SPECIFIC_SETTINGS</code><em class="property"> = ('default_selector', 'creates_path', 'singular', 'matches_required')</em><a class="headerlink" href="#onegov.core.cli.core.CONTEXT_SPECIFIC_SETTINGS" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#onegov.core.cli.core.GroupContext" title="onegov.core.cli.core.GroupContext"><code class="xref py py-class docutils literal"><span class="pre">GroupContext</span></code></a> settings which may be overriden by commands</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.cli.core.GroupContextGuard">
<em class="property">class </em><code class="descclassname">onegov.core.cli.core.</code><code class="descname">GroupContextGuard</code><a class="reference internal" href="_modules/onegov/core/cli/core.html#GroupContextGuard"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cli.core.GroupContextGuard" title="Permalink to this definition">¶</a></dt>
<dd><p>Contains methods which abort the commandline program if any condition
is not met.</p>
<p>Used as a mixin in <a class="reference internal" href="#onegov.core.cli.core.GroupContext" title="onegov.core.cli.core.GroupContext"><code class="xref py py-class docutils literal"><span class="pre">GroupContext</span></code></a>.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.cli.core.GroupContext">
<em class="property">class </em><code class="descclassname">onegov.core.cli.core.</code><code class="descname">GroupContext</code><span class="sig-paren">(</span><em>selector</em>, <em>config</em>, <em>default_selector=None</em>, <em>creates_path=False</em>, <em>singular=False</em>, <em>matches_required=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cli/core.html#GroupContext"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cli.core.GroupContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides access to application configs for group commands.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>selector</strong> – <p>Selects the applications which should be captured by a
<a class="reference internal" href="#onegov.core.cli.core.command_group" title="onegov.core.cli.core.command_group"><code class="xref py py-func docutils literal"><span class="pre">command_group()</span></code></a>.</p>
<p>See <a class="reference internal" href="#core-commands"><span class="std std-ref">Core Commands</span></a> for more documentation about
selectors.</p>
</li>
<li><strong>config</strong> – The targeted onegov.yml file or an equivalent dictionary.</li>
<li><strong>default_selector</strong> – The selector used if none is provided. If not given, a selector
<em>has</em> to be provided.</li>
<li><strong>creates_path</strong> – <p>True if the given selector doesn’t exist yet, but will be created.
Commands which use this setting are expected to take a single path
(no wildcards) and to create it during their runtime.</p>
<p>Implies <cite>singular</cite> and <cite>matches_required</cite>.</p>
</li>
<li><strong>singular</strong> – True if the selector may not match multiple applications.</li>
<li><strong>matches_required</strong> – True if the selector <em>must</em> match at least one application.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="onegov.core.cli.core.GroupContext.unbound_session_manager">
<code class="descname">unbound_session_manager</code><span class="sig-paren">(</span><em>dsn</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cli/core.html#GroupContext.unbound_session_manager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cli.core.GroupContext.unbound_session_manager" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a session manager <em>not yet bound to a schema!</em>.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.cli.core.GroupContext.available_schemas">
<code class="descname">available_schemas</code><span class="sig-paren">(</span><em>appcfg</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cli/core.html#GroupContext.available_schemas"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cli.core.GroupContext.available_schemas" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all available schemas, if the application is database
bound.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.cli.core.GroupContext.match_to_path">
<code class="descname">match_to_path</code><span class="sig-paren">(</span><em>match</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cli/core.html#GroupContext.match_to_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cli.core.GroupContext.match_to_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given match and returns the application path used in
http requests.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.core.cli.core.GroupContext.match_to_appcfg">
<code class="descname">match_to_appcfg</code><span class="sig-paren">(</span><em>match</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cli/core.html#GroupContext.match_to_appcfg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cli.core.GroupContext.match_to_appcfg" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given match and returns the maching appcfg object.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.cli.core.GroupContext.appcfgs">
<code class="descname">appcfgs</code><a class="headerlink" href="#onegov.core.cli.core.GroupContext.appcfgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the matching appconfigs.</p>
<p>Since there’s only one appconfig per namespace, we ignore the path
part of the selector and only focus on the namespace:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">namespace</span><span class="o">/</span><span class="n">application_id</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.cli.core.GroupContext.available_selectors">
<code class="descname">available_selectors</code><a class="headerlink" href="#onegov.core.cli.core.GroupContext.available_selectors" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a list of available selectors.</p>
<p>The list doesn’t technically exhaust all options, but it returns
all selectors targeting a single application as well as all selectors
targeting a namespace by wildcard.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.cli.core.GroupContext.all_wildcard_selectors">
<code class="descname">all_wildcard_selectors</code><a class="headerlink" href="#onegov.core.cli.core.GroupContext.all_wildcard_selectors" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all selectors targeting a namespace by wildcard.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.cli.core.GroupContext.all_specific_selectors">
<code class="descname">all_specific_selectors</code><a class="headerlink" href="#onegov.core.cli.core.GroupContext.all_specific_selectors" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all selectors targeting an application directly.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.core.cli.core.GroupContext.matches">
<code class="descname">matches</code><a class="headerlink" href="#onegov.core.cli.core.GroupContext.matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the specific selectors matching the context selector.</p>
<p>That is, a combination of namespace / application id is returned.
Since we only know an exhaustive list of application id’s <em>if</em> we have
a database connection this is currently limited to applications with
one. Since we do not have any others yet that’s fine.</p>
<p>However if we implement a database-less application in the future which
takes wildcard ids, we need some way to enumerate those ids.</p>
<p>See <a class="reference external" href="https://github.com/OneGov/onegov.core/issues/13">https://github.com/OneGov/onegov.core/issues/13</a></p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="onegov.core.cli.core.get_context_specific_settings">
<code class="descclassname">onegov.core.cli.core.</code><code class="descname">get_context_specific_settings</code><span class="sig-paren">(</span><em>context</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cli/core.html#get_context_specific_settings"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cli.core.get_context_specific_settings" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given <em>click</em> context and extracts all context specific
settings from it.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.cli.core.pass_group_context">
<code class="descclassname">onegov.core.cli.core.</code><code class="descname">pass_group_context</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#onegov.core.cli.core.pass_group_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator to acquire the group context on a command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@pass_group_context</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">my_command</span><span class="p">(</span><span class="n">group_context</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="onegov.core.cli.core.command_group">
<code class="descclassname">onegov.core.cli.core.</code><code class="descname">command_group</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cli/core.html#command_group"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cli.core.command_group" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a click command group for individual modules.</p>
<p>Each individual module may have its own command group from which to run
commands to. Read <a class="reference external" href="http://click.pocoo.org/6/commands/">http://click.pocoo.org/6/commands/</a> to learn more
about command groups.</p>
<p>The returned command group will provide the individual commands with
an optional list of applications to operate on and it allows commands
to return a callback function which will be invoked with the app config
(if available), an application instance and a request.</p>
<p>That is to say, the command group automates setting up a proper request
context.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.cli.core.abort">
<code class="descclassname">onegov.core.cli.core.</code><code class="descname">abort</code><span class="sig-paren">(</span><em>msg</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/cli/core.html#abort"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.cli.core.abort" title="Permalink to this definition">¶</a></dt>
<dd><p>Prints the given error message and aborts the program with a return
code of 1.</p>
</dd></dl>

</div>
<span class="target" id="module-onegov.core.cli.commands"></span><dl class="data">
<dt id="onegov.core.cli.commands.cli">
<code class="descclassname">onegov.core.cli.commands.</code><code class="descname">cli</code><em class="property"> = &lt;click.core.Group object&gt;</em><a class="headerlink" href="#onegov.core.cli.commands.cli" title="Permalink to this definition">¶</a></dt>
<dd><p>onegov.core’s own command group</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.upgrade">
<span id="upgrade"></span><h2>Upgrade<a class="headerlink" href="#module-onegov.core.upgrade" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="onegov.core.upgrade.UpgradeState">
<em class="property">class </em><code class="descclassname">onegov.core.upgrade.</code><code class="descname">UpgradeState</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#UpgradeState"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.UpgradeState" title="Permalink to this definition">¶</a></dt>
<dd><p>Keeps the state of all upgrade steps over all modules.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.upgrade.get_distributions_with_entry_map">
<code class="descclassname">onegov.core.upgrade.</code><code class="descname">get_distributions_with_entry_map</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#get_distributions_with_entry_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.get_distributions_with_entry_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterates through all distributions with entry_maps and yields
each distribution along side the entry map with the given key.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.upgrade.get_upgrade_modules">
<code class="descclassname">onegov.core.upgrade.</code><code class="descname">get_upgrade_modules</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#get_upgrade_modules"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.get_upgrade_modules" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all modules that registered themselves for onegov.core
upgrades like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;onegov.core&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;upgrade = onegov.mypackage.upgrade&#39;</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="onegov.core.upgrade.upgrade_task">
<em class="property">class </em><code class="descclassname">onegov.core.upgrade.</code><code class="descname">upgrade_task</code><span class="sig-paren">(</span><em>name</em>, <em>always_run=False</em>, <em>requires=None</em>, <em>raw=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#upgrade_task"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.upgrade_task" title="Permalink to this definition">¶</a></dt>
<dd><p>Marks the decorated function as an upgrade task. Upgrade tasks should
be defined outside classes (except for testing) - that is in the root of
the module (directly in onegov/form/upgrades.py for example).</p>
<p>Each upgrade task has the following properties:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Name:</th><td class="field-body"><p class="first">The name of the task in readable English. Do not change the name of
the task once you pushed your changes. This name is used as an id!</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Always_run:</th><td class="field-body"><p class="first">By default, tasks are run once on if they haven’t been run yet, or if
the module was not yet under upgrade control (it just added itself
through the entry_points mechanism).</p>
<p>There are times where this is not wanted.</p>
<p>If you enable upgrades in your module and you plan to run an upgrade
task in the same release, then you need to ‘always_run’ and detect
yourself if you need to do any changes.</p>
<p>If you need to enable upgrades and run a task at the same time which
can only be run once and is impossible to make idempotent, then you
need to make two releases. One that enables upgade control and a second
one that</p>
<p>Also, if you want to run an upgrade task every time you upgrade (for
example, for maintenance), then you should also use it.</p>
<p>The easiest way to use upgrade control is to enable it from the first
release on.</p>
<p>Another way to tackle this is to write update methods idempotent as
often as possible and to always run them.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Requires:</th><td class="field-body"><p class="first">A reference to another projects upgrade task that should be run first.</p>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">requires</span><span class="o">=</span><span class="s1">&#39;onegov.form:Add new form field&#39;</span>
</pre></div>
</div>
<p>If the reference cannot be found, the upgrade fails.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raw:</th><td class="field-body"><p class="first">A raw task is run without setting up a request. Instead a database
connection and a list of targeted schemas is passed. It’s up to the
upgrade function to make sure the right schemas are targeted through
that connection!</p>
<p>This is useful for upgrades which need to execute some raw SQL that
cannot be executed in a request context. For example, this is a way
to migrate the upgrade states table of the upgrade itself.</p>
<p>Raw tasks are always run and there state is not recorded. So the
raw task needs to be idempotent and return False if there was no
change.</p>
<p>Only use this if you have no other way. This is a very blunt instrument
only used under special circumstances.</p>
<p class="last">Note, raw tasks may be normal function OR generators. If they are
generators, then with each yield the transaction is either commited
or rolled-back depending on the dry-run cli argument.</p>
</td>
</tr>
</tbody>
</table>
<p>Always run tasks may return <code class="docutils literal"><span class="pre">False</span></code> if they wish to be considered
as not run (and therefore not shown in the upgrade runner).</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.upgrade.is_task">
<code class="descclassname">onegov.core.upgrade.</code><code class="descname">is_task</code><span class="sig-paren">(</span><em>function</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#is_task"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.is_task" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the given function is an uprade task.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.upgrade.get_module_tasks">
<code class="descclassname">onegov.core.upgrade.</code><code class="descname">get_module_tasks</code><span class="sig-paren">(</span><em>module</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#get_module_tasks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.get_module_tasks" title="Permalink to this definition">¶</a></dt>
<dd><p>Goes through a module or class and returns all upgrade tasks.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.upgrade.get_tasks_by_id">
<code class="descclassname">onegov.core.upgrade.</code><code class="descname">get_tasks_by_id</code><span class="sig-paren">(</span><em>upgrade_modules=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#get_tasks_by_id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.get_tasks_by_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a list of upgrade modules or classes and returns the tasks
keyed by id.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.upgrade.get_module_order_key">
<code class="descclassname">onegov.core.upgrade.</code><code class="descname">get_module_order_key</code><span class="sig-paren">(</span><em>tasks</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#get_module_order_key"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.get_module_order_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a sort order key which orders task_ids in order of their
module dependencies. That is a task from onegov.core is sorted before
a task in onegov.user, because onegov.user depends on onegov.core.</p>
<p>This is used to order unrelated tasks in a sane way.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.upgrade.get_tasks">
<code class="descclassname">onegov.core.upgrade.</code><code class="descname">get_tasks</code><span class="sig-paren">(</span><em>upgrade_modules=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#get_tasks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.get_tasks" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a list of upgrade modules or classes and returns the
tasks that should be run in the order they should be run.</p>
<p>The order takes dependencies into account.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.upgrade.register_modules">
<code class="descclassname">onegov.core.upgrade.</code><code class="descname">register_modules</code><span class="sig-paren">(</span><em>session</em>, <em>modules</em>, <em>tasks</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#register_modules"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.register_modules" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets up the state tracking for all modules. Initially, all tasks
are marekd as executed, because we assume tasks to upgrade older
deployments to a new deployment.</p>
<p>If this is a new deployment we do not need to execute these tasks.</p>
<p>Tasks where this is not desired should be marked as ‘always_run’.
They will then manage their own state (i.e. check if they need to
run or not).</p>
<p>This function is idempotent.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.upgrade.register_all_modules_and_tasks">
<code class="descclassname">onegov.core.upgrade.</code><code class="descname">register_all_modules_and_tasks</code><span class="sig-paren">(</span><em>session</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#register_all_modules_and_tasks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.register_all_modules_and_tasks" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers all the modules and all the tasks.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.upgrade.UpgradeTransaction">
<em class="property">class </em><code class="descclassname">onegov.core.upgrade.</code><code class="descname">UpgradeTransaction</code><span class="sig-paren">(</span><em>context</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#UpgradeTransaction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.UpgradeTransaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Holds the session and the alembic operations connection together and
commits/aborts both at the same time.</p>
<p>Not really a two-phase commit solution. That could be accomplished but
for now this suffices.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.upgrade.UpgradeContext">
<em class="property">class </em><code class="descclassname">onegov.core.upgrade.</code><code class="descname">UpgradeContext</code><span class="sig-paren">(</span><em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#UpgradeContext"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.UpgradeContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Holdes the context of the upgrade. An instance of this is passed
to each upgrade task.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.upgrade.RawUpgradeRunner">
<em class="property">class </em><code class="descclassname">onegov.core.upgrade.</code><code class="descname">RawUpgradeRunner</code><span class="sig-paren">(</span><em>tasks</em>, <em>commit=True</em>, <em>on_task_success=None</em>, <em>on_task_fail=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#RawUpgradeRunner"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.RawUpgradeRunner" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the given raw tasks.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.upgrade.UpgradeRunner">
<em class="property">class </em><code class="descclassname">onegov.core.upgrade.</code><code class="descname">UpgradeRunner</code><span class="sig-paren">(</span><em>modules</em>, <em>tasks</em>, <em>commit=True</em>, <em>on_task_success=None</em>, <em>on_task_fail=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/upgrade.html#UpgradeRunner"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.upgrade.UpgradeRunner" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the given basic tasks.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.utils">
<span id="utils"></span><h2>Utils<a class="headerlink" href="#module-onegov.core.utils" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="onegov.core.utils.normalize_for_url">
<code class="descclassname">onegov.core.utils.</code><code class="descname">normalize_for_url</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#normalize_for_url"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.normalize_for_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given text and makes it fit to be used for an url.</p>
<p>That means replacing spaces and other unwanted characters with ‘-‘,
lowercasing everything and turning unicode characters into their closest
ascii equivalent using Unidecode.</p>
<p>See <a class="reference external" href="https://pypi.python.org/pypi/Unidecode">https://pypi.python.org/pypi/Unidecode</a></p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.increment_name">
<code class="descclassname">onegov.core.utils.</code><code class="descname">increment_name</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#increment_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.increment_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given name and adds a numbered suffix beginning at 1.</p>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=&gt;</span> <span class="n">foo</span><span class="o">-</span><span class="mi">1</span>
<span class="n">foo</span><span class="o">-</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="n">foo</span><span class="o">-</span><span class="mi">2</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.lchop">
<code class="descclassname">onegov.core.utils.</code><code class="descname">lchop</code><span class="sig-paren">(</span><em>text</em>, <em>beginning</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#lchop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.lchop" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes the beginning from the text if the text starts with it.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.rchop">
<code class="descclassname">onegov.core.utils.</code><code class="descname">rchop</code><span class="sig-paren">(</span><em>text</em>, <em>end</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#rchop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.rchop" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes the end from the text if the text ends with it.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.remove_repeated_spaces">
<code class="descclassname">onegov.core.utils.</code><code class="descname">remove_repeated_spaces</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#remove_repeated_spaces"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.remove_repeated_spaces" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes repeated spaces in the text (‘a  b’ -&gt; ‘a b’).</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.profile">
<code class="descclassname">onegov.core.utils.</code><code class="descname">profile</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#profile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.profile" title="Permalink to this definition">¶</a></dt>
<dd><p>Profiles the wrapped code and stores the result in the profiles folder
with the given filename.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.timing">
<code class="descclassname">onegov.core.utils.</code><code class="descname">timing</code><span class="sig-paren">(</span><em>name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#timing"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.timing" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the wrapped code and prints the time in ms it took to run it.
The name is printed in front of the time, if given.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.module_path">
<code class="descclassname">onegov.core.utils.</code><code class="descname">module_path</code><span class="sig-paren">(</span><em>module</em>, <em>subpath</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#module_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.module_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a subdirectory in the given python module.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Mod:</th><td class="field-body">A python module (actual module or string)</td>
</tr>
<tr class="field-even field"><th class="field-name">Subpath:</th><td class="field-body">Subpath below that python module. Leading slashes (‘/’) are ignored.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.touch">
<code class="descclassname">onegov.core.utils.</code><code class="descname">touch</code><span class="sig-paren">(</span><em>file_path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#touch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.touch" title="Permalink to this definition">¶</a></dt>
<dd><p>Touches the file on the given path.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.utils.Bunch">
<em class="property">class </em><code class="descclassname">onegov.core.utils.</code><code class="descname">Bunch</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#Bunch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.Bunch" title="Permalink to this definition">¶</a></dt>
<dd><p>A simple but handy “collector of a bunch of named stuff” class.</p>
<p>See <a class="reference external" href="http://code.activestate.com/recipes/52308-the-simple-but-handy-collector-of-a-bunch-of-named/">http://code.activestate.com/recipes/52308-the-simple-but-handy-collector-of-a-bunch-of-named/</a>.</p>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">point</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">2</span>

<span class="n">point</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">3</span>
<span class="k">assert</span> <span class="n">point</span><span class="o">.</span><span class="n">z</span> <span class="o">==</span> <span class="mi">3</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.render_file">
<code class="descclassname">onegov.core.utils.</code><code class="descname">render_file</code><span class="sig-paren">(</span><em>file_path</em>, <em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#render_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.render_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given file_path (content) and renders it to the browser.
The file must exist on the local system and be readable by the current
process.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.hash_dictionary">
<code class="descclassname">onegov.core.utils.</code><code class="descname">hash_dictionary</code><span class="sig-paren">(</span><em>dictionary</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#hash_dictionary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.hash_dictionary" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes a sha256 hash for the given dictionary. The dictionary
is expected to only contain values that can be serialized by json.</p>
<p>That includes int, decimal, string, boolean.</p>
<p>Note that this function is not meant to be used for hashing secrets. Do
not include data in this dictionary that is secret!</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.groupbylist">
<code class="descclassname">onegov.core.utils.</code><code class="descname">groupbylist</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#groupbylist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.groupbylist" title="Permalink to this definition">¶</a></dt>
<dd><p>Works just like Python’s <code class="docutils literal"><span class="pre">itertools.groupby</span></code> function, but instead
of returning generators, it returns lists.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.linkify">
<code class="descclassname">onegov.core.utils.</code><code class="descname">linkify</code><span class="sig-paren">(</span><em>text</em>, <em>escape=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#linkify"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.linkify" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes plain text and injects html links for urls and email addresses.</p>
<p>By default the text is html escaped before it is linkified. This accounts
for the fact that we usually use this for text blocks that we mean to
extend with email addresses and urls.</p>
<p>If html is already possible, why linkify it?</p>
<p>Note: We need to clean the html after we’ve created it (linkify
parses escaped html and turns it into real html). As a consequence it
is possible to have html urls in the text that won’t be escaped.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.ensure_scheme">
<code class="descclassname">onegov.core.utils.</code><code class="descname">ensure_scheme</code><span class="sig-paren">(</span><em>url</em>, <em>default='http'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#ensure_scheme"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.ensure_scheme" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes sure that the given url has a scheme in front, if none
was provided.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.is_uuid">
<code class="descclassname">onegov.core.utils.</code><code class="descname">is_uuid</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#is_uuid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.is_uuid" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if the given value is a uuid. The value may be a string
or of type UUID. If it’s a string, the uuid is checked with a regex.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.is_non_string_iterable">
<code class="descclassname">onegov.core.utils.</code><code class="descname">is_non_string_iterable</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#is_non_string_iterable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.is_non_string_iterable" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if the given obj is an iterable, but not a string.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.pairwise">
<code class="descclassname">onegov.core.utils.</code><code class="descname">pairwise</code><span class="sig-paren">(</span><em>iterable</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#pairwise"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.pairwise" title="Permalink to this definition">¶</a></dt>
<dd><p>s -&gt; (s0,s1), (s1,s2), (s2, s3), …</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.chunks">
<code class="descclassname">onegov.core.utils.</code><code class="descname">chunks</code><span class="sig-paren">(</span><em>iterable</em>, <em>n</em>, <em>fillvalue=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#chunks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.chunks" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterates through an iterable, returning chunks with the given size.</p>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">chunks</span><span class="p">(</span><span class="s1">&#39;ABCDEFG&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.relative_url">
<code class="descclassname">onegov.core.utils.</code><code class="descname">relative_url</code><span class="sig-paren">(</span><em>absolute_url</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#relative_url"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.relative_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes everything in front of the path, including scheme, host,
username, password and port.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.is_subpath">
<code class="descclassname">onegov.core.utils.</code><code class="descname">is_subpath</code><span class="sig-paren">(</span><em>directory</em>, <em>path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#is_subpath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.is_subpath" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if the given path is inside the given directory.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.is_sorted">
<code class="descclassname">onegov.core.utils.</code><code class="descname">is_sorted</code><span class="sig-paren">(</span><em>iterable</em>, <em>key=&lt;function &lt;lambda&gt;&gt;</em>, <em>reverse=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#is_sorted"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.is_sorted" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the iterable is sorted.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.morepath_modules">
<code class="descclassname">onegov.core.utils.</code><code class="descname">morepath_modules</code><span class="sig-paren">(</span><em>cls</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#morepath_modules"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.morepath_modules" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all morepath modules which should be scanned for the given
morepath application class.</p>
<p>We can’t reliably know the actual morepath modules that
need to be scanned, which is why we assume that each module has
one namespace (like ‘more.transaction’ or ‘onegov.core’).</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.scan_morepath_modules">
<code class="descclassname">onegov.core.utils.</code><code class="descname">scan_morepath_modules</code><span class="sig-paren">(</span><em>cls</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#scan_morepath_modules"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.scan_morepath_modules" title="Permalink to this definition">¶</a></dt>
<dd><p>Tries to scann all the morepath modules required for the given
application class. This is not guaranteed to stay reliable as there is
no sure way to discover all modules required by the application class.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.get_unique_hstore_keys">
<code class="descclassname">onegov.core.utils.</code><code class="descname">get_unique_hstore_keys</code><span class="sig-paren">(</span><em>session</em>, <em>column</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#get_unique_hstore_keys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.get_unique_hstore_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a set of keys found in an hstore column over all records
of its table.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.makeopendir">
<code class="descclassname">onegov.core.utils.</code><code class="descname">makeopendir</code><span class="sig-paren">(</span><em>fs</em>, <em>directory</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#makeopendir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.makeopendir" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates and opens the given directory in the given PyFilesystem.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.append_query_param">
<code class="descclassname">onegov.core.utils.</code><code class="descname">append_query_param</code><span class="sig-paren">(</span><em>url</em>, <em>key</em>, <em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#append_query_param"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.append_query_param" title="Permalink to this definition">¶</a></dt>
<dd><p>Appends a single query parameter to an url. This is faster than
using Purl, if and only if we only add one query param.</p>
<p>Also this function assumes that the value is already url encoded.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.utils.PostThread">
<em class="property">class </em><code class="descclassname">onegov.core.utils.</code><code class="descname">PostThread</code><span class="sig-paren">(</span><em>url</em>, <em>data</em>, <em>headers</em>, <em>timeout=30</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#PostThread"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.PostThread" title="Permalink to this definition">¶</a></dt>
<dd><p>POSTs the given data with the headers to the URL.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">PostThread</span><span class="p">(</span>
    <span class="s1">&#39;https://example.com/post&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>This only works for external URLs! If posting to server itself is
needed, use a process instead of the thread!</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.toggle">
<code class="descclassname">onegov.core.utils.</code><code class="descname">toggle</code><span class="sig-paren">(</span><em>collection</em>, <em>item</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#toggle"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.toggle" title="Permalink to this definition">¶</a></dt>
<dd><p>Toggles an item in a set.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.binary_to_dictionary">
<code class="descclassname">onegov.core.utils.</code><code class="descname">binary_to_dictionary</code><span class="sig-paren">(</span><em>binary</em>, <em>filename=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#binary_to_dictionary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.binary_to_dictionary" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes raw binary filedata and stores it in a dictionary together
with metadata information.</p>
<p>The data is compressed before it is stored int he dictionary. Use
<a class="reference internal" href="#onegov.core.utils.dictionary_to_binary" title="onegov.core.utils.dictionary_to_binary"><code class="xref py py-func docutils literal"><span class="pre">dictionary_to_binary()</span></code></a> to get the original binary data back.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.dictionary_to_binary">
<code class="descclassname">onegov.core.utils.</code><code class="descname">dictionary_to_binary</code><span class="sig-paren">(</span><em>dictionary</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#dictionary_to_binary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.dictionary_to_binary" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a dictionary created by <a class="reference internal" href="#onegov.core.utils.binary_to_dictionary" title="onegov.core.utils.binary_to_dictionary"><code class="xref py py-func docutils literal"><span class="pre">binary_to_dictionary()</span></code></a> and returns
the original binary data.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.safe_format">
<code class="descclassname">onegov.core.utils.</code><code class="descname">safe_format</code><span class="sig-paren">(</span><em>format</em>, <em>dictionary</em>, <em>types={&lt;class 'int'&gt;</em>, <em>&lt;class 'float'&gt;</em>, <em>&lt;class 'str'&gt;}</em>, <em>adapt=None</em>, <em>raise_on_missing=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#safe_format"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.safe_format" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a user-supplied string with format blocks and returns a string
where those blocks are replaced by values in a dictionary.</p>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">safe_format</span><span class="p">(</span><span class="s1">&#39;[user] has logged in&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">})</span>
<span class="go">&#39;admin has logged in&#39;</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>format</strong> – The format to use. Square brackets denote dictionary keys. To
literally print square bracktes, mask them by doubling (‘[[‘ -&gt; ‘[‘)</li>
<li><strong>dictionary</strong> – The dictionary holding the variables to use. If the key is not found
in the dictionary, the bracket is replaced with an empty string.</li>
<li><strong>types</strong> – <p>A set of types supported by the dictionary. Limiting this to safe
types like builtins (str, int, float) ensure that no values are
accidentally leaked through faulty __str__ representations.</p>
<p>Note that inheritance is ignored. Supported types need to be
whitelisted explicitly.</p>
</li>
<li><strong>adapt</strong> – An optional callable that receives the key before it is used. Returns
the same key or an altered version.</li>
<li><strong>raise_on_missing</strong> – True if missing keys should result in a runtime error (defaults to
False).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This is strictly meant for formats provided by users. Python’s string
formatting options are clearly superior to this, however it is less
secure!</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.utils.safe_format_keys">
<code class="descclassname">onegov.core.utils.</code><code class="descname">safe_format_keys</code><span class="sig-paren">(</span><em>format</em>, <em>adapt=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/utils.html#safe_format_keys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.utils.safe_format_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a <a class="reference internal" href="#onegov.core.utils.safe_format" title="onegov.core.utils.safe_format"><code class="xref py py-func docutils literal"><span class="pre">safe_format()</span></code></a> string and returns the found keys.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.custom_json">
<span id="custom-json"></span><h2>Custom JSON<a class="headerlink" href="#module-onegov.core.custom_json" title="Permalink to this headline">¶</a></h2>
<p>Sigh. Here we go again, <em>another</em> json implementation with support for:</p>
<ul class="simple">
<li>date</li>
<li>datetime</li>
<li>time</li>
</ul>
<p>Because nobody else does all of these. And if they do (like standardjson), they
don’t support decoding…</p>
<dl class="function">
<dt id="onegov.core.custom_json.encode_decimal">
<code class="descclassname">onegov.core.custom_json.</code><code class="descname">encode_decimal</code><span class="sig-paren">(</span><em>o</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/custom_json.html#encode_decimal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.custom_json.encode_decimal" title="Permalink to this definition">¶</a></dt>
<dd><p>Encodes a Python decimal.Decimal object as an ECMA-262 compliant
decimal string.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.filters">
<span id="webasset-filters"></span><h2>Webasset Filters<a class="headerlink" href="#module-onegov.core.filters" title="Permalink to this headline">¶</a></h2>
<p>Extra webasset filters.</p>
<dl class="class">
<dt id="onegov.core.filters.DataUriFilter">
<em class="property">class </em><code class="descclassname">onegov.core.filters.</code><code class="descname">DataUriFilter</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/filters.html#DataUriFilter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.filters.DataUriFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Overrides the default datauri filter to work around this issue:</p>
<p><a class="reference external" href="https://github.com/miracle2k/webassets/issues/387">https://github.com/miracle2k/webassets/issues/387</a></p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.filters.RCSSMinFilter">
<em class="property">class </em><code class="descclassname">onegov.core.filters.</code><code class="descname">RCSSMinFilter</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/filters.html#RCSSMinFilter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.filters.RCSSMinFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds the rcssmin filter (not yet included in webassets)</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.mail">
<span id="mail"></span><h2>Mail<a class="headerlink" href="#module-onegov.core.mail" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="onegov.core.mail.email">
<code class="descclassname">onegov.core.mail.</code><code class="descname">email</code><span class="sig-paren">(</span><em>sender=None</em>, <em>receivers=()</em>, <em>cc=()</em>, <em>bcc=()</em>, <em>subject=None</em>, <em>content=None</em>, <em>encoding='utf8'</em>, <em>attachments=()</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/mail.html#email"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.mail.email" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an Envelope object with a HTML <em>content</em>, as well as a <em>plaintext</em>
alternative generated from the HTML content.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>content</strong> – HTML content.</li>
<li><strong>encoding</strong> – Encoding of the email.</li>
<li><strong>attachments</strong> – Either a list of <code class="xref py py-class docutils literal"><span class="pre">mailthon.enclosure.Enclosure</span></code>
or a list of filenames to attach to the email.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note: this is basically a copy of <code class="xref py py-func docutils literal"><span class="pre">mailthon.api.email()</span></code>, though it
adds the plaintext alternative.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.mail.Envelope">
<em class="property">class </em><code class="descclassname">onegov.core.mail.</code><code class="descname">Envelope</code><span class="sig-paren">(</span><em>headers</em>, <em>enclosure</em>, <em>mail_from=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/mail.html#Envelope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.mail.Envelope" title="Permalink to this definition">¶</a></dt>
<dd><p>Changes the mailthon envelope to use mime-multipart/alternative.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.mail.MaildirTransport">
<em class="property">class </em><code class="descclassname">onegov.core.mail.</code><code class="descname">MaildirTransport</code><span class="sig-paren">(</span><em>host</em>, <em>port</em>, <em>maildir</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/mail.html#MaildirTransport"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.mail.MaildirTransport" title="Permalink to this definition">¶</a></dt>
<dd><p>A transport that pretends to be like python’s smtplib.SMTP transport,
but actually just stores files into a maildir.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.mail.MaildirPostman">
<em class="property">class </em><code class="descclassname">onegov.core.mail.</code><code class="descname">MaildirPostman</code><span class="sig-paren">(</span><em>host</em>, <em>port</em>, <em>middlewares=()</em>, <em>options=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/mail.html#MaildirPostman"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.mail.MaildirPostman" title="Permalink to this definition">¶</a></dt>
<dd><p>A mailthon postman that stores mails to a maildir.</p>
<dl class="attribute">
<dt id="onegov.core.mail.MaildirPostman.transport">
<code class="descname">transport</code><a class="headerlink" href="#onegov.core.mail.MaildirPostman.transport" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#onegov.core.mail.MaildirTransport" title="onegov.core.mail.MaildirTransport"><code class="xref py py-class docutils literal"><span class="pre">MaildirTransport</span></code></a></p>
</dd></dl>

</dd></dl>

<span class="target" id="module-onegov.core.datamanager"></span><dl class="class">
<dt id="onegov.core.datamanager.MailDataManager">
<em class="property">class </em><code class="descclassname">onegov.core.datamanager.</code><code class="descname">MailDataManager</code><span class="sig-paren">(</span><em>postman</em>, <em>envelope</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/datamanager.html#MailDataManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.datamanager.MailDataManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a postman and an envelope and sends it when the transaction
is commited.</p>
<p>Since we can’t really know if a mail can be sent until it happens, we
simply log an exception if the sending failed.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.core.datamanager.FileDataManager">
<em class="property">class </em><code class="descclassname">onegov.core.datamanager.</code><code class="descname">FileDataManager</code><span class="sig-paren">(</span><em>data</em>, <em>path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/datamanager.html#FileDataManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.datamanager.FileDataManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes a file when the transaction is commited.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.core.csv">
<span id="csv"></span><h2>CSV<a class="headerlink" href="#module-onegov.core.csv" title="Permalink to this headline">¶</a></h2>
<p>Offers tools to deal with csv (and xls, xlsx) files.</p>
<dl class="class">
<dt id="onegov.core.csv.CSVFile">
<em class="property">class </em><code class="descclassname">onegov.core.csv.</code><code class="descname">CSVFile</code><span class="sig-paren">(</span><em>csvfile</em>, <em>expected_headers=None</em>, <em>dialect=None</em>, <em>encoding=None</em>, <em>rename_duplicate_column_names=False</em>, <em>rowtype=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/csv.html#CSVFile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.csv.CSVFile" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides access to a csv file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>csvfile</strong> – <p>The csv file to be accessed. Must be an open file (not a poth), opened
in binary mode. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">csv</span> <span class="o">=</span> <span class="n">CSVFile</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><strong>expected_headers</strong> – <p>The expected headers if known. Expected headers are headers which
<em>must</em> exist in the CSV file. There may be additional headers.</p>
<p>If the headers are slightly misspelled, a matching algorithm tries to
guess the correct header, without accidentally matching the wrong
headers.</p>
<p>See <a class="reference internal" href="#onegov.core.csv.match_headers" title="onegov.core.csv.match_headers"><code class="xref py py-func docutils literal"><span class="pre">match_headers()</span></code></a> for more information.</p>
<p>If the no expected_headers are passed, no checks are done, but the
headers are still available. Headers matching is useful if a user
provides the CSV and it might be wrong.</p>
<p>If it is impossible for misspellings to occurr, the expected headers
don’t have to be specified.</p>
</li>
<li><strong>dialect</strong> – The CSV dialect to expect. By default, the dialect will be guessed
using Python’s heuristic.</li>
<li><strong>encoding</strong> – The CSV encoding to expect. By default, the encoding will be guessed
and will either be UTF-8 or CP1252.</li>
<li><strong>rename_duplicate_column_names</strong> – It is possible to rename duplicate column names to deal with super
wacky files. If this option is set and a duplicate header is found,
a suffix is appended to the column name rather than throwing a
DuplicateColumnNamesError.</li>
<li><strong>rowtype</strong> – <p>An alternative rowtype for the resulting rows. This should be a
callable that receives a <cite>rownumber</cite> key/value and all the other
keys/values found in the csv. The keys are normalized and are valid
Python identifiers usable as attribute names.</p>
<p>Defaults to a namedtuple created using the found headers.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Once the csv file is open, the records can be acceessed as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">csv</span> <span class="o">=</span> <span class="n">CSVFile</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
        <span class="n">csv</span><span class="o">.</span><span class="n">my_field</span>  <span class="c1"># access the column with the &#39;my_field&#39; header</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="onegov.core.csv.detect_encoding">
<code class="descclassname">onegov.core.csv.</code><code class="descname">detect_encoding</code><span class="sig-paren">(</span><em>csvfile</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/csv.html#detect_encoding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.csv.detect_encoding" title="Permalink to this definition">¶</a></dt>
<dd><p>Since encoding detection is hard to get right (and work correctly
every time), we limit ourselves here to UTF-8 or CP1252, whichever works
first. CP1252 is basically the csv format you get if you use windows and
excel and it is a superset of ISO-8859-1/LATIN1.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.csv.sniff_dialect">
<code class="descclassname">onegov.core.csv.</code><code class="descname">sniff_dialect</code><span class="sig-paren">(</span><em>csv</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/csv.html#sniff_dialect"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.csv.sniff_dialect" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given csv string and returns the dialect or raises an error.
Works just like Python’s built in sniffer, just that it is a bit more
conservative and doesn’t just accept any kind of character as csv
delimiter.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.csv.normalize_header">
<code class="descclassname">onegov.core.csv.</code><code class="descname">normalize_header</code><span class="sig-paren">(</span><em>header</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/csv.html#normalize_header"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.csv.normalize_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Normalizes a header value to be as uniform as possible.</p>
<dl class="docutils">
<dt>This includes:</dt>
<dd><ul class="first last simple">
<li>stripping the whitespace around it</li>
<li>lowercasing everything</li>
<li>transliterating unicode (e.g. ‘ä’ becomes ‘a’)</li>
<li>removing duplicate whitespace inside it</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="onegov.core.csv.convert_xls_to_csv">
<code class="descclassname">onegov.core.csv.</code><code class="descname">convert_xls_to_csv</code><span class="sig-paren">(</span><em>xls</em>, <em>sheet_name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/csv.html#convert_xls_to_csv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.csv.convert_xls_to_csv" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes an XLS/XLSX file and returns a csv file using the given worksheet
name or the first worksheet found.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.csv.get_keys_from_list_of_dicts">
<code class="descclassname">onegov.core.csv.</code><code class="descname">get_keys_from_list_of_dicts</code><span class="sig-paren">(</span><em>rows</em>, <em>key=None</em>, <em>reverse=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/csv.html#get_keys_from_list_of_dicts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.csv.get_keys_from_list_of_dicts" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all keys of a list of dicts in an ordered tuple.</p>
<p>If the list of dicts is irregular, the keys found in later rows are
added at the end of the list.</p>
<p>Note that the order of keys is otherwise defined by the order of the keys
of the dictionaries. So if ordered dictionaries are used, the order is
defined. If regular dictionaries are used, the order is undefined.</p>
<p>Alternatively, a key and a reverse flag may be provided which will be
used to order the fields. If the list of fields is specified, the key and
the reverse flag is ignored.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.csv.convert_list_of_dicts_to_csv">
<code class="descclassname">onegov.core.csv.</code><code class="descname">convert_list_of_dicts_to_csv</code><span class="sig-paren">(</span><em>rows</em>, <em>fields=None</em>, <em>key=None</em>, <em>reverse=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/csv.html#convert_list_of_dicts_to_csv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.csv.convert_list_of_dicts_to_csv" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a list of dictionaries and returns a csv.</p>
<p>If no fields are provided, all fields are included in the order of the keys
of the first dict. With regular dictionaries this is random. Use an ordered
dict or provide a list of fields to have a fixed order.</p>
<p>Alternatively, a key and a reverse flag may be provided which will be
used to order the fields. If the list of fields is specified, the key and
the reverse flag is ignored.</p>
<p>The function returns a string created in memory. Therefore this function
is limited to small-ish datasets.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.csv.convert_list_of_dicts_to_xlsx">
<code class="descclassname">onegov.core.csv.</code><code class="descname">convert_list_of_dicts_to_xlsx</code><span class="sig-paren">(</span><em>rows</em>, <em>fields=None</em>, <em>key=None</em>, <em>reverse=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/csv.html#convert_list_of_dicts_to_xlsx"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.csv.convert_list_of_dicts_to_xlsx" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a list of dictionaries and returns a xlsx.</p>
<p>This behaves the same way as <a class="reference internal" href="#onegov.core.csv.convert_list_of_dicts_to_csv" title="onegov.core.csv.convert_list_of_dicts_to_csv"><code class="xref py py-func docutils literal"><span class="pre">convert_list_of_dicts_to_csv()</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.core.csv.parse_header">
<code class="descclassname">onegov.core.csv.</code><code class="descname">parse_header</code><span class="sig-paren">(</span><em>csv</em>, <em>dialect=None</em>, <em>rename_duplicate_column_names=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/csv.html#parse_header"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.csv.parse_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the first line of the given csv string and returns the headers.</p>
<p>Headers are normalized (stripped and normalized) and expected to be
unique. The dialect is sniffed, if not provided.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A list of headers in the order of appearance.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onegov.core.csv.match_headers">
<code class="descclassname">onegov.core.csv.</code><code class="descname">match_headers</code><span class="sig-paren">(</span><em>headers</em>, <em>expected</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/core/csv.html#match_headers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.core.csv.match_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a list of normalized headers and matches them up against a
list of expected headers.</p>
<p>The headers may differ from the expected headers. This function tries to
match them up using the Levenshtein distance. It does so somewhat carefully
by calculating a sane distance using the input.</p>
<p>The passed headers are expected to be have been normalized by
<a class="reference internal" href="#onegov.core.csv.normalize_header" title="onegov.core.csv.normalize_header"><code class="xref py py-func docutils literal"><span class="pre">normalize_header()</span></code></a>, since we usually will pass the result of
<a class="reference internal" href="#onegov.core.csv.parse_header" title="onegov.core.csv.parse_header"><code class="xref py py-func docutils literal"><span class="pre">parse_header()</span></code></a> to this function.</p>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">match_headers</span><span class="p">(</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;firstname&#39;</span><span class="p">,</span> <span class="s1">&#39;lastname&#39;</span><span class="p">],</span>
    <span class="n">expected</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="s1">&#39;first_name&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Results in:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>If no match is possible, an
<code class="xref py py-class docutils literal"><span class="pre">MissingColumnsError</span></code>, or
<code class="xref py py-class docutils literal"><span class="pre">AmbiguousColumnsError</span></code> or
<code class="xref py py-class docutils literal"><span class="pre">DuplicateColumnNamesError</span></code> error is raised.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The matched headers in the order of appearance.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo.svg" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=OneGov&repo=onegov-docs&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Verein OneGov.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/onegov_core.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
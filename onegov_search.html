
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Onegov Search API &#8212; OneGov Docs 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="onegov-search-api">
<h1>Onegov Search API<a class="headerlink" href="#onegov-search-api" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-onegov.search.integration">
<span id="integration"></span><h2>Integration<a class="headerlink" href="#module-onegov.search.integration" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="onegov.search.integration.TolerantTransport">
<em class="property">class </em><code class="descclassname">onegov.search.integration.</code><code class="descname">TolerantTransport</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/integration.html#TolerantTransport"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.integration.TolerantTransport" title="Permalink to this definition">¶</a></dt>
<dd><p>A transport class that is less eager to rejoin connections when there’s
a failure. Additionally logs all Elasticsearch transport errors in one
location.</p>
<dl class="attribute">
<dt id="onegov.search.integration.TolerantTransport.skip_request">
<code class="descname">skip_request</code><a class="headerlink" href="#onegov.search.integration.TolerantTransport.skip_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the request should be skipped.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.search.integration.TolerantTransport.seconds_remaining">
<code class="descname">seconds_remaining</code><a class="headerlink" href="#onegov.search.integration.TolerantTransport.seconds_remaining" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the seconds remaining until the next try or 0.</p>
<p>For each failure we wait an additional 10s (10s, then 20s, 30s, etc),
up to a maximum of 300s (5 minutes).</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.integration.TolerantTransport.perform_request">
<code class="descname">perform_request</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/integration.html#TolerantTransport.perform_request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.integration.TolerantTransport.perform_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform the actual request. Retrieve a connection from the connection
pool, pass all the information to it’s perform_request method and
return the data.</p>
<p>If an exception was raised, mark the connection as failed and retry (up
to <cite>max_retries</cite> times).</p>
<p>If the operation was succesful and the connection used was previously
marked as dead, mark it as live, resetting it’s failure count.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>method</strong> – HTTP method to use</li>
<li><strong>url</strong> – absolute url (without host) to target</li>
<li><strong>headers</strong> – dictionary of headers, will be handed over to the
underlying <code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code> class</li>
<li><strong>params</strong> – dictionary of query parameters, will be handed over to the
underlying <code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code> class for serialization</li>
<li><strong>body</strong> – body of the request, will be serializes using serializer and
passed to the connection</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="onegov.search.integration.ElasticsearchApp">
<em class="property">class </em><code class="descclassname">onegov.search.integration.</code><code class="descname">ElasticsearchApp</code><a class="reference internal" href="_modules/onegov/search/integration.html#ElasticsearchApp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.integration.ElasticsearchApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides elasticsearch integration for
<a class="reference internal" href="onegov_core.html#onegov.core.framework.Framework" title="onegov.core.framework.Framework"><code class="xref py py-class docutils literal notranslate"><span class="pre">onegov.core.framework.Framework</span></code></a> based applications.</p>
<p>The application must be connected to a database.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onegov.core</span> <span class="k">import</span> <span class="n">Framework</span>

<span class="k">class</span> <span class="nc">MyApp</span><span class="p">(</span><span class="n">Framework</span><span class="p">,</span> <span class="n">ESIntegration</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<dl class="method">
<dt id="onegov.search.integration.ElasticsearchApp.configure_search">
<code class="descname">configure_search</code><span class="sig-paren">(</span><em>**cfg</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/integration.html#ElasticsearchApp.configure_search"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.integration.ElasticsearchApp.configure_search" title="Permalink to this definition">¶</a></dt>
<dd><p>Configures the elasticsearch client, leaving it as a property
on the class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">es_client</span>
</pre></div>
</div>
<p>The following configuration options are accepted:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Enable_elasticsearch:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><p class="first">If True, elasticsearch is enabled (defaults to True).</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Elasticsearch_hosts:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first">A list of elasticsearch clusters, including username, password,
protocol and port.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">https://user:secret&#64;localhost:443</span></code></p>
<p>By default the client connects to the localhost on port 9200
(the default), and on port 19200 (the default of boxen).</p>
<p>At least one host in the list of servers must be up at startup.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">Elasticsearch_may_queue_size:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><p class="first">The maximum queue size reserved for documents to be indexed. This
queue is filling up if the elasticsearch cluster cannot be reached.</p>
<p>Once the queue is full, warnings are emitted.</p>
<p>Defaults to 10‘000</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Elasticsearch_verify_certs:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first">If true, the elasticsearch client verifies the certificates of
the ssl connection. Defaults to true. Do not disable, unless you
are in testing!</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">Elasticsearch_languages:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><dl class="first last docutils">
<dt>The languages supported by onegov.search. Defaults to:</dt>
<dd><ul class="first last simple">
<li>en</li>
<li>de</li>
<li>fr</li>
</ul>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="onegov.search.integration.ElasticsearchApp.es_search">
<code class="descname">es_search</code><span class="sig-paren">(</span><em>languages='*'</em>, <em>types='*'</em>, <em>include_private=False</em>, <em>explain=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/integration.html#ElasticsearchApp.es_search"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.integration.ElasticsearchApp.es_search" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a search scoped to the current application, with the
given languages, types and private documents excluded by default.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.integration.ElasticsearchApp.es_search_by_request">
<code class="descname">es_search_by_request</code><span class="sig-paren">(</span><em>request</em>, <em>types='*'</em>, <em>explain=False</em>, <em>limit_to_request_language=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/integration.html#ElasticsearchApp.es_search_by_request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.integration.ElasticsearchApp.es_search_by_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the current <a class="reference internal" href="onegov_core.html#onegov.core.request.CoreRequest" title="onegov.core.request.CoreRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">CoreRequest</span></code></a> and
returns an elastic search scoped to the current application, the
requests language and it’s access rights.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.integration.ElasticsearchApp.es_suggestions">
<code class="descname">es_suggestions</code><span class="sig-paren">(</span><em>query</em>, <em>languages='*'</em>, <em>types='*'</em>, <em>include_private=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/integration.html#ElasticsearchApp.es_suggestions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.integration.ElasticsearchApp.es_suggestions" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns suggestions for the given query.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.integration.ElasticsearchApp.es_suggestions_by_request">
<code class="descname">es_suggestions_by_request</code><span class="sig-paren">(</span><em>request</em>, <em>query</em>, <em>types='*'</em>, <em>limit_to_request_language=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/integration.html#ElasticsearchApp.es_suggestions_by_request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.integration.ElasticsearchApp.es_suggestions_by_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns suggestions for the given query, scoped to the language
and the login status of the given requst.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.integration.ElasticsearchApp.es_may_use_private_search">
<code class="descname">es_may_use_private_search</code><span class="sig-paren">(</span><em>request</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/integration.html#ElasticsearchApp.es_may_use_private_search"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.integration.ElasticsearchApp.es_may_use_private_search" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the given request is allowed to access private
search results. By default every logged in user has access to those.</p>
<p>This method may be overwritten if this is not desired.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.integration.ElasticsearchApp.es_perform_reindex">
<code class="descname">es_perform_reindex</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/integration.html#ElasticsearchApp.es_perform_reindex"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.integration.ElasticsearchApp.es_perform_reindex" title="Permalink to this definition">¶</a></dt>
<dd><p>Reindexes all content.</p>
<p>This is a heavy operation and should be run with consideration.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-onegov.search.indexer">
<span id="indexer"></span><h2>Indexer<a class="headerlink" href="#module-onegov.search.indexer" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="onegov.search.indexer.IndexParts">
<em class="property">class </em><code class="descclassname">onegov.search.indexer.</code><code class="descname">IndexParts</code><span class="sig-paren">(</span><em>hostname</em>, <em>schema</em>, <em>language</em>, <em>type_name</em>, <em>version</em><span class="sig-paren">)</span><a class="headerlink" href="#onegov.search.indexer.IndexParts" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="onegov.search.indexer.IndexParts.hostname">
<code class="descname">hostname</code><a class="headerlink" href="#onegov.search.indexer.IndexParts.hostname" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.search.indexer.IndexParts.language">
<code class="descname">language</code><a class="headerlink" href="#onegov.search.indexer.IndexParts.language" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.search.indexer.IndexParts.schema">
<code class="descname">schema</code><a class="headerlink" href="#onegov.search.indexer.IndexParts.schema" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.search.indexer.IndexParts.type_name">
<code class="descname">type_name</code><a class="headerlink" href="#onegov.search.indexer.IndexParts.type_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.search.indexer.IndexParts.version">
<code class="descname">version</code><a class="headerlink" href="#onegov.search.indexer.IndexParts.version" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 4</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="onegov.search.indexer.parse_index_name">
<code class="descclassname">onegov.search.indexer.</code><code class="descname">parse_index_name</code><span class="sig-paren">(</span><em>index_name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#parse_index_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.parse_index_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given index name and returns the hostname, schema,
language and type_name in a dictionary.</p>
<ul class="simple">
<li>If the index_name doesn’t match the pattern, all values are None.</li>
<li>If the index_name has no version, the version is None.</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="onegov.search.indexer.Indexer">
<em class="property">class </em><code class="descclassname">onegov.search.indexer.</code><code class="descname">Indexer</code><span class="sig-paren">(</span><em>mappings</em>, <em>queue</em>, <em>es_client</em>, <em>hostname=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#Indexer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.Indexer" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes actions from a queue and executes them on the elasticsearch
cluster. Depends on <a class="reference internal" href="#onegov.search.indexer.IndexManager" title="onegov.search.indexer.IndexManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">IndexManager</span></code></a> for index management and expects
to have the same <code class="xref py py-class docutils literal notranslate"><span class="pre">TypeRegistry</span></code> as <a class="reference internal" href="#onegov.search.indexer.ORMEventTranslator" title="onegov.search.indexer.ORMEventTranslator"><code class="xref py py-class docutils literal notranslate"><span class="pre">ORMEventTranslator</span></code></a>.</p>
<p>The idea is that this class does the indexing/deindexing, the index manager
sets up the indices and the orm event translator listens for changes in
the ORM.</p>
<p>A queue is used so the indexer can be run in a separate thread.</p>
<dl class="method">
<dt id="onegov.search.indexer.Indexer.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>block=False</em>, <em>timeout=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#Indexer.process"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.Indexer.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Processes the queue until it is empty or until there’s an error.</p>
<p>If there’s an error, the next call to this function will try to
execute the failed task again. This is mainly meant for elasticsearch
outages.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Block:</th><td class="field-body">If True, the process waits for the queue to be available. Useful
if you run this in a separate thread.</td>
</tr>
<tr class="field-even field"><th class="field-name">Timeout:</th><td class="field-body">How long the blocking call should block. Has no effect if
<code class="docutils literal notranslate"><span class="pre">block</span></code> is False.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The number of successfully processed items</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="onegov.search.indexer.Indexer.bulk_process">
<code class="descname">bulk_process</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#Indexer.bulk_process"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.Indexer.bulk_process" title="Permalink to this definition">¶</a></dt>
<dd><p>Processes the queue in bulk. This offers better performance but it
is less safe at the moment and should only be used as part of
reindexing.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="onegov.search.indexer.IndexManager">
<em class="property">class </em><code class="descclassname">onegov.search.indexer.</code><code class="descname">IndexManager</code><span class="sig-paren">(</span><em>hostname</em>, <em>es_client</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#IndexManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.IndexManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Manages the creation/destruction of indices. The indices it creates
have an internal name and an external alias. To facilitate that, versions
are used.</p>
<dl class="method">
<dt id="onegov.search.indexer.IndexManager.query_indices">
<code class="descname">query_indices</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#IndexManager.query_indices"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.IndexManager.query_indices" title="Permalink to this definition">¶</a></dt>
<dd><p>Queryies the elasticsearch cluster for indices belonging to this
hostname.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.indexer.IndexManager.query_aliases">
<code class="descname">query_aliases</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#IndexManager.query_aliases"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.IndexManager.query_aliases" title="Permalink to this definition">¶</a></dt>
<dd><p>Queryies the elasticsearch cluster for aliases belonging to this
hostname.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.indexer.IndexManager.ensure_index">
<code class="descname">ensure_index</code><span class="sig-paren">(</span><em>schema</em>, <em>language</em>, <em>mapping</em>, <em>return_index='external'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#IndexManager.ensure_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.IndexManager.ensure_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the given database schema, language and type name and
creates an internal index with a version number and an external
alias without the version number.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Schema:</th><td class="field-body">The database schema this index is based on.</td>
</tr>
<tr class="field-even field"><th class="field-name">Language:</th><td class="field-body">The language in ISO 639-1 format.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Mapping:</th><td class="field-body">The <code class="xref py py-class docutils literal notranslate"><span class="pre">TypeMapping</span></code> mapping used in this index.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return_index:</th><td class="field-body">The index name to return. Either ‘external’ or ‘internal’.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The (external/aliased) name of the created index.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="onegov.search.indexer.IndexManager.remove_expired_indices">
<code class="descname">remove_expired_indices</code><span class="sig-paren">(</span><em>current_mappings</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#IndexManager.remove_expired_indices"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.IndexManager.remove_expired_indices" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes all expired indices. An index is expired if it’s version
number is no longer known in the current mappings.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The number of indices that were deleted.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="onegov.search.indexer.IndexManager.get_managed_indices_wildcard">
<code class="descname">get_managed_indices_wildcard</code><span class="sig-paren">(</span><em>schema</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#IndexManager.get_managed_indices_wildcard"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.IndexManager.get_managed_indices_wildcard" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a wildcard index name for all indices managed.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.indexer.IndexManager.get_external_index_names">
<code class="descname">get_external_index_names</code><span class="sig-paren">(</span><em>schema</em>, <em>languages='*'</em>, <em>types='*'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#IndexManager.get_external_index_names"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.IndexManager.get_external_index_names" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a comma separated string of external index names that
match the given arguments. Useful to pass on to elasticsearch when
targeting multiple indices.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.indexer.IndexManager.get_external_index_name">
<code class="descname">get_external_index_name</code><span class="sig-paren">(</span><em>schema</em>, <em>language</em>, <em>type_name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#IndexManager.get_external_index_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.IndexManager.get_external_index_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates the external index name from the given parameters.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.indexer.IndexManager.get_internal_index_name">
<code class="descname">get_internal_index_name</code><span class="sig-paren">(</span><em>schema</em>, <em>language</em>, <em>type_name</em>, <em>version</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#IndexManager.get_internal_index_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.IndexManager.get_internal_index_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates the internal index name from the given parameters.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="onegov.search.indexer.ORMLanguageDetector">
<em class="property">class </em><code class="descclassname">onegov.search.indexer.</code><code class="descname">ORMLanguageDetector</code><span class="sig-paren">(</span><em>supported_languages</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#ORMLanguageDetector"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.ORMLanguageDetector" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="onegov.search.indexer.ORMEventTranslator">
<em class="property">class </em><code class="descclassname">onegov.search.indexer.</code><code class="descname">ORMEventTranslator</code><span class="sig-paren">(</span><em>mappings</em>, <em>max_queue_size=0</em>, <em>languages=('de'</em>, <em>'fr'</em>, <em>'en')</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/indexer.html#ORMEventTranslator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.indexer.ORMEventTranslator" title="Permalink to this definition">¶</a></dt>
<dd><p>Handles the onegov.core orm events, translates them into indexing
actions and puts the result into a queue for the indexer to consume.</p>
<p>The queue may be limited. Once the limit is reached, new events are no
longer processed and an error is logged.</p>
</dd></dl>

</div>
<div class="section" id="module-onegov.search.mixins">
<span id="mixins"></span><h2>Mixins<a class="headerlink" href="#module-onegov.search.mixins" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="onegov.search.mixins.Searchable">
<em class="property">class </em><code class="descclassname">onegov.search.mixins.</code><code class="descname">Searchable</code><a class="reference internal" href="_modules/onegov/search/mixins.html#Searchable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.mixins.Searchable" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines the interface required for an object to be searchable.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">es_id</span> <span class="pre">``,</span> <span class="pre">``es_properties</span></code> and <code class="docutils literal notranslate"><span class="pre">es_type_name</span></code> must be class
properties, not instance properties. So do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">X</span><span class="p">(</span><span class="n">Searchable</span><span class="p">):</span>

    <span class="n">es_properties</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">es_type_name</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
</pre></div>
</div>
<p>But do not do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">X</span><span class="p">(</span><span class="n">Searchable</span><span class="p">):</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">es_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">es_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;x&#39;</span>
</pre></div>
</div>
<p>The rest of the properties may be normal properties.</p>
<p><strong>Polymorphic Identities</strong></p>
<p>If SQLAlchemy’s Polymorphic Identities are used, each identity must
have it’s own unqiue <code class="docutils literal notranslate"><span class="pre">es_type_name</span></code>. Though such models may share
the <code class="docutils literal notranslate"><span class="pre">es_properties</span></code> from the base class, we don’t assume anything and
store each polymorphic identity in its own index.</p>
<p>From the point of view of elasticsearch, each different polymorphic
identity is a completely different model.</p>
<dl class="attribute">
<dt id="onegov.search.mixins.Searchable.es_language">
<code class="descname">es_language</code><a class="headerlink" href="#onegov.search.mixins.Searchable.es_language" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines the language of the object. By default ‘auto’ is used,
which triggers automatic language detection. Automatic language
detection is reasonably accurate if provided with enough text. Short
texts are not detected easily.</p>
<p>When ‘auto’ is used, expect some content to be misclassified. You
should then search over all languages, not just the epxected one.</p>
<p>This property can be used to manually set the language.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.search.mixins.Searchable.es_public">
<code class="descname">es_public</code><a class="headerlink" href="#onegov.search.mixins.Searchable.es_public" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the model is available to be found by the public.
If false, only editors/admins will see this object in the search
results.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.search.mixins.Searchable.es_skip">
<code class="descname">es_skip</code><a class="headerlink" href="#onegov.search.mixins.Searchable.es_skip" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the indexing of this specific model instance
should be skipped.</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.search.mixins.Searchable.es_suggestion">
<code class="descname">es_suggestion</code><a class="headerlink" href="#onegov.search.mixins.Searchable.es_suggestion" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns suggest-as-you-type value of the document.
The field used for this property should also be indexed, or the
suggestion will lead to nowhere.</p>
<p>If a single string is returned, the completion input equals the
completion output. (My Title -&gt; My Title)</p>
<p>If an array of strings is returned, all values are possible inputs and
the first value is the output. (My Title/Title My -&gt; My Title)</p>
</dd></dl>

<dl class="attribute">
<dt id="onegov.search.mixins.Searchable.es_last_change">
<code class="descname">es_last_change</code><a class="headerlink" href="#onegov.search.mixins.Searchable.es_last_change" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the date the document was created/last modified.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="onegov.search.mixins.ORMSearchable">
<em class="property">class </em><code class="descclassname">onegov.search.mixins.</code><code class="descname">ORMSearchable</code><a class="reference internal" href="_modules/onegov/search/mixins.html#ORMSearchable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.mixins.ORMSearchable" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends the default <a class="reference internal" href="#onegov.search.mixins.Searchable" title="onegov.search.mixins.Searchable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Searchable</span></code></a> class with sensible defaults
for SQLAlchemy orm models.</p>
<dl class="attribute">
<dt id="onegov.search.mixins.ORMSearchable.es_last_change">
<code class="descname">es_last_change</code><a class="headerlink" href="#onegov.search.mixins.ORMSearchable.es_last_change" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the date the document was created/last modified.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-onegov.search.dsl">
<span id="dsl"></span><h2>DSL<a class="headerlink" href="#module-onegov.search.dsl" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="onegov.search.dsl.Search">
<em class="property">class </em><code class="descclassname">onegov.search.dsl.</code><code class="descname">Search</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/dsl.html#Search"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.dsl.Search" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends elastichsearch_dsl’s search object with ORM integration.</p>
<p>Works exactly the same as the original, but the results it returns offer
additional methods to query the SQLAlchemy models behind the results (if
any).</p>
</dd></dl>

<dl class="class">
<dt id="onegov.search.dsl.Response">
<em class="property">class </em><code class="descclassname">onegov.search.dsl.</code><code class="descname">Response</code><span class="sig-paren">(</span><em>search</em>, <em>response</em>, <em>doc_class=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/dsl.html#Response"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.dsl.Response" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends the default response (list of results) with additional
methods to query the SQLAlchemy models behind the results.</p>
<dl class="method">
<dt id="onegov.search.dsl.Response.query">
<code class="descname">query</code><span class="sig-paren">(</span><em>type</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/dsl.html#Response.query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.dsl.Response.query" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an SQLAlchemy query for the given type. You must provide
a type, because a query can’t consist of multiple unrelated tables.</p>
<p>If no results match the type, None is returned.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.dsl.Response.load">
<code class="descname">load</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/dsl.html#Response.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.dsl.Response.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads all results by querying the SQLAlchemy session in the order
they were returned by elasticsearch.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="onegov.search.dsl.explanation_value">
<code class="descclassname">onegov.search.dsl.</code><code class="descname">explanation_value</code><span class="sig-paren">(</span><em>explanation</em>, <em>text</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/dsl.html#explanation_value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.dsl.explanation_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the value from the explanation for descriptions starting with
the given text.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.search.dsl.Hit">
<em class="property">class </em><code class="descclassname">onegov.search.dsl.</code><code class="descname">Hit</code><span class="sig-paren">(</span><em>document</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/dsl.html#Hit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.dsl.Hit" title="Permalink to this definition">¶</a></dt>
<dd><p>Extends a single result with additional methods to query the SQLAlchemy
models behind the results.</p>
<dl class="method">
<dt id="onegov.search.dsl.Hit.query">
<code class="descname">query</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/dsl.html#Hit.query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.dsl.Hit.query" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the SQLAlchemy query for this result.</p>
</dd></dl>

<dl class="method">
<dt id="onegov.search.dsl.Hit.load">
<code class="descname">load</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/dsl.html#Hit.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.dsl.Hit.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads this result from the SQLAlchemy session.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-onegov.search.utils">
<span id="utils"></span><h2>Utils<a class="headerlink" href="#module-onegov.search.utils" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="onegov.search.utils.searchable_sqlalchemy_models">
<code class="descclassname">onegov.search.utils.</code><code class="descname">searchable_sqlalchemy_models</code><span class="sig-paren">(</span><em>base</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/utils.html#searchable_sqlalchemy_models"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.utils.searchable_sqlalchemy_models" title="Permalink to this definition">¶</a></dt>
<dd><p>Searches through the given SQLAlchemy base and returns the classes
of all SQLAlchemy models found which inherit from the
<a class="reference internal" href="#onegov.search.mixins.Searchable" title="onegov.search.mixins.Searchable"><code class="xref py py-class docutils literal notranslate"><span class="pre">onegov.search.mixins.Searchable</span></code></a> interface.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.search.utils.is_valid_index_name">
<code class="descclassname">onegov.search.utils.</code><code class="descname">is_valid_index_name</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/utils.html#is_valid_index_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.utils.is_valid_index_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if the given name is a valid elasticsearch index name.
Elasticsearch does it’s own checks, but we can do it earlier and we are
a bit stricter.</p>
</dd></dl>

<dl class="function">
<dt id="onegov.search.utils.related_types">
<code class="descclassname">onegov.search.utils.</code><code class="descname">related_types</code><span class="sig-paren">(</span><em>model</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/utils.html#related_types"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.utils.related_types" title="Permalink to this definition">¶</a></dt>
<dd><p>Gathers all related es type names from the given model. A type is
counted as related a model is part of a polymorphic setup.</p>
<p>If no polymorphic identity is found, the result is simply a set with the
model’s type itself.</p>
</dd></dl>

<dl class="class">
<dt id="onegov.search.utils.LanguageDetector">
<em class="property">class </em><code class="descclassname">onegov.search.utils.</code><code class="descname">LanguageDetector</code><span class="sig-paren">(</span><em>supported_languages</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onegov/search/utils.html#LanguageDetector"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onegov.search.utils.LanguageDetector" title="Permalink to this definition">¶</a></dt>
<dd><p>Detects languages with the help of langdetect.</p>
<p>Unlike langdetect this detector may be limited to a subset of all
supported languages, which may improve accuracy if the subset is known and
saves some memory.</p>
</dd></dl>

</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo.svg" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=OneGov&repo=onegov-docs&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Verein OneGov.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="_sources/onegov_search.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
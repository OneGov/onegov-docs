
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Write Forms with Formcode Syntax &#8212; OneGov Docs 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-onegov.form.parser.core">
<span id="write-forms-with-formcode-syntax"></span><h1>Write Forms with Formcode Syntax<a class="headerlink" href="#module-onegov.form.parser.core" title="Permalink to this headline">¶</a></h1>
<p>onegov.form includes it’s own markdownish form syntax, inspired by
<a class="reference external" href="https://github.com/maleldil/wmd">https://github.com/maleldil/wmd</a></p>
<p>The goal of this syntax is to enable the creation of forms through the web,
without having to use javascript, html or python code.</p>
<p>Also, just like Markdown, we want this syntax to be readable by humans.</p>
<div class="section" id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p>Internally, the form syntax is converted into a YAML file, which is in turn
parsed and turned into a WTForms class. We decided to go for the intermediate
YAML file because it’s easy to define a Syntax which correctly supports
indentation. Our pyparsing approach was flimsy at best.</p>
</div>
<div class="section" id="parser-errors">
<h2>Parser Errors<a class="headerlink" href="#parser-errors" title="Permalink to this headline">¶</a></h2>
<p>There’s currently no sophisticated error check. It’s possible that the parser
misunderstand something you defined without warning. So be careful to check
that what you wanted was actually what you got.</p>
</div>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fields">
<h3>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h3>
<p>Every field is identified by a label, an optional ‘required’ indicator and a
field definition. The Label can be any kind of text, not including <code class="docutils literal notranslate"><span class="pre">*</span></code> and
<code class="docutils literal notranslate"><span class="pre">=</span></code>.
The <code class="docutils literal notranslate"><span class="pre">*</span></code> indicates that a field is required. The <code class="docutils literal notranslate"><span class="pre">=</span></code> separates the
identifier from the definition.</p>
<p>A required field starts like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">My</span> <span class="n">required</span> <span class="n">field</span> <span class="o">*</span> <span class="o">=</span>
</pre></div>
</div>
<p>An optional field starts like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">My</span> <span class="n">optional</span> <span class="n">field</span> <span class="o">=</span>
</pre></div>
</div>
<p>Following the identifier is the field definition. For example, this defines
a textfield:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">My</span> <span class="n">textfield</span> <span class="o">=</span> <span class="n">___</span>
</pre></div>
</div>
<p>All possible fields are documented further below.</p>
</div>
<div class="section" id="fieldsets">
<h3>Fieldsets<a class="headerlink" href="#fieldsets" title="Permalink to this headline">¶</a></h3>
<p>Fields are grouped into fieldsets. The fieldset of a field is the fieldset
that was last defined:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fieldset 1</span>
<span class="n">I</span> <span class="n">belong</span> <span class="n">to</span> <span class="n">Fieldset</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">___</span>

<span class="c1"># Fieldset 2</span>
<span class="n">I</span> <span class="n">belong</span> <span class="n">to</span> <span class="n">Fieldset</span> <span class="mi">2</span> <span class="o">=</span> <span class="n">___</span>
</pre></div>
</div>
<p>If no fieldset is defined, the fields don’t belong to a fieldset. To stop
putting fields in a fieldset, define an empty fieldeset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fieldset 1</span>
<span class="n">I</span> <span class="n">belong</span> <span class="n">to</span> <span class="n">Fieldset</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">___</span>

<span class="c1"># ...</span>
<span class="n">I</span> <span class="n">don</span><span class="s1">&#39;t belong to a Fieldset = ___</span>
</pre></div>
</div>
</div>
<div class="section" id="available-fields">
<h3>Available Fields<a class="headerlink" href="#available-fields" title="Permalink to this headline">¶</a></h3>
<div class="section" id="textfield">
<h4>Textfield<a class="headerlink" href="#textfield" title="Permalink to this headline">¶</a></h4>
<p>A textfield consists of exactly three underscores:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a textfield = ___</span>
</pre></div>
</div>
<p>If the textfield is limited in length, the length can be given:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a limited textfield = ___[50]</span>
</pre></div>
</div>
<p>The length of such textfields is validated.</p>
<p>Additionally, textfields may use regexes to validate their contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a numbers-only textfield = ___/^[0-9]+$</span>
</pre></div>
</div>
<p>You <em>can</em> combine the length with a regex, though you probably don’t want to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a length-limited numbers-only textfield = ___[4]/^[0-9]+$</span>
</pre></div>
</div>
<p>This could be simplified as follows:</p>
<blockquote>
<div><p>I’m a length-limited numbers-only textfield = ___/^[0-9]{0,4}$</p>
</div></blockquote>
<p>Note that you don’t <em>need</em> to specify the beginning (^) and the end ($) of the
string, but not doing so might result in unexpected results. For example,
while ‘123abc’ is invalid for <code class="docutils literal notranslate"><span class="pre">___/^[0-9]+$</span></code>, it is perfectly valid for
<code class="docutils literal notranslate"><span class="pre">___/[0-9]+</span></code>. The latter only demands that the text starts with a number,
not that it only consists of numbers!</p>
</div>
<div class="section" id="textarea">
<h4>Textarea<a class="headerlink" href="#textarea" title="Permalink to this headline">¶</a></h4>
<p>A textarea has no limit and consists of exactly three dots:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a textarea = ...</span>
</pre></div>
</div>
<p>Optionally, the number of rows can be passed to the field. This changes the
way the textarea looks, not the way it acts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a textarea with 10 rows = ...[10]</span>
</pre></div>
</div>
</div>
<div class="section" id="password">
<h4>Password<a class="headerlink" href="#password" title="Permalink to this headline">¶</a></h4>
<p>A password field consists of exactly three stars:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a password = ***</span>
</pre></div>
</div>
</div>
<div class="section" id="e-mail">
<h4>E-Mail<a class="headerlink" href="#e-mail" title="Permalink to this headline">¶</a></h4>
<p>An e-mail field consists of exactly three <code class="docutils literal notranslate"><span class="pre">&#64;</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m an e-mail field = @@@</span>
</pre></div>
</div>
</div>
<div class="section" id="url">
<h4>URL<a class="headerlink" href="#url" title="Permalink to this headline">¶</a></h4>
<p>An url field consists of the http/https prefix:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m an url field = http://</span>
<span class="n">I</span><span class="s1">&#39;m the exact same = https://</span>
</pre></div>
</div>
<p>Whether or not you enter http or https has no bearing on the validation.</p>
</div>
<div class="section" id="date">
<h4>Date<a class="headerlink" href="#date" title="Permalink to this headline">¶</a></h4>
<p>A date (without time) is defined by this exact string: <code class="docutils literal notranslate"><span class="pre">YYYY.MM.DD</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a date field = YYYY.MM.DD</span>
</pre></div>
</div>
<p>Note that this doesn’t mean that the date format can be influenced.</p>
</div>
<div class="section" id="datetime">
<h4>Datetime<a class="headerlink" href="#datetime" title="Permalink to this headline">¶</a></h4>
<p>A date (with time) is defined by this exact string: <code class="docutils literal notranslate"><span class="pre">YYYY.MM.DD</span> <span class="pre">HH:MM</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a datetime field = YYYY.MM.DD HH:MM</span>
</pre></div>
</div>
<p>Again, this doesn’t mean that the datetime format can be influenced.</p>
</div>
<div class="section" id="time">
<h4>Time<a class="headerlink" href="#time" title="Permalink to this headline">¶</a></h4>
<p>A Time is defined by this exact string: <code class="docutils literal notranslate"><span class="pre">HH:MM</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a time field = HH:MM</span>
</pre></div>
</div>
<p>One more time, this doesn’t mean that the datetime format can be influenced.</p>
</div>
<div class="section" id="numbers">
<h4>Numbers<a class="headerlink" href="#numbers" title="Permalink to this headline">¶</a></h4>
<p>There are two types of number fields. An integer and a float field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m an integer field = 0..99</span>
<span class="n">I</span><span class="s1">&#39;m an integer field of a different range = -100..100</span>

<span class="n">I</span><span class="s1">&#39;m a float field = 0.00..99.00</span>
<span class="n">I</span><span class="s1">&#39;m an float field of a different range = -100.00..100.00</span>
</pre></div>
</div>
</div>
<div class="section" id="code">
<h4>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h4>
<p>To write code in a certain syntax, use the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Description</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">markdown</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Currently, only markdown is supported.</p>
</div>
<div class="section" id="files">
<h4>Files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h4>
<p>A file upload is defined like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a file upload field = *.*</span>
</pre></div>
</div>
<p>This particular example would allow any file. To allow only certain files
do something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a image filed = *.png|*.jpg|*.gif</span>
<span class="n">I</span><span class="s1">&#39;m a document = *.doc</span>
<span class="n">I</span><span class="s1">&#39;m any document = *.doc|*.pdf</span>
</pre></div>
</div>
<p>The files are checked against their file extension. Onegov.form also checks
that uploaded files have the mimetype they claim to have and it won’t accept
obviously dangerous uploads like binaries (unless you really want to).</p>
</div>
<div class="section" id="standard-numbers">
<h4>Standard Numbers<a class="headerlink" href="#standard-numbers" title="Permalink to this headline">¶</a></h4>
<p>onegov.form uses <a class="reference external" href="https://github.com/arthurdejong/python-stdnum">python-stdnum</a> to offer a wide range of
standard formats that are guaranteed to be validated.</p>
<p>To use, simply use a <cite>#</cite>, followed by the stdnum format to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">&#39;m a valid IBAN (or empty) = # iban</span>
<span class="n">I</span><span class="s1">&#39;m a valid IBAN (required) * = # iban</span>
</pre></div>
</div>
<p>The format string after the <cite>#</cite> must be importable from stdnum. In other words,
this must work, if you are using <code class="docutils literal notranslate"><span class="pre">ch.ssn</span></code> (to use an example):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python
&gt;&gt;&gt; from stdnum.ch import ssn
</pre></div>
</div>
<p>This is a bit of an advanced feature and since it delegates most work to an
external library there’s no guarantee that a format once used may be reused
in the future.</p>
<p>Still, the library should be somewhat stable and the benefit is huge.</p>
<p>To see the available format, have a look at the docs:
<a class="reference external" href="http://arthurdejong.org/python-stdnum/doc/1.1/index.html#available-formats">http://arthurdejong.org/python-stdnum/doc/1.1/index.html#available-formats</a></p>
</div>
<div class="section" id="radio-buttons">
<h4>Radio Buttons<a class="headerlink" href="#radio-buttons" title="Permalink to this headline">¶</a></h4>
<p>Radio button fields consist of x radio buttons, out of which one may be
preselected. Radio buttons need to be indented on the lines after the
definition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Gender</span> <span class="o">=</span>
    <span class="p">(</span> <span class="p">)</span> <span class="n">Female</span>
    <span class="p">(</span> <span class="p">)</span> <span class="n">Male</span>
    <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">I</span> <span class="n">don</span><span class="s1">&#39;t want to say</span>
</pre></div>
</div>
<p>Radio buttons also have the ability to define optional form parts. Those
parts are only shown if a question was answered a certain way.</p>
<p>Form parts are properly nested if they lign up with the label above them.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Delivery</span> <span class="n">Method</span> <span class="o">=</span>
    <span class="p">(</span> <span class="p">)</span> <span class="n">Pickup</span>
        <span class="n">Pickup</span> <span class="n">Time</span> <span class="o">*</span> <span class="o">=</span> <span class="n">___</span>
    <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">Address</span>
        <span class="n">Street</span> <span class="o">*</span> <span class="o">=</span> <span class="n">___</span>
        <span class="n">Town</span> <span class="o">*</span> <span class="o">=</span> <span class="n">___</span>
</pre></div>
</div>
<p>Here, the street and the town only need to be provided, if the delivery method
is ‘Address’. If the user selects a different option, the fields are not
shown and they will not be required.</p>
<p>On the other hand, if ‘Pickup’ is selected, the ‘Pickup Time’ needs to be
filled out and the address options are hidden.</p>
<p>This kind of nesting may continue ad infinitum. Meaning you can nest radio
buttons as deeply as you like. Note however, that this is discouraged and that
your users will not be too happy if you present them with a deeply nested
form.</p>
<p>More than one level of nesting is a clear indicator that your form is too
complex.</p>
</div>
<div class="section" id="checkboxes">
<h4>Checkboxes<a class="headerlink" href="#checkboxes" title="Permalink to this headline">¶</a></h4>
<p>Checkboxes work exactly like radio buttons, just that you can select
multiple fields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Extras</span> <span class="o">=</span>
    <span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">Phone</span> <span class="n">insurance</span>
    <span class="p">[</span> <span class="p">]</span> <span class="n">Phone</span> <span class="n">case</span>
    <span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">Extra</span> <span class="n">battery</span>
</pre></div>
</div>
<p>Just like radiobuttons, checkboxes may be nested to created dependencies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Additional</span> <span class="n">toppings</span> <span class="o">=</span>
    <span class="p">[</span> <span class="p">]</span> <span class="n">Salami</span>
    <span class="p">[</span> <span class="p">]</span> <span class="n">Olives</span>
    <span class="p">[</span> <span class="p">]</span> <span class="n">Other</span>
        <span class="n">Description</span> <span class="o">=</span> <span class="n">___</span>
</pre></div>
</div>
</div>
<div class="section" id="pricing-information">
<h4>Pricing Information<a class="headerlink" href="#pricing-information" title="Permalink to this headline">¶</a></h4>
<p>Radio buttons and checkboxes may be priced. For example, the following order
form can be modeled:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Node</span> <span class="n">Size</span> <span class="o">=</span>
    <span class="p">(</span> <span class="p">)</span> <span class="n">Small</span> <span class="p">(</span><span class="mi">20</span> <span class="n">USD</span><span class="p">)</span>
    <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">Medium</span> <span class="p">(</span><span class="mi">30</span> <span class="n">USD</span><span class="p">)</span>
    <span class="p">(</span> <span class="p">)</span> <span class="n">Large</span> <span class="p">(</span><span class="mi">40</span> <span class="n">USD</span><span class="p">)</span>

<span class="n">Extras</span> <span class="o">=</span>
    <span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">Second</span> <span class="n">IP</span> <span class="n">Address</span> <span class="p">(</span><span class="mi">20</span> <span class="n">CHF</span><span class="p">)</span>
    <span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">Backup</span> <span class="p">(</span><span class="mi">20</span> <span class="n">CHF</span><span class="p">)</span>
</pre></div>
</div>
<p>The additional pricing metadata can be used to provide simple order forms.
As in any other form, dependencies are taken into account.</p>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo.svg" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=OneGov&repo=onegov-docs&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Verein OneGov.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/formcode.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>